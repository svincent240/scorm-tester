(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();const Fs="modulepreload",Vs=function(t,e){return new URL(t,e).href},mn={},ae=function(e,n,s){let r=Promise.resolve();if(n&&n.length>0){let c=function(d){return Promise.all(d.map(f=>Promise.resolve(f).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),l=a?.nonce||a?.getAttribute("nonce");r=c(n.map(d=>{if(d=Vs(d,s),d in mn)return;mn[d]=!0;const f=d.endsWith(".css"),m=f?'[rel="stylesheet"]':"";if(s)for(let g=o.length-1;g>=0;g--){const p=o[g];if(p.href===d&&(!f||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${m}`))return;const u=document.createElement("link");if(u.rel=f?"stylesheet":Fs,f||(u.as="script"),u.crossOrigin="",u.href=d,l&&u.setAttribute("nonce",l),document.head.appendChild(u),f)return new Promise((g,p)=>{u.addEventListener("load",g),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${d}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};function z(t){if(t===null||typeof t!="object")return t;if(t instanceof Date)return new Date(t.getTime());if(Array.isArray(t))return t.map(n=>z(n));const e={};for(const n in t)t.hasOwnProperty(n)&&(e[n]=z(t[n]));return e}function Rn(t="id"){return`${t}-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Hs(t){return!t||!(t instanceof HTMLElement)?[]:Array.from(t.querySelectorAll('a[href], button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'))}function Us(t){if(!t||!(t instanceof HTMLElement))throw new Error("trapFocus: container must be a valid HTMLElement");const e=Hs(t);if(e.length===0)return()=>{};const n=e[0],s=e[e.length-1],r=i=>{i.key==="Tab"&&(i.shiftKey?document.activeElement===n&&(i.preventDefault(),s.focus()):document.activeElement===s&&(i.preventDefault(),n.focus()))};return t.addEventListener("keydown",r),n.focus(),()=>{t.removeEventListener("keydown",r)}}function Tt(t,...e){if(!t||typeof t!="object"||Array.isArray(t))throw new Error("deepMerge: target must be a plain object");if(e.length===0)return t;const n=e.shift();if(n&&typeof n=="object"&&!Array.isArray(n)){for(const s in n)if(n.hasOwnProperty(s)){const r=n[s],i=t[s];r&&typeof r=="object"&&!Array.isArray(r)?((!i||typeof i!="object"||Array.isArray(i))&&(t[s]={}),Tt(t[s],r)):t[s]=r}}return Tt(t,...e)}function _t(t){if(!Array.isArray(t))throw new Error("shuffleArray: input must be an array");const e=[...t];for(let n=e.length-1;n>0;n--){const s=Math.floor(Math.random()*(n+1));[e[n],e[s]]=[e[s],e[n]]}return e}class Ws{constructor(){this.events={}}on(e,n,s={}){if(!e||typeof n!="function")throw new Error("Event name and callback are required");this.events[e]||(this.events[e]=[]);const r={callback:n,once:s.once||!1,id:Rn("listener")};return this.events[e].push(r),()=>this.off(e,r.id)}once(e,n){return this.on(e,n,{once:!0})}off(e,n){this.events[e]&&(typeof n=="string"?this.events[e]=this.events[e].filter(s=>s.id!==n):typeof n=="function"&&(this.events[e]=this.events[e].filter(s=>s.callback!==n)),this.events[e].length===0&&delete this.events[e])}emit(e,n){if(!this.events[e]||this.events[e].length===0)return!1;e.endsWith(":error")&&console.error(`[EventBus Error] ${e}:`,JSON.stringify(n,null,2));const s=[...this.events[e]],r=[];return s.forEach(i=>{try{i.callback(n),i.once&&r.push(i.id)}catch(o){console.error(`[EventBus] Error in listener for '${e}':`,o)}}),r.forEach(i=>this.off(e,i)),!0}async emitAsync(e,n){if(!this.events[e]||this.events[e].length===0)return!1;const s=[...this.events[e]],r=[];for(const i of s)try{await i.callback(n),i.once&&r.push(i.id)}catch(o){console.error(`[EventBus] Error in async listener for '${e}':`,o)}return r.forEach(i=>this.off(e,i)),!0}clear(e){e?delete this.events[e]:this.events={}}getListenerCount(e){return this.events[e]?this.events[e].length:0}}const v=new Ws,Qs=new Set(["cmi.learner_id","cmi.learner_name","cmi.credit","cmi.mode","cmi.total_time","cmi.max_time_allowed","cmi.time_limit_action","cmi.launch_data","cmi.comments_from_lms","cmi.objectives._count","cmi.interactions._count"]);class Ys{constructor(){this.state={},this.isInitialized=!1,this.isTerminated=!1}initialize(){if(this.isInitialized)throw new Error("StateManager: Already initialized. Do not call initialize() more than once.");this._hydrateStateFromLMS(),this.isInitialized=!0,console.log("[StateManager] Initialized and state hydrated from LMS"),v.emit("state:initialized",this.getState())}getState(){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");return z(this.state)}getDomainState(e){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");if(typeof e!="string"||e.trim()==="")throw new Error("StateManager: domain must be a non-empty string");return this.state[e]?z(this.state[e]):void 0}setDomainState(e,n,s={}){if(this.isTerminated)throw new Error("StateManager: Cannot set state after termination. The SCORM session has ended.");if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");if(typeof e!="string"||e.trim()==="")throw new Error("StateManager: domain must be a non-empty string");this.state[e]=n,console.log(`[StateManager] State updated for domain: ${e}`),v.emit("state:changed",{domain:e,value:n,meta:s}),this._commitToLMS()}getValue(e){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");return oe.getValue(e)}setValue(e,n){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");if(Qs.has(e))throw new Error(`StateManager: Cannot write to read-only SCORM element: ${e}`);return oe.setValue(e,n)}exitCourseWithSuspend(){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");if(this.isTerminated)throw new Error("StateManager: Already terminated. Cannot exit course again.");return console.log("[StateManager] Exiting course with suspend status"),this.setValue("cmi.exit","suspend"),this.terminate()}exitCourseComplete(){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");if(this.isTerminated)throw new Error("StateManager: Already terminated. Cannot exit course again.");return console.log("[StateManager] Exiting course with normal status"),this.setValue("cmi.exit",""),this.terminate()}terminate(){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");if(this.isTerminated)throw new Error("StateManager: Already terminated. Cannot terminate again.");return console.log("[StateManager] Terminating..."),this._commitToLMS(),this.isTerminated=!0,oe.terminate()}getComments(){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");const e=[],n=this.getValue("cmi.comments_from_learner._count");if(n>0)for(let s=0;s<n;s++)e.push({text:this.getValue(`cmi.comments_from_learner.${s}.comment`),location:this.getValue(`cmi.comments_from_learner.${s}.location`),timestamp:this.getValue(`cmi.comments_from_learner.${s}.timestamp`)});return e}addComment(e){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");if(!e||typeof e!="object")throw new Error("StateManager: commentObject must be a valid object");if(!e.text||typeof e.text!="string")throw new Error("StateManager: comment text is required and must be a string");const n=this.getValue("cmi.comments_from_learner._count");this.setValue(`cmi.comments_from_learner.${n}.comment`,e.text),this.setValue(`cmi.comments_from_learner.${n}.location`,e.location||""),this.setValue(`cmi.comments_from_learner.${n}.timestamp`,e.timestamp||new Date().toISOString()),console.log(`[StateManager] Comment added to cmi.comments_from_learner.${n}`)}updateProgressMeasure(e){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");if(this.isTerminated)throw new Error("StateManager: Cannot update progress after termination.");if(!e||e<=0)throw new Error("StateManager: totalSlides must be provided and greater than 0");try{const r=((this.getDomainState("navigation")||{}).visitedSlides||[]).length;let i=Math.min(r/e,1);return i=Math.max(0,Math.min(1,i)),i=Math.round(i*100)/100,this.setValue("cmi.progress_measure",i.toString()),console.log(`[StateManager] Progress measure updated: ${i} (${(i*100).toFixed(0)}%)`),console.log(`  - Slides visited: ${r}/${e}`),v.emit("progress:updated",{progressMeasure:i,visitedSlides:r,totalSlides:e}),i}catch(n){throw console.error("[StateManager] Error updating progress_measure:",n),v.emit("state:error",{domain:"progress",operation:"updateProgressMeasure",message:n.message,stack:n.stack}),n}}clearAllData(){if(!this.isInitialized)throw new Error("StateManager: Not initialized. Call initialize() first.");if(this.isTerminated)throw new Error("StateManager: Cannot clear data after termination.");console.log("[StateManager] Clearing all suspend data for course restart"),this.state={},this._commitToLMS(),v.emit("state:cleared",{reason:"course restart"})}_hydrateStateFromLMS(){let e;try{e=oe.getValue("cmi.entry"),console.log(`[StateManager] Entry mode: "${e}"`)}catch(s){throw new Error(`StateManager: Cannot read cmi.entry. SCORM API may not be initialized. Error: ${s.message}`)}if(e==="ab-initio"){this.state={},console.log("[StateManager] Fresh session (ab-initio), starting with empty state");return}const n=oe.getSuspendData();n?(this.state=n,console.log("[StateManager] Hydrated state from suspend_data"),console.log(`[StateManager] Restored ${Object.keys(n).length} domain(s) from previous session`)):(this.state={},e==="resume"?console.warn('[StateManager] Entry mode is "resume" but no suspend_data found. This may indicate a previous session that was not properly saved.'):console.log("[StateManager] No suspend_data found, starting with fresh state"))}_commitToLMS(){if(!this.isInitialized||this.isTerminated)throw new Error("StateManager: Cannot commit. Manager is not initialized or already terminated.");try{const e={domains:Object.keys(this.state),domainSizes:Object.fromEntries(Object.entries(this.state).map(([n,s])=>[n,JSON.stringify(s).length])),totalSize:JSON.stringify(this.state).length,totalSizeKB:(JSON.stringify(this.state).length/1024).toFixed(2)};return console.log("[StateManager] Committing state:",e),oe.setSuspendData(this.state),oe.commit(),console.log("[StateManager] State committed to LMS"),v.emit("state:committed"),!0}catch(e){const n={domains:Object.keys(this.state),domainSizes:{},problematicDomains:[]};for(const[s,r]of Object.entries(this.state))try{const i=JSON.stringify(r);n.domainSizes[s]=i.length,i.length>1e4&&n.problematicDomains.push({domain:s,size:i.length,sizeKB:(i.length/1024).toFixed(2)})}catch(i){n.domainSizes[s]="SERIALIZATION_FAILED",n.problematicDomains.push({domain:s,error:i.message})}throw v.emit("state:error",{domain:"state",operation:"commit",message:e.message,stack:e.stack,context:{stateSnapshot:n,originalError:e.message}}),console.error("[StateManager] Commit failed with detailed diagnostics:"),console.error("State structure:",JSON.stringify(n,null,2)),console.error("Original error:",e.message),console.error("Error stack:",e.stack),e}}}const k=new Ys;class Gs{constructor(){this.isConnected=!1,this.isTerminated=!1,this.isRecovered=!1,this.keepAliveInterval=null,this.sessionStartTime=0}initialize(){if(this.isConnected)return v.emit("scorm:error",{domain:"scorm",operation:"Initialize (redundant call)",message:"ConnectionManager.initialize() called more than once.",context:{}}),!0;this.sessionStartTime=Date.now();let e=!1,n=null,s=null;typeof window.getAPIHandle=="function"&&(s=window.getAPIHandle());try{const r=window.doInitialize();e=r==="true"||r===!0}catch(r){if(console.warn("[ConnectionManager] window.doInitialize() threw an error:",r),r.message&&(r.message.includes("Already initialized")||r.message.includes("103")))n={code:"103",message:r.message};else throw r}if(!e&&!n&&(n=this._getScormError()),!e||n){if(n&&(n.code==="103"||n.code===103||n.message&&n.message.includes("Already initialized"))){if(console.warn("[ConnectionManager] Session already initialized (Error 103). Recovering session..."),s)return console.log("[ConnectionManager] Session is active (Error 103). Forcing recovery."),typeof window.initialized<"u",window.initialized=!0,this.isConnected=!0,this.isRecovered=!0,this._startKeepAlive(),!0;console.error("[ConnectionManager] Could not get raw API handle for recovery.")}const r={domain:"scorm",operation:"Initialize",message:n?`SCORM initialization failed: ${n.message}`:"SCORM initialization failed",context:n};throw v.emit("scorm:error",r),new Error(r.message)}return this.isConnected=!0,console.log("[ConnectionManager] Initialize() completed successfully"),this._startKeepAlive(),!0}terminate(){if(!this.isConnected||this.isTerminated)return!0;this._stopKeepAlive();const e=window.doTerminate();if(this.isTerminated=e==="true"||e===!0,!this.isTerminated){const n=this._getScormError(),s={domain:"scorm",operation:"Terminate",message:n?`SCORM termination failed: ${n.message}`:"SCORM termination failed",context:n};throw v.emit("scorm:error",s),new Error(s.message)}return!0}setupLifecycleHandlers(){window.addEventListener("beforeunload",e=>{}),window.addEventListener("pagehide",()=>{if(!this.isTerminated){if(Date.now()-this.sessionStartTime<2e3){console.warn("[ConnectionManager] Page unload detected immediately after startup (< 2s). Ignoring.");return}console.log("[ConnectionManager] Page unload detected. Attempting emergency SCORM termination...");try{if(!(window.getAPIHandle?window.getAPIHandle():null)){console.warn("[ConnectionManager] SCORM API handle lost during unload.");return}k.exitCourseWithSuspend()}catch(e){console.debug("[ConnectionManager] Best-effort save during unload did not complete:",e.message)}}})}getValue(e){if(this._ensureInitialized(),this.isRecovered)return this._getValueRecovered(e);const n=window.doGetValue(e),s=this._getScormError();return s&&(console.error(`[ConnectionManager] GetValue('${e}') failed. Raw value: "${n}". Error:`,s),this._throwScormError("GetValue",`Failed to get value for "${e}"`,s,{key:e})),e==="cmi.suspend_data"&&this._logSuspendDataDiagnostics(n),n||""}setValue(e,n){this._ensureInitialized();const s=typeof n=="string"?n:String(n);if(this.isRecovered)return this._setValueRecovered(e,s);const r=window.doSetValue(e,s);if(!(r==="true"||r===!0)){console.error(`[ConnectionManager] SetValue('${e}') failed. Raw result: "${r}". Value length: ${s.length}`);const o=this._getScormError();this._throwScormError("SetValue",`Failed to set value for "${e}"`,o,{key:e,valuePreview:s.substring(0,50)})}return!0}commit(){if(this._ensureInitialized(),this.isRecovered)return this._commitRecovered();const e=window.doCommit();if(!(e==="true"||e===!0)){console.error(`[ConnectionManager] Commit failed. Raw result: "${e}"`);const s=this._getScormError();this._throwScormError("Commit","SCORM commit failed",s)}return!0}getSuspendData(){const e=this.getValue("cmi.suspend_data");if(console.log("[SCORM] getSuspendData() called"),console.log(`[SCORM] Raw suspend_data type: ${typeof e}`),console.log(`[SCORM] Raw suspend_data length: ${e?e.length:0}`),console.log(`[SCORM] Raw suspend_data value: ${e?e.length>200?e.substring(0,200)+"...":e:"(empty)"}`),!e)return console.log("[SCORM] No suspend_data found (empty/null/undefined)"),null;try{const n=JSON.parse(e);return console.log(`[SCORM] Successfully parsed suspend_data with ${Object.keys(n).length} domain(s)`),n}catch(n){const s={domain:"scorm",operation:"GetSuspendData",message:`Failed to parse suspend data as JSON: ${n.message}`,context:{rawData:e,parseError:n.message}};throw v.emit("scorm:error",s),new Error(s.message)}}setSuspendData(e){if(e==null){const i={domain:"scorm",operation:"SetSuspendData",message:"Cannot set suspend data: data is null or undefined",context:{dataType:typeof e,dataValue:e}};throw v.emit("scorm:error",i),new Error(i.message)}let n,s;try{s={topLevelKeys:Object.keys(e),dataType:typeof e,isArray:Array.isArray(e),keyCount:Object.keys(e).length},n=JSON.stringify(e)}catch(i){const o={domain:"scorm",operation:"SetSuspendData",message:`Failed to serialize suspend data to JSON: ${i.message}`,context:{serializeError:i.message,dataType:typeof e,dataSnapshot:s,stack:i.stack}};throw v.emit("scorm:error",o),new Error(o.message)}if(typeof n!="string"){const i={domain:"scorm",operation:"SetSuspendData",message:`JSON.stringify returned invalid type: ${typeof n}`,context:{serializedType:typeof n,serializedValue:n}};throw v.emit("scorm:error",i),new Error(i.message)}if(n.includes("\0")){const i={domain:"scorm",operation:"SetSuspendData",message:"Serialized data contains null characters (\\0) which are invalid for SCORM",context:{dataSnapshot:s,length:n.length,nullCharPosition:n.indexOf("\0")}};throw v.emit("scorm:error",i),new Error(i.message)}const r=(n.length/1024).toFixed(2);return v.emit("suspend-data:size",{bytes:n.length,kilobytes:parseFloat(r)}),n.length>64e3?(console.error(`[SCORM] âš ï¸ CRITICAL: suspend_data is ${r}KB (over 64KB). Many LMSs will reject this! Immediate optimization required.`),v.emit("suspend-data:critical",{bytes:n.length})):n.length>32e3?(console.warn(`[SCORM] âš ï¸ WARNING: suspend_data is ${r}KB (over 32KB). Approaching critical threshold. Consider optimization.`),v.emit("suspend-data:warning",{bytes:n.length})):n.length>16e3?console.info(`[SCORM] â„¹ï¸ INFO: suspend_data is ${r}KB (over 16KB). Within safe limits but monitor growth.`):n.length>4096?console.info(`[SCORM] â„¹ï¸ INFO: suspend_data is ${r}KB (over 4KB). Some LMS implementations have 4KB limits.`):console.log(`[SCORM] âœ“ suspend_data size: ${r}KB (healthy)`),this.setValue("cmi.suspend_data",n)}_ensureInitialized(){if(!this.isConnected)throw new Error("SCORM API not initialized. Call initialize() first.")}_getScormError(){const e=window.doGetLastError();return e!=="0"&&e!==0&&console.warn(`[ConnectionManager] doGetLastError() returned raw code: "${e}" (Type: ${typeof e})`),e==="0"||e===0?null:e==="false"||e===!1?{code:"101",message:"General Exception (Adapter returned false)",diagnostic:'The LMS API adapter returned "false" as the error code.'}:{code:e,message:window.doGetErrorString(e),diagnostic:window.doGetDiagnostic(e)}}_throwScormError(e,n,s,r={}){const i={domain:"scorm",operation:e,message:s?`${n}: ${s.message}`:n,context:{...r,error:s}};throw v.emit("scorm:error",i),new Error(i.message)}_startKeepAlive(){this._stopKeepAlive();const e=600*1e3;this.keepAliveInterval=setInterval(()=>{if(!this.isConnected||this.isTerminated){this._stopKeepAlive();return}try{const n=window.getAPIHandle();n&&n.GetValue("cmi.mode")}catch(n){console.warn("[ConnectionManager] Keep-alive ping failed:",n)}},e),console.log("[ConnectionManager] Keep-alive mechanism started (10m interval)")}_stopKeepAlive(){this.keepAliveInterval&&(clearInterval(this.keepAliveInterval),this.keepAliveInterval=null)}_logSuspendDataDiagnostics(e){console.log("[SCORM] getValue('cmi.suspend_data') called"),console.log(`[SCORM]   Length: ${e?e.length:0}`)}_getValueRecovered(e){try{const n=window.getAPIHandle();if(!n)throw new Error("SCORM API handle lost during recovery");const s=n.GetValue(e),r=n.GetLastError?n.GetLastError().toString():"0";if(r!=="0")throw new Error(`SCORM Error ${r}`);return s||""}catch(n){this._throwScormError("GetValue (Recovered)",`Failed to get value for "${e}"`,n,{key:e})}}_setValueRecovered(e,n){try{const s=window.getAPIHandle();if(!s)throw new Error("SCORM API handle lost during recovery");const r=s.SetValue(e,n);if(!(r==="true"||r===!0)){const o=s.GetLastError?s.GetLastError().toString():"0";throw new Error(`SCORM Error ${o}`)}return!0}catch(s){this._throwScormError("SetValue (Recovered)",`Failed to set value for "${e}"`,s,{key:e})}}_commitRecovered(){try{const e=window.getAPIHandle();if(!e)throw new Error("SCORM API handle lost during recovery");const n=e.Commit("");if(!(n==="true"||n===!0)){const r=e.GetLastError?e.GetLastError().toString():"0";throw new Error(`SCORM Error ${r}`)}return!0}catch(e){this._throwScormError("Commit (Recovered)","Failed to commit",e)}}}const oe=new Gs,tt="@slides/",fn="../../../course/slides/",Ks=Object.assign({"../../../course/slides/assessment.js":()=>ae(()=>import("./assessment.js"),[],import.meta.url),"../../../course/slides/content.js":()=>ae(()=>import("./content.js"),[],import.meta.url),"../../../course/slides/intro.js":()=>ae(()=>import("./intro.js"),[],import.meta.url),"../../../course/slides/remedial.js":()=>ae(()=>import("./remedial.js"),[],import.meta.url),"../../../course/slides/summary.js":()=>ae(()=>import("./summary.js"),[],import.meta.url),"../../../course/slides/ui-demo.js":()=>ae(()=>import("./ui-demo.js"),[],import.meta.url)}),On=new Map;for(const[t,e]of Object.entries(Ks)){const n=ur(t);On.set(n,e)}async function Js(t){const e=dr(t),n=On.get(e);if(!n)throw new Error(`Failed to find slide module registered at ${e} (original: ${t})`);try{return await n()}catch(s){throw console.error(`Failed to load slide module for path: ${t}`,s),new Error(`Failed to load slide module at ${t}: ${s.message}`)}}let Pe,Ye=null;function Zs(t){return t?Array.isArray(t)?t:[t]:[]}function Xs(t){if(!t)throw new Error("normalizeControls: controls parameter is required");return{showNext:t.showNext!==!1,showPrevious:t.showPrevious!==!1,nextTarget:t.nextTarget||null,previousTarget:t.previousTarget||null,exitTarget:t.exitTarget||null}}function qt(t){return Zs(t).map(e=>e&&typeof e=="object"?{...e}:null).filter(Boolean)}function er(t){if(!t)return null;if(!t.conditions)throw new Error('Gating configuration must have a "conditions" array. Legacy "condition" property is not supported.');const e=qt(t.conditions);return e.length?{mode:t.mode==="any"?"any":"all",message:t.message||null,conditions:e}:null}function tr(t){if(!t)return null;const e=qt(t.includeWhen),n=qt(t.skipUntil),s=t.insert&&(t.insert.slideId||t.insert.anchor)?{position:t.insert.position==="after"?"after":"before",slideId:t.insert.slideId||t.insert.anchor}:null;return{includeByDefault:t.includeByDefault!==!1,includeWhen:e,skipUntil:n,insert:s,message:t.message||null}}function nr(t,e,n){if(!t)throw new Error("normalizeNavigation: nodeNavigation parameter is required");return{sequential:t.sequential!==!1,controls:Xs(t.controls||{showNext:!0,showPrevious:!0}),gating:er(t.gating),sequence:tr(t.sequence),assessmentRef:t.assessmentRef||(e==="assessment"?n:null)}}function sr(){if(!Pe)throw new Error("CourseHelpers: courseConfig not initialized. Call init() first.");if(!Array.isArray(Pe.structure))throw new Error("CourseHelpers: courseConfig.structure must be an array.");return Pe.structure}async function Le(){if(Ye)return Ye;const t=[],e={},n=[],s=new Map;async function r(i,o=0,a=n){if(Array.isArray(i))for(const l of i){if(!l||typeof l!="object")continue;if(l.type==="section"){const S=[];if(await r(l.children||[],o+1,S),l.menu&&l.menu.hidden){a.push(...S);continue}const A=l.menu?.label||l.title||l.id||"Section",L={type:"section",id:l.id||A.toLowerCase().replace(/\s+/g,"-"),label:A,icon:l.menu?.icon||null,defaultExpanded:l.menu?.defaultExpanded!==!1,collapsible:l.menu?.collapsible!==!1,level:o,children:S};a.push(L);continue}const c=l.component||l.slide||l.content||l.module;if(typeof c!="string")throw new Error(`Slide '${l.id||"unknown"}' is missing a component path string.`);const d=l.id;if(!d)throw new Error("Slide is missing an id");let f,m=null;const u=l.type==="assessment"?"assessment":"slide",g=await Js(c);if(u==="assessment"){if(!g.config||!g.slide)throw new Error(`Assessment module at ${c} must export named 'config' and 'slide' objects.`);if(typeof g.slide.render!="function")throw new Error(`Assessment 'slide' export at ${c} does not have a render function.`);if(m=g.config.id,f=g.slide,s.has(m))throw new Error(`[CourseHelpers] Duplicate assessment ID '${m}' found. Each assessment must have a unique ID in course-config.js.`);s.set(m,g.config)}else if(f=Object.values(g)[0],!f||typeof f.render!="function")throw new Error(`Slide module at ${c} does not have a valid component export with a render function.`);const p=l.title||f.title||l.menu?.label||d,h=nr(l.navigation||{},u,m),b=l.menu||{},y=t.length,w={type:u,id:d,assessmentId:m,index:y,component:f,title:p,engagement:l.engagement,navigation:h,menu:b,metadata:l.metadata||{},assessment:u==="assessment"?l.assessment||{}:null};if(t.push(w),e[d]=y,!b.hidden){const S={type:"slide",id:d,label:b.label||p,icon:b.icon||null,level:o,slideIndex:y};a.push(S)}}}return await r(sr(),0,n),Ye={slides:t,indexById:e,menuTree:n,assessmentConfigs:s},Ye}function Dn(t){return t?{...t,navigation:z(t.navigation),menu:z(t.menu),metadata:z(t.metadata),assessment:z(t.assessment)}:null}function rr(t){if(Pe)throw new Error("CourseHelpers: Already initialized. Do not call init() more than once.");if(!t)throw new Error("CourseHelpers: config parameter is required.");Pe=Object.freeze(t)}async function ir(){return(await Le()).slides.map(e=>Dn(e))}async function or(t){const e=await Le();return Dn(e.slides[t]||null)}async function zn(t){if(!t)return null;const n=(await Le()).indexById[t];return n===void 0?null:n}async function ar(t){const e=await zn(t);return e===null?null:or(e)}async function cr(){const t=await Le();return z(t.menuTree)}async function lr(t){return(await Le()).slides.filter(n=>n.type===t).map(n=>z(n))}async function Nn(){return(await Le()).assessmentConfigs}function dr(t){if(!t||typeof t!="string")throw new Error("Slide module path must be a non-empty string.");const e=t.replace(/\\/g,"/");if(e.startsWith(tt))return e;const n=e.replace(/^\.\//,"");if(n.startsWith("course/slides/"))return`${tt}${n.slice(14)}`;const s=n.indexOf("/course/slides/");return s!==-1?`${tt}${n.slice(s+15)}`:e}function ur(t){const e=t.replace(/\\/g,"/");return e.startsWith(fn)?`${tt}${e.slice(fn.length)}`:e}const mr=["true-false","choice","fill-in","long-fill-in","matching","performance","sequencing","likert","numeric","other"],fr=["correct","incorrect","unanticipated","neutral"];function gr(t){if(typeof t!="string")return!1;try{const e=new Date(t);return e.toISOString()===t||!isNaN(e.getTime())}catch{return!1}}function pr(t){return typeof t!="string"?!1:/^P(?:\d+Y)?(?:\d+M)?(?:\d+D)?(?:T(?:\d+H)?(?:\d+M)?(?:\d+(?:\.\d+)?S)?)?$/.test(t)&&t!=="P"&&t!=="PT"}function jn(t,e,n="value"){return e.includes(t)?{valid:!0,error:null}:{valid:!1,error:`Invalid ${n} "${t}". Must be one of: ${e.join(", ")}`}}function hr(t,e="value"){const n=Number(t);return isNaN(n)?{valid:!1,error:`Invalid ${e} "${t}". Must be a number`}:{valid:!0,error:null}}function yr(t,e="value"){return Array.isArray(t)?t.some(n=>typeof n!="string")?{valid:!1,error:`Field "${e}" must contain only string values`}:{valid:!0,error:null}:{valid:!1,error:`Field "${e}" must be an array`}}function br(t,e){const n=[];for(const s of e)(t[s]===void 0||t[s]===null||t[s]==="")&&n.push(`Missing required field "${s}"`);return{valid:n.length===0,errors:n}}function wr(t,e="",n="Validation failed"){const s=e?` for ${e}`:"";return`${n}${s}:
  - ${t.join(`
  - `)}`}function vr(t){return jn(t,mr,"type")}function Sr(t){return jn(t,fr,"result")}function Er(t){const e=[];return t.querySelectorAll("form").forEach(s=>{const r=s.querySelectorAll("button:not([type])");r.length>0&&e.push({message:`Found ${r.length} button(s) inside a form without a 'type' attribute`,context:{form:s.outerHTML.substring(0,200)+"...",buttons:Array.from(r).map(i=>i.outerHTML),fix:'Add type="button" to buttons that should not submit the form, or type="submit" for submit buttons.'}})}),{valid:e.length===0,errors:e}}function $r(t){const e=[];return t.querySelectorAll("[data-action]").forEach(s=>{s.tagName==="BUTTON"&&s.closest("form")&&!s.hasAttribute("type")&&e.push({message:"Button with data-action inside a form is missing type attribute",context:{button:s.outerHTML,action:s.getAttribute("data-action"),fix:'Add type="button" to prevent the button from submitting the form.'}})}),{valid:e.length===0,errors:e}}function kr(t){const e=[],n=t.querySelectorAll('a[href="#"], a[href=""]');return n.length>0&&e.push({message:`Found ${n.length} anchor tag(s) with dangerous href attribute`,context:{anchors:Array.from(n).map(s=>s.outerHTML),fix:'For internal navigation, use NavigationActions.goToSlide(). For other actions, use a <button type="button">. For external links, use a valid URL.'}}),{valid:e.length===0,errors:e}}const V={dropdown:{trigger:"toggle-dropdown",item:"select-item"},tabs:{button:"select-tab"},modal:{close:"close-modal"},interaction:{check:"check-answer",reset:"reset"}};function Pn(t){const e=[];return t.querySelectorAll('.custom-dropdown, [class*="dropdown"]').forEach(s=>{s.querySelectorAll('.dropdown-trigger, [class*="dropdown-trigger"]').forEach(o=>{if(!o.hasAttribute("data-action"))e.push({message:"Dropdown trigger is missing data-action attribute",context:{element:o.outerHTML,expected:`data-action="${V.dropdown.trigger}"`,fix:'Add data-action="toggle-dropdown" to the dropdown trigger button.'}});else{const a=o.getAttribute("data-action");a!==V.dropdown.trigger&&e.push({message:`Dropdown trigger has incorrect data-action="${a}"`,context:{element:o.outerHTML,actual:a,expected:V.dropdown.trigger,fix:`Change to data-action="${V.dropdown.trigger}".`}})}}),s.querySelectorAll('.dropdown-item, [class*="dropdown-item"]').forEach(o=>{if(!o.hasAttribute("data-action"))e.push({message:"Dropdown item is missing data-action attribute",context:{element:o.outerHTML,expected:`data-action="${V.dropdown.item}"`,fix:'Add data-action="select-item" to the dropdown item.'}});else{const a=o.getAttribute("data-action");a!==V.dropdown.item&&e.push({message:`Dropdown item has incorrect data-action="${a}"`,context:{element:o.outerHTML,actual:a,expected:V.dropdown.item,fix:`Change to data-action="${V.dropdown.item}".`}})}})}),{valid:e.length===0,errors:e}}function Bn(t){const e=[];return t.querySelectorAll('.tabs, [role="tablist"]').forEach(s=>{s.querySelectorAll('.tab-button, [role="tab"]').forEach(i=>{if(!i.hasAttribute("data-action"))e.push({message:"Tab button is missing data-action attribute",context:{element:i.outerHTML,expected:`data-action="${V.tabs.button}"`,fix:'Add data-action="select-tab" to the tab button.'}});else{const o=i.getAttribute("data-action");o!==V.tabs.button&&e.push({message:`Tab button has incorrect data-action="${o}"`,context:{element:i.outerHTML,actual:o,expected:V.tabs.button,fix:`Change to data-action="${V.tabs.button}".`}})}})}),{valid:e.length===0,errors:e}}function Ar(t){const e=[];return t.querySelectorAll('.modal, [role="dialog"]').forEach(s=>{s.querySelectorAll('.modal-close, button[aria-label*="close" i], button[aria-label*="dismiss" i]').forEach(i=>{if(!i.hasAttribute("data-action"))e.push({message:"Modal close button is missing data-action attribute",context:{element:i.outerHTML,expected:`data-action="${V.modal.close}"`,fix:'Add data-action="close-modal" to the modal close button.'}});else{const o=i.getAttribute("data-action");o!==V.modal.close&&e.push({message:`Modal close button has incorrect data-action="${o}"`,context:{element:i.outerHTML,actual:o,expected:V.modal.close,fix:`Change to data-action="${V.modal.close}".`}})}})}),{valid:e.length===0,errors:e}}function Cr(t){const e=[];return t.querySelectorAll('[data-interaction-type], .interaction, [class*="interaction-"]').forEach(s=>{const r=s.id||s.dataset.interaction||"unknown";s.querySelectorAll('.check-answer, button[class*="check"]').forEach(o=>{if(!o.hasAttribute("data-action"))e.push({message:"Interaction check button is missing data-action attribute",context:{interactionId:r,element:o.outerHTML,expected:`data-action="${V.interaction.check}"`,fix:'Add data-action="check-answer" and data-interaction="[id]" to the check button.'}});else{const a=o.getAttribute("data-action");a!==V.interaction.check&&a!==V.interaction.reset&&e.push({message:`Interaction button has incorrect data-action="${a}"`,context:{interactionId:r,element:o.outerHTML,actual:a,expected:`"${V.interaction.check}" or "${V.interaction.reset}"`,fix:'Use data-action="check-answer" or data-action="reset".'}})}o.hasAttribute("data-interaction")||e.push({message:"Interaction button is missing data-interaction attribute",context:{interactionId:r,element:o.outerHTML,fix:'Add data-interaction="[id]" to identify which interaction this button controls.'}})})}),{valid:e.length===0,errors:e}}function xr(t,e=""){const n=[];return Pn(t).errors.forEach(a=>{n.push({type:"dropdown",viewName:e,...a})}),Bn(t).errors.forEach(a=>{n.push({type:"tabs",viewName:e,...a})}),Ar(t).errors.forEach(a=>{n.push({type:"modal",viewName:e,...a})}),Cr(t).errors.forEach(a=>{n.push({type:"interaction",viewName:e,...a})}),{valid:n.length===0,errors:n}}function Ir(t,e=""){const n=[];Er(t).errors.forEach(a=>{n.push({type:"form-button",viewName:e,...a})}),$r(t).errors.forEach(a=>{n.push({type:"action-button",viewName:e,...a})}),kr(t).errors.forEach(a=>{n.push({type:"anchor",viewName:e,...a})});const o=xr(t,e);return n.push(...o.errors),{valid:n.length===0,errors:n}}const Mr=new Set(["theme","darkMode","fontSize","highContrast","reducedMotion"]),kt=Object.freeze({theme:"light",darkMode:!1,fontSize:"normal",highContrast:!1,reducedMotion:!1});class Tr{constructor(){this.state={...kt},this.isInitialized=!1,this.DOMAIN_KEY="accessibility",this.SOURCE="accessibility-manager",this.elements={themeToggle:null,fontSizeToggle:null,highContrastToggle:null,reducedMotionToggle:null,accessibilityMenu:null,accessibilityButton:null}}initialize(){if(this.isInitialized)throw new Error("AccessibilityManager: Already initialized. Do not call initialize() more than once.");try{this._loadState(),this._getDOMElements(),this._updateUI(),this._setupEventListeners(),this._initializeAccessibilityMenu(),this.isInitialized=!0,console.log("AccessibilityManager Initialized",this.state),v.emit("accessibility:initialized",this.state)}catch(e){throw console.error("[AccessibilityManager] Initialization failed:",e),e}}setPreference(e,n){if(!Mr.has(e))throw new Error(`AccessibilityManager: Unknown preference key: ${e}`);const s={...this.state};e==="theme"?(s.theme=n==="dark"?"dark":"light",s.darkMode=s.theme==="dark"):e==="darkMode"?(s.darkMode=!!n,s.theme=s.darkMode?"dark":"light"):s[e]=n,this.state=s,this._updateUI(),k.setDomainState(this.DOMAIN_KEY,this.state,{source:this.SOURCE}),v.emit("accessibility:changed",{key:e,value:this.state[e]})}getState(){return{...this.state}}announce(e,n="polite"){if(!e)return;let s=document.getElementById("sr-announcements");s||(s=document.createElement("div"),s.id="sr-announcements",s.setAttribute("role","status"),s.setAttribute("aria-atomic","true"),s.className="sr-only",document.body.appendChild(s)),s.setAttribute("aria-live","off"),s.textContent="",s.offsetWidth,s.setAttribute("aria-live",n),s.textContent=e}setupKeyboardNav(e,n){const s=Array.from(n);if(s.length===0)return;let r=0;const i=()=>{s.forEach((o,a)=>{o.classList.toggle("keyboard-focus",a===r)})};e.addEventListener("keydown",o=>{let a=r;switch(o.key){case"ArrowRight":case"ArrowDown":o.preventDefault(),a=(r+1)%s.length;break;case"ArrowLeft":case"ArrowUp":o.preventDefault(),a=(r-1+s.length)%s.length;break;case"Home":o.preventDefault(),a=0;break;case"End":o.preventDefault(),a=s.length-1;break;default:return}r=a,s[r].focus(),i()}),s[0].focus(),i()}_loadState(){const e=k.getDomainState(this.DOMAIN_KEY);e&&typeof e=="object"?this.state={...kt,...e}:this.state={...kt}}_getDOMElements(){this.elements.themeToggle=document.getElementById("theme-toggle"),this.elements.fontSizeToggle=document.getElementById("font-size-toggle"),this.elements.highContrastToggle=document.getElementById("high-contrast-toggle"),this.elements.reducedMotionToggle=document.getElementById("reduced-motion-toggle"),this.elements.accessibilityMenu=document.getElementById("accessibility-menu"),this.elements.accessibilityButton=document.getElementById("accessibility-button")}_setupEventListeners(){this.elements.themeToggle&&this.elements.themeToggle.addEventListener("click",()=>{const e=this.state.theme==="light"?"dark":"light";this.setPreference("theme",e),this.announce(`Switched to ${e} mode`)}),this.elements.fontSizeToggle&&this.elements.fontSizeToggle.addEventListener("click",()=>{const e=this.state.fontSize==="normal"?"large":"normal";this.setPreference("fontSize",e),this.announce(`Font size set to ${e}`)}),this.elements.highContrastToggle&&this.elements.highContrastToggle.addEventListener("click",()=>{const e=!this.state.highContrast;this.setPreference("highContrast",e),this.announce(`High contrast ${e?"enabled":"disabled"}`)}),this.elements.reducedMotionToggle&&this.elements.reducedMotionToggle.addEventListener("click",()=>{const e=!this.state.reducedMotion;this.setPreference("reducedMotion",e),this.announce(`Animations ${e?"reduced":"enabled"}`)})}_initializeAccessibilityMenu(){const{accessibilityButton:e,accessibilityMenu:n}=this.elements;if(!e||!n)return;let s=!1;const r=i=>{s=i,n.hidden=!i,e.setAttribute("aria-expanded",String(i)),i?(this.announce("Accessibility menu opened"),n.querySelector("button")?.focus()):this.announce("Accessibility menu closed")};e.addEventListener("click",()=>r(!s)),document.addEventListener("keydown",i=>{i.key==="Escape"&&s&&(r(!1),e.focus())}),document.addEventListener("click",i=>{s&&!n.contains(i.target)&&!e.contains(i.target)&&r(!1)})}_updateUI(){const e=document.documentElement;e&&(e.setAttribute("data-theme",this.state.theme),e.setAttribute("data-font-size",this.state.fontSize),e.setAttribute("data-high-contrast",String(this.state.highContrast)),e.setAttribute("data-reduced-motion",String(this.state.reducedMotion)),this._updateButtonStates())}_updateButtonStates(){const{themeToggle:e,fontSizeToggle:n,highContrastToggle:s,reducedMotionToggle:r}=this.elements;if(e){const i=e.querySelector("span");i&&(i.textContent=this.state.theme==="dark"?"â˜€ï¸":"ðŸŒ™"),e.setAttribute("aria-label",this.state.theme==="dark"?"Switch to light mode":"Switch to dark mode"),e.classList.toggle("active",this.state.theme==="dark")}n&&(n.setAttribute("aria-label",this.state.fontSize==="large"?"Decrease font size":"Increase font size"),n.classList.toggle("active",this.state.fontSize==="large")),s&&(s.setAttribute("aria-label",this.state.highContrast?"Disable high contrast":"Enable high contrast"),s.classList.toggle("active",this.state.highContrast)),r&&(r.setAttribute("aria-label",this.state.reducedMotion?"Enable animations":"Reduce animations"),r.classList.toggle("active",this.state.reducedMotion))}}const ye=new Tr,Fn="navigation",_r="navigation-state";let gn=!1,te={currentSlideIndex:0,visitedSlides:[]},Be=[];function qr(){if(gn)throw new Error("NavigationState: Already initialized. Do not call initializeNavigationState() more than once.");const t=k.getDomainState(Fn);try{k.getValue("cmi.entry")==="resume"&&!t&&console.warn("[NavigationState] WARNING: Resuming course but no navigation state found in suspend_data.")}catch{}if(t){if(console.log("[NavigationState] Restoring state from LMS:",t),t.currentSlideIndex!==void 0&&t.currentSlideIndex!==null){const e=Number(t.currentSlideIndex);!isNaN(e)&&e>=0&&(te.currentSlideIndex=e)}Array.isArray(t.visitedSlides)&&(te.visitedSlides=[...t.visitedSlides])}else console.log("[NavigationState] No persisted state found. Using default state.");gn=!0,console.log("[NavigationState] Initialized:",te)}function de(){return te.currentSlideIndex}function Lr(t){if(!Array.isArray(t)||t.length===0)throw new Error("NavigationState: Invalid slides array. Must be non-empty array.");Be=t}function ne(){const t=Be[te.currentSlideIndex];return t?t.id:null}function Vn(t){if(typeof t!="number"||t<0)throw new Error(`NavigationState: Invalid slide index provided: ${t}`);if(Be.length>0&&t>=Be.length)throw new Error(`NavigationState: Slide index ${t} exceeds bounds (max: ${Be.length-1})`);te.currentSlideIndex=t,Vt()}function Qe(){return[...te.visitedSlides]}function Ft(t){t&&!te.visitedSlides.includes(t)&&(te.visitedSlides.push(t),Vt())}function Rr(){te.visitedSlides=[],Vt()}function Vt(){k.setDomainState(Fn,te,{source:_r})}class Or{constructor(){this.domain="engagement",this.isInitialized=!1,this.courseConfig=null}initialize(e){if(!this.isInitialized){if(!e||!e.structure)throw new Error("[EngagementManager] courseConfig with structure is REQUIRED");this.courseConfig=e,v.on("flag:updated",this._handleFlagUpdate.bind(this)),v.on("flag:removed",this._handleFlagUpdate.bind(this)),v.on("interaction:recorded",n=>{const s=ne();if(s){const r=n.result==="correct";this.trackInteraction(s,n.id,!0,r)}}),this.isInitialized=!0,console.log("[EngagementManager] Initialized (refactored v2.0)")}}_getRequirementsFromConfig(e){if(!this.courseConfig||!this.courseConfig.structure)throw new Error(`[EngagementManager] CRITICAL: courseConfig not available when looking up slide: ${e}`);const n=r=>{for(const i of r){if(i.id===e)return i;if(i.children){const o=n(i.children);if(o)return o}}return null},s=n(this.courseConfig.structure);if(!s)throw new Error(`[EngagementManager] CRITICAL: Slide "${e}" not found in courseConfig.structure`);if(!s.engagement)throw new Error(`[EngagementManager] CRITICAL: Slide "${e}" has no engagement config in courseConfig`);return s.engagement}initSlide(e,n){if(!e||typeof e!="string")throw new Error("[EngagementManager] slideId must be a non-empty string");if(!n||typeof n!="object")throw new Error(`[EngagementManager] Slide "${e}" has invalid engagement requirements`);if(!(n.required||!1)){console.log(`[EngagementManager] Slide "${e}" does not require tracking, skipping state initialization`),v.emit("engagement:initialized",{slideId:e,requirements:n});return}const r=this._getState();r[e]?.complete===!0?(r[e].required=!0,console.log(`[EngagementManager] Slide "${e}" was already completed`)):(r[e]={required:!0,tracked:{tabsViewed:[],tabsTotal:0,accordionPanelsViewed:[],accordionPanelsTotal:0,interactionsCompleted:{},scrollDepth:0},complete:!1,completedAt:null},console.log(`[EngagementManager] Initialized tracking for: ${e}`)),this._setState(r),v.emit("engagement:initialized",{slideId:e,requirements:n})}cleanupSlide(e){if(!e)return;const n=this.evaluateRequirements(e);n.complete||v.emit("engagement:incomplete",{slideId:e,unmetRequirements:n.unmetRequirements}),console.log(`[EngagementManager] Cleaned up: ${e}`,n)}registerTabs(e,n){if(!e||!Array.isArray(n))return;const s=this._getState();s[e]&&(s[e].tracked.tabsTotal=n.length,this._setState(s),console.log(`[EngagementManager] Registered ${n.length} tabs: ${e}`),this._checkAndEmitProgress(e))}trackTabView(e,n){if(!e||!n)return;const s=this._getState();if(!s[e])return;const r=s[e].tracked;r.tabsViewed.includes(n)||(r.tabsViewed.push(n),this._setState(s),console.log(`[EngagementManager] Tab viewed: ${n} (${r.tabsViewed.length}/${r.tabsTotal})`),this._checkAndEmitProgress(e))}registerAccordion(e,n){if(!e||!Array.isArray(n))return;const s=this._getState();s[e]&&(s[e].tracked.accordionPanelsTotal=n.length,this._setState(s),console.log(`[EngagementManager] Registered ${n.length} accordion panels: ${e}`),this._checkAndEmitProgress(e))}trackAccordionPanel(e,n){if(!e||!n)return;const s=this._getState();if(!s[e])return;const r=s[e].tracked;r.accordionPanelsViewed.includes(n)||(r.accordionPanelsViewed.push(n),this._setState(s),console.log(`[EngagementManager] Panel viewed: ${n} (${r.accordionPanelsViewed.length}/${r.accordionPanelsTotal})`),this._checkAndEmitProgress(e))}trackInteraction(e,n,s,r){if(!e||!n)return;const i=this._getState();i[e]&&(i[e].tracked.interactionsCompleted[n]={completed:s,correct:r,timestamp:Date.now()},this._setState(i),console.log(`[EngagementManager] Interaction: ${n} (completed: ${s}, correct: ${r})`),this._checkAndEmitProgress(e))}trackScrollDepth(e,n){if(!e||typeof n!="number")return;const s=this._getState();if(!s[e])return;const r=s[e].tracked.scrollDepth;n>r&&(s[e].tracked.scrollDepth=Math.min(100,Math.max(0,n)),this._setState(s),console.log(`[EngagementManager] Scroll: ${n}% for ${e}`),this._checkAndEmitProgress(e))}evaluateRequirements(e){const n=this._getState(),s=n[e];if(!s)try{return{complete:!(this._getRequirementsFromConfig(e)?.required||!1),progress:{},unmetRequirements:[]}}catch{return{complete:!0,progress:{},unmetRequirements:[]}}if(!(s.required||!1))return{complete:!0,progress:{},unmetRequirements:[]};const i=this._getRequirementsFromConfig(e),o=i.requirements||[],a=i.mode||"all",l=[];for(const d of o){const f=this._evaluateRequirement(e,d,s.tracked);f.met||l.push(f)}const c=a==="all"?l.length===0:l.length<o.length;return c&&!s.complete&&(s.complete=!0,s.completedAt=Date.now(),this._setState(n),v.emit("engagement:complete",{slideId:e})),{complete:c,progress:this._calculateProgress(e,s.tracked,o),unmetRequirements:l}}_evaluateRequirement(e,n,s){const r=n.type;switch(r){case"viewAllTabs":{const i=s.tabsTotal;return{met:i>0&&s.tabsViewed.length>=i,type:r,message:n.message,viewed:s.tabsViewed.length,total:i}}case"viewAllPanels":{const i=s.accordionPanelsTotal;return{met:i>0&&s.accordionPanelsViewed.length>=i,type:r,message:n.message,viewed:s.accordionPanelsViewed.length,total:i}}case"interactionComplete":{const i=n.interactionId,o=s.interactionsCompleted[i],a=o?.completed||!1,l=o?.correct||!1;return{met:n.requireCorrect?a&&l:a,type:r,message:n.message,interactionId:i,completed:a,correct:l}}case"allInteractionsComplete":{const i=Object.values(s.interactionsCompleted).filter(d=>n.requireCorrect?d.completed&&d.correct:d.completed).length,l=(window.SCORM_Framework?.interactionRegistry?.getAll()||[]).length;return{met:l>0&&i>=l,type:r,message:n.message,completed:i,total:l}}case"scrollDepth":{const i=n.percentage||n.minPercentage||95;return{met:s.scrollDepth>=i,type:r,message:n.message,current:s.scrollDepth,required:i}}case"timeOnSlide":{const a=((k.getDomainState("sessionData")||{}).slideDurations||{})[e]||0,l=Math.floor(a/1e3),c=n.minSeconds||0;return{met:l>=c,type:r,message:n.message,current:l,required:c}}case"flag":{const o=(k.getDomainState("flags")||{})[n.key];let a=!1;return n.equals!==void 0?a=o===n.equals:a=!!o,{met:a,type:r,message:n.message||`Flag "${n.key}" must be set`,flagKey:n.key,currentValue:o,requiredValue:n.equals}}case"allFlags":{const i=k.getDomainState("flags")||{},o=n.flags||[],a=o.map(d=>{const f=typeof d=="string"?d:d.key,m=i[f];let u=!1;return typeof d=="object"&&d.equals!==void 0?u=m===d.equals:u=!!m,{key:f,met:u,value:m}}),l=a.filter(d=>d.met).length;return{met:l===o.length,type:r,message:n.message||"Complete all required steps",flags:a,completed:l,total:o.length}}default:throw new Error(`[EngagementManager] Unknown requirement type: ${r}. Valid types: viewAllTabs, viewAllPanels, interactionComplete, allInteractionsComplete, scrollDepth, timeOnSlide, flag, allFlags.`)}}_calculateProgress(e,n,s){const r=[];let i=0;for(const a of s){const l=this._evaluateRequirement(e,a,n);let c=l.met?1:0;if(!l.met)switch(a.type){case"viewAllTabs":n.tabsTotal>0&&(c=n.tabsViewed.length/n.tabsTotal);break;case"viewAllPanels":n.accordionPanelsTotal>0&&(c=n.accordionPanelsViewed.length/n.accordionPanelsTotal);break;case"allInteractionsComplete":const m=(window.SCORM_Framework?.interactionRegistry?.getAll()||[]).length;m>0&&(c=Object.values(n.interactionsCompleted).filter(S=>a.requireCorrect?S.completed&&S.correct:S.completed).length/m);break;case"scrollDepth":const u=a.percentage||a.minPercentage||95;c=Math.min(1,n.scrollDepth/u);break;case"timeOnSlide":const h=((k.getDomainState("sessionData")||{}).slideDurations||{})[e]||0,b=Math.floor(h/1e3),y=a.minSeconds||0;c=y>0?Math.min(1,b/y):0;break;case"flag":c=l.met?1:0;break;case"allFlags":l.total>0&&(c=l.completed/l.total);break}r.push({type:a.type,label:a.message||this._getDefaultLabel(a.type),complete:l.met}),i+=c}return{percentage:s.length>0?Math.round(i/s.length*100):100,items:r}}_getDefaultLabel(e){return{viewAllTabs:"View all tabs",viewAllPanels:"View all accordion panels",interactionComplete:"Complete interaction",allInteractionsComplete:"Complete all interactions",scrollDepth:"Scroll to bottom",timeOnSlide:"Spend required time",flag:"Complete required step",allFlags:"Complete all required steps"}[e]||e}isSlideComplete(e){return this.evaluateRequirements(e).complete}getSlideState(e){return this._getState()[e]||null}getProgress(e){const n=this.getSlideState(e);if(!n)return null;const r=this._getRequirementsFromConfig(e)?.requirements||[];return this._calculateProgress(e,n.tracked,r)}resetSlide(e){const n=this._getState();if(!n[e])return;const s=this._getRequirementsFromConfig(e);if(!s)throw new Error(`[EngagementManager] No requirements found for slide: ${e}. Ensure slide has engagement config in course-config.js.`);delete n[e],this._setState(n),this.initSlide(e,s),console.log(`[EngagementManager] Reset: ${e}`)}resetAllSlides(){this._setState({}),console.log("[EngagementManager] Reset all engagement"),v.emit("engagement:reset-all")}_handleFlagUpdate({key:e,value:n}){const s=this._getState();Object.entries(s).forEach(([r,i])=>{const o=this._getRequirementsFromConfig(r);if(!o||!o.required||i.complete)return;o.requirements?.some(l=>l.type==="flag"||l.type==="allFlags")&&(console.log(`[EngagementManager] Flag "${e}" updated, re-evaluating: ${r}`),this._checkAndEmitProgress(r))})}_checkAndEmitProgress(e){const n=this.evaluateRequirements(e);v.emit("engagement:progress",{slideId:e,complete:n.complete,progress:n.progress})}_getState(){const e=k.getDomainState(this.domain)||{};return this._mergeWithDefaults(e)}_mergeWithDefaults(e){const n={};for(const[s,r]of Object.entries(e))n[s]={required:r.required||!1,tracked:{tabsViewed:r.tracked?.tabsViewed||[],tabsTotal:r.tracked?.tabsTotal||0,accordionPanelsViewed:r.tracked?.accordionPanelsViewed||[],accordionPanelsTotal:r.tracked?.accordionPanelsTotal||0,interactionsCompleted:r.tracked?.interactionsCompleted||{},scrollDepth:r.tracked?.scrollDepth||0},complete:r.complete||!1,completedAt:r.completedAt||null};return n}_setState(e){try{const n=this._stripDefaultValues(e);k.setDomainState(this.domain,n)}catch(n){console.error("[EngagementManager] Failed to save state:",n)}}_stripDefaultValues(e){const n={};for(const[s,r]of Object.entries(e)){const i={required:r.required};if(r.tracked){const o={};r.tracked.tabsViewed?.length>0&&(o.tabsViewed=r.tracked.tabsViewed),r.tracked.tabsTotal>0&&(o.tabsTotal=r.tracked.tabsTotal),r.tracked.accordionPanelsViewed?.length>0&&(o.accordionPanelsViewed=r.tracked.accordionPanelsViewed),r.tracked.accordionPanelsTotal>0&&(o.accordionPanelsTotal=r.tracked.accordionPanelsTotal),r.tracked.interactionsCompleted&&Object.keys(r.tracked.interactionsCompleted).length>0&&(o.interactionsCompleted=r.tracked.interactionsCompleted),r.tracked.scrollDepth>0&&(o.scrollDepth=r.tracked.scrollDepth),Object.keys(o).length>0&&(i.tracked=o)}i.complete=r.complete||!1,r.completedAt&&(i.completedAt=r.completedAt),n[s]=i}return n}}const H=new Or;function Dr(t,e={}){const n=typeof t=="string"?document.querySelector(t):t;if(!n)throw new Error("UIComponents.initAccordion: container not found");const s=n.id,r=n.dataset.mode||"multi",i=typeof e.onToggle=="function"?e.onToggle:null;if(!s)throw new Error("UIComponents.initAccordion: The accordion container element must have an ID.");if(r!=="single"&&r!=="multi")throw new Error('UIComponents.initAccordion: data-mode attribute must be "single" or "multi"');if(n.querySelectorAll(".accordion-item").length===0){const y=Array.from(n.children).filter(w=>w.hasAttribute("data-title"));y.length>0&&y.forEach((w,S)=>{const E=w.getAttribute("data-title"),A=w.innerHTML,L=`item-${S+1}`,q=document.createElement("div");q.className="accordion-item",q.setAttribute("data-panel-id",L),q.innerHTML=`
                    <button class="accordion-button collapsed" data-panel="${L}" data-action="toggle-accordion-panel">
                        <span class="accordion-title">${E}</span>
                        <span class="accordion-icon"></span>
                    </button>
                    <div id="${s}-panel-${L}" class="accordion-content" hidden>
                        <div class="accordion-body">${A}</div>
                    </div>
                `,n.replaceChild(q,w)})}const o=Array.from(n.querySelectorAll(".accordion-button")),a=Array.from(n.querySelectorAll(".accordion-item")).map(y=>{const w=y.querySelector(".accordion-button");return{id:y.dataset.panelId||w?.dataset.panel,title:y.querySelector(".accordion-title")?.textContent||""}});if(!o.length)return{destroy:()=>{}};const l=[];if(o.forEach((y,w)=>{const S=y.dataset.panel;if(!S){l.push(`Button ${w+1} is missing data-panel attribute.`);return}n.querySelector(`#${s}-panel-${S}`)||l.push(`Panel content not found for button ${w+1} (expected id="${s}-panel-${S}").`)}),l.length>0)throw new Error(`UIComponents.initAccordion: Invalid structure in #${s}:
${l.join(`
`)}`);const c=new Set(o.filter(y=>y.getAttribute("aria-expanded")==="true").map(y=>y.dataset.panel));o.forEach(y=>{const w=y.dataset.panel,S=n.querySelector(`#${s}-panel-${w}`);y.hasAttribute("aria-expanded")||y.setAttribute("aria-expanded","false"),!y.hasAttribute("aria-controls")&&S&&y.setAttribute("aria-controls",S.id),S&&(S.hasAttribute("role")||S.setAttribute("role","region"),!S.hasAttribute("aria-labelledby")&&y.id&&S.setAttribute("aria-labelledby",y.id))});const d=ne();if(d){const y=a.map(w=>w.id);H.registerAccordion(d,y)}function f(y){const w=n.querySelector(`[data-panel="${y}"]`),S=n.querySelector(`#${s}-panel-${y}`);if(!w||!S)return;const E=c.has(y);r==="single"&&!E&&c.forEach(A=>{A!==y&&u(A,!1)}),E?u(y):m(y),d&&!E&&H.trackAccordionPanel(d,y),i&&i({panelId:y,isOpen:!E,mode:r})}function m(y,w=!0){const S=n.querySelector(`[data-panel="${y}"]`),E=n.querySelector(`#${s}-panel-${y}`);if(!(!S||!E)&&(c.add(y),S.classList.remove("collapsed"),S.setAttribute("aria-expanded","true"),E.classList.add("show"),E.removeAttribute("hidden"),w)){const A=S.querySelector(".accordion-title")?.textContent||"Panel";ee(`${A} expanded`)}}function u(y,w=!0){const S=n.querySelector(`[data-panel="${y}"]`),E=n.querySelector(`#${s}-panel-${y}`);if(!(!S||!E)&&(c.delete(y),S.classList.add("collapsed"),S.setAttribute("aria-expanded","false"),E.classList.remove("show"),E.setAttribute("hidden","hidden"),w)){const A=S.querySelector(".accordion-title")?.textContent||"Panel";ee(`${A} collapsed`)}}function g(){if(r==="single")throw new Error('UIComponents.initAccordion: openAll() is not available in single mode. Use mode="multi" or call togglePanel() individually.');a.forEach(y=>m(y.id,!1)),ee("All panels expanded")}function p(){a.forEach(y=>u(y.id,!1)),ee("All panels collapsed")}const h=y=>{const w=y.target.closest('[data-action="toggle-accordion-panel"]');if(!w)return;y.preventDefault();const S=w.dataset.panel;S&&f(S)},b=y=>{const w=y.target.closest(".accordion-button");if(!w)return;const S=o.indexOf(w);switch(y.key){case"ArrowDown":case"ArrowRight":y.preventDefault();const E=(S+1)%o.length;o[E].focus();break;case"ArrowUp":case"ArrowLeft":y.preventDefault();const A=(S-1+o.length)%o.length;o[A].focus();break;case"Home":y.preventDefault(),o[0].focus();break;case"End":y.preventDefault(),o[o.length-1].focus();break}};return n.addEventListener("click",h),n.addEventListener("keydown",b),{togglePanel:f,openPanel:m,closePanel:u,openAll:g,closeAll:p,getOpenPanels:()=>Array.from(c),destroy:()=>{n.removeEventListener("click",h),n.removeEventListener("keydown",b)}}}const re=new Map;let pn=!1;function zr(){pn||(document.addEventListener("click",t=>{if(!t.target.closest(".dropdown-trigger"))for(const[e,n]of re.entries())n.menu.classList.contains("active")&&!n.element.contains(t.target)&&Re(e)}),pn=!0)}function Nr(t){return t?t instanceof Element?t:typeof t=="string"?document.querySelector(t):null:null}function Hn(t,e={}){zr();const n=Nr(t);if(!n)throw new Error(`Dropdown with selector "${t}" not found`);const s=n.id;if(!s)throw new Error("Dropdown container element must have an ID.");const r=n.querySelector(".dropdown-trigger"),i=n.querySelector(".dropdown-menu"),o=n.querySelectorAll(".dropdown-item");if(!r||!i)throw new Error(`Dropdown "${s}" missing required elements (.dropdown-trigger or .dropdown-menu)`);const a=Pn(n);if(!a.valid){const c=a.errors.map(d=>`${d.message}: ${d.context.fix}`).join("; ");throw new Error(`Dropdown "${s}" validation failed: ${c}`)}const l={onChange:e.onChange||null,...e};return re.set(s,{element:n,trigger:r,menu:i,items:o,config:l}),r.setAttribute("aria-haspopup","listbox"),r.setAttribute("aria-expanded","false"),o.forEach(c=>{c.setAttribute("role","option"),c.setAttribute("tabindex","0")}),n.addEventListener("click",c=>{const d=c.target.closest("[data-action]");if(!d)return;const f=d.dataset.action;if(f==="toggle-dropdown"){for(const[m]of re.entries())m!==s&&Re(m);jr(s)}else if(f==="select-item"){const m=Array.from(o).indexOf(d);m>-1&&Un(s,m)}}),i.addEventListener("keydown",c=>Br(s,c)),{destroy:()=>{re.delete(s)}}}function jr(t){const e=re.get(t);if(!e)return;e.menu.classList.contains("active")?Re(t):Pr(t)}function Pr(t){const e=re.get(t);if(e){for(const[n]of re.entries())n!==t&&Re(n);e.menu.classList.add("active"),e.trigger.classList.add("active"),e.trigger.setAttribute("aria-expanded","true")}}function Re(t){const e=re.get(t);e&&(e.menu.classList.remove("active"),e.trigger.classList.remove("active"),e.trigger.setAttribute("aria-expanded","false"))}function Un(t,e){const n=re.get(t);if(!n)return;const{items:s,trigger:r,config:i}=n,o=s[e];s.forEach(c=>c.classList.remove("selected")),o.classList.add("selected");const a=r.querySelector(".dropdown-text")||r;a.textContent=o.textContent,Re(t),r.focus(),i.onChange&&i.onChange(o.dataset.value||o.textContent,e);const l=new CustomEvent("dropdown:change",{bubbles:!0,detail:{value:o.dataset.value||o.textContent,index:e,text:o.textContent}});n.element.dispatchEvent(l)}function Br(t,e){const n=re.get(t);if(!n)return;const{items:s,trigger:r}=n,i=Array.from(s).indexOf(document.activeElement);switch(e.key){case"ArrowDown":e.preventDefault(),i<s.length-1&&s[i+1].focus();break;case"ArrowUp":e.preventDefault(),i>0&&s[i-1].focus();break;case"Escape":e.preventDefault(),Re(t),r.focus();break;case"Enter":case" ":e.preventDefault(),i>-1&&Un(t,i);break}}let Y=null,Ht=null,Ut=null,Wt=null,Fe=null,ge={},nt=null,ct=!1;function Wn(){if(!ct){if(Y=document.getElementById("global-modal"),Fe=document.querySelector(".modal-backdrop"),!Y||!Fe)throw new Error("Modal elements (#global-modal, .modal-backdrop) not found in the DOM.");Ht=document.getElementById("global-modal-title"),Ut=document.getElementById("global-modal-body"),Wt=document.getElementById("global-modal-footer"),Y.addEventListener("click",t=>{t.target.closest('[data-action="close-modal"]')&&we()}),Fe.addEventListener("click",()=>{ge.closeOnBackdrop&&we()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&isVisible()&&ge.closeOnEscape&&we()}),ct=!0}}function Qn(t){t.addEventListener("click",()=>{const e=t.dataset.title||"Modal";let n=t.dataset.body||"",s=t.dataset.footer||'<button class="btn btn-secondary" data-action="close-modal">Close</button>';if(n.startsWith("#")){const r=document.querySelector(n);r&&(n=r.innerHTML)}if(s.startsWith("#")){const r=document.querySelector(s);r&&(s=r.innerHTML)}ft({title:e,body:n,footer:s,config:{closeOnBackdrop:t.dataset.closeOnBackdrop!=="false",closeOnEscape:t.dataset.closeOnEscape!=="false"}})})}function ft({title:t,body:e,footer:n="",config:s={},onOpen:r,onClose:i}){if(!ct)throw new Error("Modal system not initialized. Call init() first.");ge={closeOnBackdrop:s.closeOnBackdrop!==!1,closeOnEscape:s.closeOnEscape!==!1,onOpen:r,onClose:i},Ht.textContent=t,Ut.innerHTML=e,Wt.innerHTML=n,nt=document.activeElement,Fe.classList.add("active"),Y.classList.add("active"),Y.setAttribute("aria-hidden","false"),setTimeout(()=>{const o=Y.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');o.length>0&&o[0].focus()},100),Y._focusTrapCleanup=Us(Y),ge.onOpen&&ge.onOpen(Y),ee(`Modal opened: ${t}`)}function we(){!ct||!Y.classList.contains("active")||(Y.classList.remove("active"),Y.setAttribute("aria-hidden","true"),Fe.classList.remove("active"),Y._focusTrapCleanup&&typeof Y._focusTrapCleanup=="function"&&(Y._focusTrapCleanup(),Y._focusTrapCleanup=null),nt&&(nt.focus(),nt=null),ge.onClose&&ge.onClose(Y),Ht.textContent="",Ut.innerHTML="",Wt.innerHTML="",ge={},ee("Modal closed"))}const Fr=Object.freeze(Object.defineProperty({__proto__:null,hide:we,init:Wn,initModalTrigger:Qn,show:ft},Symbol.toStringTag,{value:"Module"}));function Vr(t){if(!t)throw new Error("initAlert: alertElement not found.");const e=t.querySelector('[data-action="dismiss-alert"]');if(!e)return{destroy:()=>{}};const n=()=>{t.style.opacity="0",t.style.transition="opacity 0.3s ease-out, transform 0.3s ease-out, max-height 0.3s 0.1s, padding 0.3s 0.1s, margin 0.3s 0.1s",t.style.transform="scaleY(0.8)",t.style.maxHeight="0",t.style.paddingTop="0",t.style.paddingBottom="0",t.style.marginTop="0",t.style.marginBottom="0",t.style.borderWidth="0",setTimeout(()=>{t.remove()},400)};return e.addEventListener("click",n),{destroy:()=>{e.removeEventListener("click",n)}}}function Hr(t){if(!t)throw new Error("initCollapse: container not found.");const e=t.querySelector('[data-action="toggle-collapse"]');if(!e)throw new Error('initCollapse: No trigger found with data-action="toggle-collapse". Ensure collapse trigger button exists.');const n=e.getAttribute("aria-controls"),s=n?t.querySelector(`#${n}`):null;if(!s)throw new Error(`initCollapse: No panel found with ID "${n}". Ensure trigger's aria-controls matches panel ID.`);const r=e.getAttribute("aria-expanded")==="true";s.style.maxHeight=r?`${s.scrollHeight}px`:"0",t.classList.toggle("expanded",r);const i=()=>{const o=e.getAttribute("aria-expanded")==="true";e.setAttribute("aria-expanded",!o),t.classList.toggle("expanded",!o),o?s.style.maxHeight="0":(s.style.display="block",s.style.maxHeight=`${s.scrollHeight}px`)};return s.addEventListener("transitionend",()=>{e.getAttribute("aria-expanded")==="false"&&(s.style.display="none")}),e.getAttribute("aria-expanded")==="false"?s.style.display="none":s.style.display="block",e.addEventListener("click",i),{destroy:()=>{e.removeEventListener("click",i)}}}function hn(t,e){const n=typeof t=="string"?document.getElementById(t):t;if(!n){console.error("updateProgress: Element not found.",t);return}const s=n.querySelector(".progress-bar-fill"),r=n.querySelector(".progress-bar-text"),i=Math.max(0,Math.min(100,e));n.style.setProperty("--progress-percent",`${i}%`),n.setAttribute("aria-valuenow",i),s&&(s.style.width=`${i}%`),r&&(r.textContent=`${Math.round(i)}%`)}function Ur(t){if(!t)throw new Error("initProgress: element not found.");const e=parseFloat(t.dataset.initialValue)||0;return hn(t,e),{update:n=>hn(t,n),destroy:()=>{}}}let J=null;function Yn(){J||(J=document.createElement("div"),J.className="tooltip-container",J.setAttribute("role","tooltip"),document.body.appendChild(J))}function Wr(t){J||Yn();const e=t.getAttribute("data-tooltip");e&&(J.textContent=e,J.classList.add("active"),Yr(t))}function Qr(){J&&J.classList.remove("active")}function Yr(t){const e=t.getBoundingClientRect(),n=J.getBoundingClientRect(),s=t.dataset.tooltipPosition||"bottom",r=8;let i,o;switch(s){case"top":i=e.top-n.height-r,o=e.left+e.width/2-n.width/2;break;case"right":i=e.top+e.height/2-n.height/2,o=e.right+r;break;case"left":i=e.top+e.height/2-n.height/2,o=e.left-n.width-r;break;case"bottom":default:i=e.bottom+r,o=e.left+e.width/2-n.width/2;break}o<0&&(o=r),o+n.width>window.innerWidth&&(o=window.innerWidth-n.width-r),i<0&&(i=r),i+n.height>window.innerHeight&&(i=window.innerHeight-n.height-r),J.style.top=`${i+window.scrollY}px`,J.style.left=`${o+window.scrollX}px`}function Gr(t){if(!t)return;Yn();const e=t.querySelectorAll("[data-tooltip]");return e.forEach(n=>{const s=()=>Wr(n),r=()=>Qr();n.addEventListener("mouseenter",s),n.addEventListener("focus",s),n.addEventListener("mouseleave",r),n.addEventListener("blur",r),n._tooltipListeners={show:s,hide:r}}),{destroy:()=>{e.forEach(n=>{n._tooltipListeners&&(n.removeEventListener("mouseenter",n._tooltipListeners.show),n.removeEventListener("focus",n._tooltipListeners.show),n.removeEventListener("mouseleave",n._tooltipListeners.hide),n.removeEventListener("blur",n._tooltipListeners.hide),delete n._tooltipListeners)})}}}function Kr(t){if(!t)throw new Error("initCarousel: container not found.");const e=t.querySelector(".carousel-track"),n=Array.from(t.querySelectorAll(".carousel-slide")),s=t.querySelector('[data-action="prev-slide"]'),r=t.querySelector('[data-action="next-slide"]'),i=t.querySelector(".carousel-dots");if(!e||!n.length)throw new Error("initCarousel: A track and slides are required. Ensure carousel HTML structure is correct with .carousel-track and .carousel-slide elements.");let o=0;const a=()=>{e.style.transform=`translateX(-${o*100}%)`,s&&(s.disabled=o===0),r&&(r.disabled=o===n.length-1),i&&Array.from(i.children).forEach((f,m)=>{f.classList.toggle("active",m===o)}),n.forEach((d,f)=>{d.setAttribute("aria-hidden",f!==o)})},l=d=>{d<0||d>=n.length||(o=d,a())};i&&(i.innerHTML="",n.forEach((d,f)=>{const m=document.createElement("button");m.className="carousel-dot",m.setAttribute("aria-label",`Go to slide ${f+1}`),m.addEventListener("click",()=>l(f)),i.appendChild(m)}));const c=d=>{const f=d.target.closest("[data-action]");if(!f)return;const m=f.dataset.action;m==="next-slide"?l(o+1):m==="prev-slide"&&l(o-1)};return t.addEventListener("click",c),a(),{destroy:()=>{t.removeEventListener("click",c)}}}function ee(t,e="polite"){ye.announce(t,e)}function Gn(t,e={}){const n=yn(t);if(!n)throw new Error("UIComponents.initTabs: container not found");const s=e.buttonSelector||n.dataset.buttonSelector||'[role="tab"], .tab-button',r=e.panelSelector||n.dataset.panelSelector||'[role="tabpanel"], .tab-content',i=yn(e.panelRoot||n.dataset.panelRoot)||n,o=e.activeClass||n.dataset.activeClass||"active",a=typeof e.onChange=="function"?e.onChange:null,l=Array.from(n.querySelectorAll(s)),c=Array.from(i.querySelectorAll(r));if(!l.length)throw new Error("UIComponents.initTabs: no tab buttons found");const d=ne();if(d){const b=l.map(y=>y.getAttribute("aria-controls")||y.dataset.tab).filter(Boolean);H.registerTabs(d,b)}const f=Bn(n);if(!f.valid){const b=f.errors.map((y,w)=>`  Tab button ${w+1}: ${y.message}
    Expected: ${y.context.expected}
    Fix: ${y.context.fix}`).join(`
`);throw new Error(`UIComponents.initTabs: Some tab buttons are missing data-action attributes.
${b}`)}const m=[];if(l.forEach((b,y)=>{const w=b.getAttribute("aria-controls")||b.dataset.tab;if(!w)m.push(`Button ${y+1} is missing data-tab or aria-controls attribute.`);else{const S=CSS.escape?CSS.escape(w):w;i.querySelector(`#${S}`)||m.push(`Panel not found for button ${y+1} (target ID: #${w}).`)}}),m.length>0)throw new Error(`UIComponents.initTabs: Invalid structure in #${n.id||"tabs"}:
${m.join(`
`)}`);function u(b,y=!0,w=!0){if(!b)return;const S=b.getAttribute("aria-controls")||b.dataset.tab||"",E=Jr(S),A=S&&E?i.querySelector(`#${E}`):null;l.forEach(q=>{q.classList.remove(o),q.setAttribute("aria-selected","false"),q.setAttribute("tabindex",q===b?"0":"-1")}),c.forEach(q=>{q.classList.remove(o),q.setAttribute("hidden","hidden")}),b.classList.add(o),b.setAttribute("aria-selected","true"),A&&(A.classList.add(o),A.removeAttribute("hidden"));const L=ne();w&&L&&S&&H.trackTabView(L,S),y&&ee(`Switched to ${b.textContent.trim()} tab`),a&&a({tabId:S,button:b,panel:A})}function g(b){const y=b.target.closest('[data-action="select-tab"]');y&&l.includes(y)&&(b.preventDefault(),u(y))}function p(b){const y=b.target.closest('[data-action="select-tab"]');if(!y||!l.includes(y))return;const w=l.indexOf(y);if(w===-1)return;let S=null;if(b.key==="ArrowRight"||b.key==="ArrowDown"?S=(w+1)%l.length:b.key==="ArrowLeft"||b.key==="ArrowUp"?S=(w-1+l.length)%l.length:b.key==="Home"?S=0:b.key==="End"&&(S=l.length-1),S!==null){b.preventDefault();const E=l[S];E.focus(),u(E)}}n.addEventListener("click",g),n.addEventListener("keydown",p);const h=l.find(b=>b.classList.contains(o))||l[0];return l.forEach(b=>b.setAttribute("tabindex",b===h?"0":"-1")),c.forEach(b=>b.setAttribute("hidden","hidden")),u(h,!1,!1),{activate:b=>{const y=typeof b=="string"?l.find(w=>w.dataset.tab===b||w.getAttribute("aria-controls")===b):b;u(y)},destroy:()=>{n.removeEventListener("click",g),n.removeEventListener("keydown",p)}}}function yn(t){return t?t instanceof Element?t:typeof t=="string"?document.querySelector(t):null:null}function Jr(t){return t?typeof CSS<"u"&&typeof CSS.escape=="function"?CSS.escape(t):t.replace(/[^a-zA-Z0-9_-]/g,"\\$&"):""}class Zr{constructor(){this.flags={},this.isInitialized=!1,this.DOMAIN_KEY="flags",this.SOURCE="flag-manager"}initialize(){if(this.isInitialized)throw new Error("FlagManager: Already initialized. Do not call initialize() more than once.");const e=k.getDomainState(this.DOMAIN_KEY);e&&typeof e=="object"&&(this.flags=e),this.isInitialized=!0,console.log("FlagManager initialized.",this.flags)}getAllFlags(){return z(this.flags)}getFlag(e){return this.flags[e]}setFlag(e,n){if(typeof e!="string"||e.trim()==="")throw new Error("FlagManager: setFlag requires a non-empty string key.");this.flags[e]=n,k.setDomainState(this.DOMAIN_KEY,this.flags,{source:this.SOURCE}),v.emit("flag:updated",{key:e,value:n})}removeFlag(e){this.flags.hasOwnProperty(e)&&(delete this.flags[e],k.setDomainState(this.DOMAIN_KEY,this.flags,{source:this.SOURCE}),v.emit("flag:removed",{key:e}))}}const Qt=new Zr;function Ge(t){if(typeof t!="string")throw new Error("Condition must be a string");const[e,n]=t.split(".");switch(e){case"engagement":return{type:"engagement",requirement:n};case"flag":return{type:"flag",key:n};case"interaction":return{type:"interaction",id:n};default:throw new Error(`Unknown condition type: ${e}`)}}function bn(t,e){switch(t.type){case"engagement":{const n=H.evaluateRequirements(e);return t.requirement==="complete"?n.complete:!n.unmetRequirements.find(r=>r.type===t.requirement)}case"flag":{const n=Qt.getFlag(t.key);return t.equals!==void 0?n===t.equals:!!n}case"interaction":{const n=H.getSlideState(e);if(!n)return!1;const s=n.tracked.interactionsCompleted[t.id];return t.requireCorrect?s?.completed&&s?.correct:s?.completed||!1}default:throw new Error(`[ConditionalDisplay] Unknown condition type: ${t.type}. Valid types: slideVisited, objectiveStatus, assessmentStatus, flagSet, interactionComplete.`)}}function wn(t,e,n){if(e==="all")return t.every(s=>bn(s,n));if(e==="any")return t.some(s=>bn(s,n));throw new Error(`Invalid mode: ${e}. Must be 'all' or 'any'.`)}function vn(t,e,n={}){const{transition:s=!0,display:r="block",onShow:i=null,onHide:o=null}=n;if(t._conditionalTransitionHandler&&(t.removeEventListener("transitionend",t._conditionalTransitionHandler),t._conditionalTransitionHandler=null),e)s?(t.style.display=r,t.classList.remove("conditional-hidden"),t.classList.add("conditional-visible")):t.style.display=r,i&&i();else{if(s){t.classList.remove("conditional-visible"),t.classList.add("conditional-hidden");const a=()=>{t.style.display="none",t.removeEventListener("transitionend",a),t._conditionalTransitionHandler=null};t._conditionalTransitionHandler=a,t.addEventListener("transitionend",a)}else t.style.display="none";o&&o()}}class Xr{constructor(){this.trackedElements=new Map}showWhen(e,n,s={}){const{mode:r="all",showWhen:i=!0,initialCheck:o=!0,transition:a=!0,display:l="block",onShow:c=null,onHide:d=null}=s;let f=[];if(typeof n=="string")f=[Ge(n)];else if(Array.isArray(n))f=n.map(h=>typeof h=="string"?Ge(h):h);else if(typeof n=="object")f=[n];else throw new Error("Invalid conditions format");e.style.display="none",e.classList.add("conditional-hidden");const m=()=>{const h=ne();if(!h)return;const b=wn(f,r,h);vn(e,i?b:!b,{transition:a,display:l,onShow:c,onHide:d})},u=new Set;f.forEach(h=>{switch(h.type){case"engagement":u.add("engagement:progress"),u.add("engagement:complete");break;case"flag":u.add("flag:updated"),u.add("flag:removed");break;case"interaction":u.add("interaction:answered"),u.add("interaction:completed");break}});const g=[];u.forEach(h=>{const b=()=>m();v.on(h,b),g.push({eventName:h,handler:b})}),o&&m();const p=`${Date.now()}-${Math.random()}`;return this.trackedElements.set(p,{element:e,eventHandlers:g,checkConditions:m}),()=>{const h=this.trackedElements.get(p);h&&(h.eventHandlers.forEach(({eventName:b,handler:y})=>{v.off(b,y)}),this.trackedElements.delete(p))}}hideWhen(e,n,s={}){return this.showWhen(e,n,{...s,showWhen:!1})}evaluate(e,n,s={}){const{mode:r="all",showWhen:i=!0,transition:o=!1,display:a="block",onShow:l=null,onHide:c=null}=s;let d=[];typeof n=="string"?d=[Ge(n)]:Array.isArray(n)?d=n.map(g=>typeof g=="string"?Ge(g):g):d=[n];const f=ne();if(!f)return!1;const m=wn(d,r,f);return vn(e,i?m:!m,{transition:o,display:a,onShow:l,onHide:c}),m}cleanup(){this.trackedElements.forEach(e=>{e.eventHandlers.forEach(({eventName:n,handler:s})=>{v.off(n,s)})}),this.trackedElements.clear()}}const ei=new Xr;function ti(t,e={}){const n=ni(t);if(!n)throw new Error("ConditionalDisplay: element not found");if(n.dataset.conditionalInitialized==="true")throw new Error("[ConditionalDisplay] Element already initialized. Each element should only be initialized once.");n.dataset.conditionalInitialized="true";const s=e.condition||n.dataset.condition,r=e.conditions||n.dataset.conditions,i=e.mode||n.dataset.mode||"all",o=e.showWhen!==void 0?e.showWhen:n.dataset.showWhen!=="false",a=e.transition!==void 0?e.transition:n.dataset.transition!=="false",l=e.display||n.dataset.display||"block";let c;if(r)c=r.split(",").map(f=>f.trim());else if(s)c=s;else throw new Error("ConditionalDisplay: No condition specified. Use data-condition or data-conditions attribute.");const d=ei.showWhen(n,c,{mode:i,showWhen:o,transition:a,display:l,initialCheck:!0});return{destroy:()=>{d(),delete n.dataset.conditionalInitialized},element:n}}function ni(t){return t?t instanceof Element?t:typeof t=="string"?document.querySelector(t):null:null}function si(t){const e=t.dataset.source;if(!e){console.warn("[ValueDisplay] No data-source provided",t);return}let n=null;if(e.startsWith("#")?n=document.getElementById(e.substring(1)):n=document.querySelector(e),!n)throw new Error(`[ValueDisplay] Source element not found: ${e}`);const s=t.dataset.event||"change",r=t.dataset.key||"value",i=t.dataset.format||"{value}",o=t.dataset.hideEmpty==="true",a=c=>{if((c===""||c===null||c===void 0)&&o){t.textContent="";return}let d=i;typeof c=="object"&&c!==null?Object.keys(c).forEach(f=>{const m=c[f],u=Array.isArray(m)?m.join(", "):m;d=d.replace(new RegExp(`{${f}}`,"g"),u)}):d=d.replace("{value}",c),t.textContent=d},l=c=>{let d;c.detail?r!=="value"&&c.detail[r]!==void 0?d=c.detail[r]:d=c.detail:c.target&&c.target[r]!==void 0?d=c.target[r]:n[r]!==void 0&&(d=n[r]),a(d)};return n.addEventListener(s,l),{destroy:()=>{n.removeEventListener(s,l)}}}function ri(t){if(!t)throw new Error("CheckboxGroup: Container element is required");const e=t.querySelectorAll('input[type="checkbox"]');if(e.length===0)throw new Error("CheckboxGroup: No checkbox inputs found in container");const n=()=>{const s=Array.from(e).filter(a=>a.checked),r=s.map(a=>a.value),i=s.map(a=>{const l=a.closest(".checkbox-option");if(l){const c=l.querySelector(".checkbox-label");if(c)return c.textContent}return a.labels&&a.labels.length>0?a.labels[0].textContent:a.value}),o=new CustomEvent("checkbox-group:change",{bubbles:!0,detail:{values:r,labels:i,count:s.length,value:i.join(", ")}});t.dispatchEvent(o)};return e.forEach(s=>{s.addEventListener("change",n)}),{destroy:()=>{e.forEach(s=>{s.removeEventListener("change",n)})}}}function ii(t){if(!t)throw new Error("ToggleGroup: Container element is required");const e=t.querySelectorAll('input[type="checkbox"]');if(e.length===0)throw new Error("ToggleGroup: No checkbox inputs found in container");const n=s=>{const r=s.target,i=r.dataset.label||r.nextElementSibling?.nextElementSibling?.textContent||"Toggle",o=r.checked?"enabled":"disabled",a=new CustomEvent("toggle:change",{bubbles:!0,detail:{label:i,checked:r.checked,status:o,value:`${i} is now ${o}`}});t.dispatchEvent(a)};return e.forEach(s=>{s.addEventListener("change",n)}),{destroy:()=>{e.forEach(s=>{s.removeEventListener("change",n)})}}}let st=null,oi=0,Lt=!1;function Kn(){if(!Lt){if(st=document.getElementById("notification-container"),!st)throw new Error('Notification container with ID "notification-container" not found in DOM.');st.addEventListener("click",t=>{const e=t.target.closest('[data-action="dismiss-notification"]');if(e){const n=e.closest(".notification");n&&Jn(n.id)}}),Lt=!0}}function ai(t){t.addEventListener("click",e=>{const n=e.target.closest('[data-action="show-notification"]');if(n){const s=n.dataset.type||"info",r=n.dataset.message||"Notification";Ue(r,s)}})}function Ue(t,e="info",n=5e3,s={}){if(Lt||Kn(),!t||typeof t!="string")throw new Error("Notification message must be a non-empty string");const r=`notification-${++oi}`,i=document.createElement("div");i.id=r,i.className=`notification notification-${e}`,i.setAttribute("role",e==="error"?"alert":"status"),i.setAttribute("data-testid",`notification-${e}`);const a=s.dismissible!==!1?`
        <button class="notification-close" data-action="dismiss-notification" aria-label="Close notification" data-testid="notification-close">Ã—</button>
    `:"";return i.innerHTML=`
        <span class="notification-message">${t}</span>
        ${a}
    `,st.appendChild(i),n>0&&setTimeout(()=>Jn(r),n),ee(t,e==="error"?"assertive":"polite"),r}function Jn(t){const e=document.getElementById(t);e&&(e.style.animation="notificationSlideOut 0.3s ease-out forwards",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},300))}function ci(t){if(!t||t.tagName!=="FORM")throw new Error("FormValidator: Element must be a <form> tag.");const e=t.dataset.successMessage||"Form submitted successfully!",n=t.dataset.errorMessage||"Please fill in all required fields.",s=r=>{if(r.preventDefault(),t.checkValidity()){if(Ue(e,"success"),t.reset(),t.dispatchEvent(new CustomEvent("form:success",{bubbles:!0})),t.dataset.closeModalOnSuccess==="true"){const i=t.closest(".modal")?.querySelector('[data-action="close-modal"]');i&&i.click()}}else Ue(n,"error"),t.dispatchEvent(new CustomEvent("form:error",{bubbles:!0}))};return t.addEventListener("submit",s),{destroy:()=>{t.removeEventListener("submit",s)}}}function li(t){if(!t)return;t.hasAttribute("tabindex")||t.setAttribute("tabindex","0");const e=n=>{n.type==="keydown"&&n.preventDefault(),t.classList.toggle("is-flipped");const s=t.classList.contains("is-flipped");t.setAttribute("aria-expanded",s)};t.addEventListener("click",e),t.addEventListener("keydown",n=>{(n.key==="Enter"||n.key===" ")&&e(n)})}const Sn={tabs:Gn,accordion:Dr,dropdown:Hn,alert:Vr,collapse:Hr,progress:Ur,carousel:Kr,conditional:ti,"value-display":si,"checkbox-group":ri,"toggle-group":ii,"form-validator":ci,"modal-trigger":Qn,"flip-card":li};function di(t){if(!t||typeof t.querySelectorAll!="function")return;t.querySelectorAll("[data-component]").forEach(n=>{const s=n.dataset.component,r=Sn[s];if(r)try{r(n)}catch(i){console.error(`[UI-Initializer] Failed to initialize '${s}' component:`,i,n),v.emit("initialization:error",{domain:"ui",operation:"initializeComponent",message:`Failed to initialize '${s}' component: ${i.message}`,stack:i.stack,context:{component:s,element:n.outerHTML}})}else console.warn(`[UI-Initializer] No initializer found for component: '${s}'. Available initializers: ${Object.keys(Sn).join(", ")}`)}),Gr(t),ai(t)}const P={metadata:{title:"SCORM Template",description:"Advanced SCORM template for course development",version:"2.0.0",author:"Seth Vincent",language:"en"},branding:{logo:"./course/assets/logo.png",logoAlt:"Logo",companyName:"SV",courseTitle:"SCORM Template"},scoring:null,objectives:[{id:"visited-intro",description:"Visit the introduction slide",initialCompletion:"incomplete",initialSuccess:"unknown",criteria:{type:"slideVisited",slideId:"intro"}},{id:"core-content",description:"Visit all core content slides",initialCompletion:"incomplete",initialSuccess:"unknown",criteria:{type:"allSlidesVisited",slideIds:["content","ui-demo"]}},{id:"thorough-review",description:"Spend at least 2 minutes reviewing content",initialCompletion:"incomplete",initialSuccess:"unknown",criteria:{type:"timeOnSlide",slideId:"content",minSeconds:120}},{id:"custom-mastery",description:"Demonstrate mastery (custom logic)",initialCompletion:"incomplete",initialSuccess:"unknown"},{id:"intro-completed-flag",description:"Complete introduction (flag-based)",initialCompletion:"incomplete",initialSuccess:"unknown",criteria:{type:"flag",key:"intro-complete",equals:!0}},{id:"all-sections-unlocked",description:"Unlock all course sections",initialCompletion:"incomplete",initialSuccess:"unknown",criteria:{type:"allFlags",flags:["section-1-unlocked","section-2-unlocked",{key:"section-3-unlocked",equals:!0}]}}],structure:[{type:"slide",id:"intro",component:"@slides/intro.js",title:"Introduction",menu:{label:"Introduction",icon:"ðŸ“š"},engagement:{required:!1},navigation:{sequential:!0,controls:{showPrevious:!1,showNext:!0,exitTarget:null}}},{type:"section",id:"course-content",menu:{label:"Course Content",icon:"ðŸ“‚",defaultExpanded:!0},children:[{type:"slide",id:"ui-demo",component:"@slides/ui-demo.js",title:"UI Components Demo",menu:{label:"UI Components Demo",icon:"ðŸŽ¨"},engagement:{required:!1},navigation:{sequential:!0,controls:{showPrevious:!0,showNext:!0}}},{type:"slide",id:"content",component:"@slides/content.js",title:"Learning Content",menu:{label:"Main Content",icon:"ðŸ”§"},engagement:{required:!0,mode:"all",requirements:[{type:"viewAllTabs"},{type:"interactionComplete",interactionId:"system-architecture-dd"},{type:"interactionComplete",interactionId:"requirements-spec-fillin"},{type:"interactionComplete",interactionId:"efficiency-calculation"}],showIndicator:!0},navigation:{sequential:!0,controls:{showPrevious:!0,showNext:!0}}}]},{type:"assessment",id:"assessment",component:"@slides/assessment.js",title:"Final Assessment",menu:{label:"Final Exam",icon:"ðŸ“"},engagement:{required:!1},navigation:{sequential:!0,controls:{showPrevious:!0,showNext:!0},gating:{mode:"all",message:"Complete the required content before starting the exam.",conditions:[{type:"objectiveStatus",objectiveId:"core-content",completion_status:"completed"}]}}},{type:"slide",id:"remedial",component:"@slides/remedial.js",title:"Remedial Content",menu:{hidden:!0},engagement:{required:!1},navigation:{sequential:!0,controls:{showPrevious:!0,showNext:!0,exitTarget:"assessment"},gating:{mode:"any",message:"Remedial content becomes available after an unsuccessful assessment attempt.",conditions:[{type:"assessmentStatus",assessmentId:"final-exam",requires:"failed"}]},sequence:{includeByDefault:!1,includeWhen:{type:"assessmentStatus",assessmentId:"final-exam",requires:"failed"},insert:{position:"after",slideId:"assessment"}}}},{type:"slide",id:"summary",component:"@slides/summary.js",title:"Course Summary",menu:{label:"Summary",icon:"ðŸ†"},engagement:{required:!1},navigation:{sequential:!0,controls:{showPrevious:!0,showNext:!1},gating:{mode:"all",message:"Summary is locked until you pass the assessment.",conditions:[{type:"assessmentStatus",assessmentId:"final-exam",requires:"passed"}]}}}],navigation:{sidebar:{enabled:!0,position:"left",width:"280px",collapsible:!0,defaultCollapsed:!0,showProgress:!0}},features:{accessibility:{darkMode:!0,fontSize:!0,highContrast:!0,reducedMotion:!0,keyboardShortcuts:!0},security:!1,offline:!1,analytics:!0,feedback:!0},completion:{promptForComments:!0,promptForRating:!0},slideDefaults:{contentWidth:"full"},environment:{window:{width:1024,height:768},disableBeforeUnloadGuard:!0,development:{disableGating:!0},automation:{enabled:!0,disableBeforeUnloadGuard:!0,exposeCorrectAnswers:!0}}};function Zn(t,e="local"){if(!t||!(t instanceof HTMLElement))throw new Error("ViewManager: A valid container element is required.");const n={};let s=null;function r(m,u){if(!m)throw new Error("ViewManager: View name is required.");if(!u||typeof u.render!="function")throw new Error(`ViewManager: View '${m}' must be an object with a render function.`);n[m]={...u}}async function i(m,u={}){if(!n[m])throw new Error(`ViewManager: View '${m}' not found.`);let g=null;if(s&&n[s]){const b=n[s];g=t.firstElementChild,g&&typeof b.onHide=="function"&&b.onHide(g)}const p=n[m];v.emit("view:before-change",{oldView:s,newView:m,scope:e,context:u});let h=await p.render(u);if(!(h instanceof HTMLElement))throw new Error(`ViewManager: View '${m}' render function must return an HTMLElement.`);h=o(h),l(h,m),t.innerHTML="",t.appendChild(h),di(h),typeof p.onShow=="function"&&p.onShow(h,u),s=m,v.emit("view:change",{view:m,context:u})}function o(m,u){const h=m.getAttribute("data-content-width")||P?.slideDefaults?.contentWidth;if(!h||a(m))return m;const b=document.createElement("div");return b.className=`content-${h}`,b.appendChild(m),b}function a(m){const u=["content-narrow","content-medium","content-wide","content-full"];if(m.classList&&u.some(g=>m.classList.contains(g)))return!0;if(m.children&&m.children.length>0){for(const g of m.children)if(g.classList&&u.some(p=>g.classList.contains(p)))return!0}return!1}function l(m,u){const g=Ir(m,u);if(!g.valid){g.errors.forEach(h=>{const b=`View "${u}" [${h.type}]: ${h.message}`;v.emit("view:error",{domain:"view",operation:"validateRenderedContent",message:b,context:h.context,stack:new Error(b).stack}),console.error(`[ViewManager Validation Error] ${b}`,h.context)});const p=g.errors.map(h=>`[${h.type}] ${h.message}`).join("; ");throw new Error(`[ViewManager] View "${u}" has ${g.errors.length} validation error(s): ${p}`)}}function c(){return s}function d(){return t}function f(){if(s&&n[s]){const m=t.firstElementChild,u=n[s];m&&typeof u.onHide=="function"&&u.onHide(m)}t.innerHTML="",s=null}return{registerView:r,showView:i,getCurrentView:c,getContainer:d,destroy:f}}class ui{constructor(){this.objectives={},this.isInitialized=!1,this.earlyQueue=[],this.DOMAIN_KEY="objectives",this.SOURCE="objective-manager",this.criteriaConfig=[]}initialize(e=[]){if(this.isInitialized)throw new Error("ObjectiveManager: Already initialized. Do not call initialize() more than once.");const n=k.getDomainState(this.DOMAIN_KEY);n&&typeof n=="object"&&(this.objectives=this._mergeWithDefaults(n)),this.isInitialized=!0,e.length>0&&(e.forEach(s=>{this.objectives[s.id]||this.setObjective({id:s.id,completion_status:s.initialCompletion||"incomplete",success_status:s.initialSuccess||"unknown",score:s.initialScore||null})}),console.log(`[ObjectiveManager] Initialized ${e.length} objective(s) from configuration.`),this.enableCriteriaTracking(e)),console.log("[ObjectiveManager] Initialized with objectives:",this.objectives),this._processEarlyQueue()}_processEarlyQueue(){this.earlyQueue.length>0&&(console.log(`[ObjectiveManager] Processing ${this.earlyQueue.length} early-queued call(s).`),this.earlyQueue.forEach(({method:e,args:n})=>{typeof this[e]=="function"&&this[e](...n)}),this.earlyQueue=[])}getObjectives(){return z(Object.values(this.objectives))}getObjective(e){return!e||!this.objectives[e]?null:z(this.objectives[e])}setObjective(e){if(!this.isInitialized){this.earlyQueue.push({method:"setObjective",args:[e]});return}const{id:n}=e;if(!n)throw new Error("ObjectiveManager: setObjective requires an id.");const r={...this.objectives[n]||{id:n},...e};this.objectives[n]=r;const i=this._stripDefaultValues(this.objectives);return k.setDomainState(this.DOMAIN_KEY,i,{source:this.SOURCE}),this._syncObjectiveToSCORM(r),v.emit("objective:updated",r),typeof r.score=="number"&&v.emit("objective:score:updated",{objectiveId:n,score:r.score}),z(r)}setSuccessStatus(e,n,s=null){if(!this.isInitialized){this.earlyQueue.push({method:"setSuccessStatus",args:[e,n,s]});return}const r=this.getObjective(e);if(!r)throw new Error(`ObjectiveManager: Objective with id "${e}" not found.`);r.success_status=n,s!==null&&(r.score=s),this.setObjective(r)}setCompletionStatus(e,n){if(!this.isInitialized){this.earlyQueue.push({method:"setCompletionStatus",args:[e,n]});return}const s=this.getObjective(e);if(!s)throw new Error(`ObjectiveManager: Objective with id "${e}" not found.`);s.completion_status=n,this.setObjective(s)}setScore(e,n){if(!this.isInitialized){this.earlyQueue.push({method:"setScore",args:[e,n]});return}const s=this.getObjective(e);if(!s)throw new Error(`ObjectiveManager: Objective with id "${e}" not found.`);if(typeof n!="number"||n<0||n>100)throw new Error(`ObjectiveManager: Score must be a number between 0 and 100, got ${n}`);s.score=n,this.setObjective(s)}enableCriteriaTracking(e=[]){if(this.criteriaConfig=e.filter(n=>n.criteria),this.criteriaConfig.length===0){console.log("[ObjectiveManager] No objectives with built-in criteria found.");return}v.on("view:change",({view:n})=>{this._handleSlideVisit(n),this._checkTimeBasedObjectives(n)}),v.on("flag:updated",({key:n,value:s})=>{this._checkFlagBasedObjectives(n,s)}),console.log(`[ObjectiveManager] Criteria tracking enabled for ${this.criteriaConfig.length} objective(s).`)}_handleSlideVisit(e){const s=k.getDomainState("navigation")?.visitedSlides||[],r=new Set([...s,e]);this.criteriaConfig.forEach(i=>{const o=this.objectives[i.id];if(o&&o.completion_status==="completed")return;const{criteria:a}=i;switch(a.type){case"slideVisited":{a.slideId===e&&(this.setCompletionStatus(i.id,"completed"),console.log(`[ObjectiveManager] Objective "${i.id}" completed: slideVisited`));break}case"allSlidesVisited":{(a.slideIds||[]).every(d=>r.has(d))&&(this.setCompletionStatus(i.id,"completed"),console.log(`[ObjectiveManager] Objective "${i.id}" completed: allSlidesVisited`));break}}})}_checkTimeBasedObjectives(e){const s=k.getDomainState("sessionData")?.slideDurations||{};this.criteriaConfig.forEach(r=>{const i=this.objectives[r.id];if(i&&i.completion_status==="completed")return;const{criteria:o}=r;if(o.type==="timeOnSlide"&&o.slideId===e){const l=(s[e]||0)/1e3;l>=(o.minSeconds||0)&&(this.setCompletionStatus(r.id,"completed"),console.log(`[ObjectiveManager] Objective "${r.id}" completed: timeOnSlide (${l.toFixed(1)}s)`))}})}_checkFlagBasedObjectives(e,n){const s=k.getDomainState("flags")||{};this.criteriaConfig.forEach(r=>{const i=this.objectives[r.id];if(i&&i.completion_status==="completed")return;const{criteria:o}=r;if(o.type==="flag"){if(o.key===e){let a=!1;o.equals!==void 0?a=n===o.equals:a=!!n,a&&(this.setCompletionStatus(r.id,"completed"),console.log(`[ObjectiveManager] Objective "${r.id}" completed: flag "${e}" = ${n}`))}}else o.type==="allFlags"&&(o.flags||[]).every(c=>{const d=typeof c=="string"?c:c.key,f=s[d];return typeof c=="object"&&c.equals!==void 0?f===c.equals:!!f})&&(this.setCompletionStatus(r.id,"completed"),console.log(`[ObjectiveManager] Objective "${r.id}" completed: allFlags`))})}_getObjectiveIndex(e){if(!e)throw new Error(`[ObjectiveManager] Invalid objective ID: ${e}`);if(typeof window.findObjective!="function")throw new Error("[ObjectiveManager] SCORM wrapper findObjective() not available");return window.findObjective(e)}_syncObjectiveToSCORM(e){if(!this.isInitialized)throw new Error("[ObjectiveManager] Cannot sync to SCORM: manager not initialized.");const n=this._getObjectiveIndex(e.id);if(e.success_status&&k.setValue(`cmi.objectives.${n}.success_status`,e.success_status),e.completion_status&&k.setValue(`cmi.objectives.${n}.completion_status`,e.completion_status),e.score!==null&&e.score!==void 0){const r=e.score,i=r/100;k.setValue(`cmi.objectives.${n}.score.raw`,String(r)),k.setValue(`cmi.objectives.${n}.score.scaled`,String(i)),k.setValue(`cmi.objectives.${n}.score.min`,"0"),k.setValue(`cmi.objectives.${n}.score.max`,"100")}const s=e.description||this._getDescriptionFromConfig(e.id);s&&k.setValue(`cmi.objectives.${n}.description`,s),console.log(`[ObjectiveManager] Synced objective "${e.id}" to cmi.objectives.${n}`)}_getDescriptionFromConfig(e){return this.criteriaConfig.find(s=>s.id===e)?.description||""}syncAllObjectivesToSCORM(){if(!this.isInitialized)throw new Error("[ObjectiveManager] Cannot sync all objectives: manager not initialized.");const e=Object.keys(this.objectives).sort();console.log(`[ObjectiveManager] Syncing ${e.length} objective(s) to SCORM CMI...`),e.forEach(n=>{this._syncObjectiveToSCORM(this.objectives[n])}),console.log("[ObjectiveManager] All objectives synced to SCORM CMI.")}_stripDefaultValues(e){const n={};for(const[s,r]of Object.entries(e)){const i={id:s};r.completion_status&&r.completion_status!=="incomplete"&&(i.completion_status=r.completion_status),r.success_status&&r.success_status!=="unknown"&&(i.success_status=r.success_status),r.score!==null&&r.score!==void 0&&(i.score=r.score),n[s]=i}return n}_mergeWithDefaults(e){const n={};for(const[s,r]of Object.entries(e))n[s]={id:s,completion_status:r.completion_status||"incomplete",success_status:r.success_status||"unknown",score:r.score??null};return n}}const Ie=new ui;class mi{constructor(){this.interactions=[],this.isInitialized=!1,this.DOMAIN_KEY="interactions",this.SOURCE="interaction-manager"}initialize(){if(this.isInitialized)throw new Error("InteractionManager: Already initialized. Do not call initialize() more than once.");const e=k.getDomainState(this.DOMAIN_KEY);Array.isArray(e)&&(this.interactions=e),this.isInitialized=!0,console.log("InteractionManager initialized.",this.interactions)}getAllInteractions(){return z(this.interactions)}getInteraction(e){const n=this.interactions.find(s=>s.id===e);return n?z(n):null}_validateInteractionData(e){if(!e||typeof e!="object")throw new Error("[InteractionManager] Interaction data must be a non-null object");const n=[],s=br(e,["type"]);if(!s.valid)n.push(...s.errors);else{const r=vr(e.type);r.valid||n.push(r.error)}if(e.result){const r=Sr(e.result);r.valid||n.push(r.error)}if(e.timestamp&&!gr(e.timestamp)&&n.push(`Invalid timestamp "${e.timestamp}". Must be ISO 8601 format`),e.weighting!==void 0&&e.weighting!==null){const r=hr(e.weighting,"weighting");r.valid||n.push(r.error)}if(e.latency&&!pr(e.latency)&&n.push(`Invalid latency "${e.latency}". Must be ISO 8601 duration format (e.g., "PT1H30M")`),e.correct_responses!==void 0&&!Array.isArray(e.correct_responses)&&n.push('Field "correct_responses" must be an array'),e.objectives!==void 0){const r=yr(e.objectives,"objectives");r.valid||n.push(r.error)}if(n.length>0){const r=e.id?`interaction "${e.id}"`:"interaction",i="[InteractionManager] "+wr(n,r);throw new Error(i)}}record(e){this._validateInteractionData(e);const n={id:e.id||Rn("interaction"),type:e.type,learner_response:e.learner_response||"",result:e.result||"neutral",description:e.description||"",timestamp:e.timestamp||new Date().toISOString(),weighting:e.weighting,latency:e.latency,correct_responses:e.correct_responses,objectives:e.objectives};this.interactions.push(n);const s=this.interactions.length-1;try{k.setDomainState(this.DOMAIN_KEY,this.interactions,{source:this.SOURCE})}catch(r){this.interactions.pop();const i=new Error(`[InteractionManager] Failed to persist interaction "${n.id}" to domain state: ${r.message}`);throw this._emitError("record",i,{interactionId:n.id,phase:"domain-persistence"}),i}try{this._syncInteractionFieldsToSCORM(n,s)}catch(r){const i=new Error(`[InteractionManager] Failed to sync interaction "${n.id}" to SCORM CMI: ${r.message}`);throw this._emitError("record",i,{interactionId:n.id,phase:"cmi-sync"}),i}return v.emit("interaction:recorded",n),z(n)}_syncInteractionFieldsToSCORM(e,n){if(!this.isInitialized){const r=new Error("[InteractionManager] Cannot sync to SCORM: manager not initialized");throw this._emitError("_syncInteractionFieldsToSCORM",r,{interactionId:e.id,index:n}),r}if(n<0){const r=new Error(`[InteractionManager] Invalid interaction index: ${n}`);throw this._emitError("_syncInteractionFieldsToSCORM",r,{interactionId:e.id,index:n}),r}const s=[{key:"id",path:`cmi.interactions.${n}.id`,required:!0},{key:"type",path:`cmi.interactions.${n}.type`,required:!0},{key:"learner_response",path:`cmi.interactions.${n}.learner_response`},{key:"result",path:`cmi.interactions.${n}.result`},{key:"timestamp",path:`cmi.interactions.${n}.timestamp`},{key:"description",path:`cmi.interactions.${n}.description`},{key:"weighting",path:`cmi.interactions.${n}.weighting`,transform:r=>String(r)},{key:"latency",path:`cmi.interactions.${n}.latency`}];for(const r of s){const i=e[r.key];if(r.required&&i==null){const o=new Error(`[InteractionManager] Required field "${r.key}" missing for interaction "${e.id}"`);throw this._emitError("_syncInteractionFieldsToSCORM",o,{interactionId:e.id,index:n,field:r.key}),o}if(i!=null){const o=r.transform?r.transform(i):i;k.setValue(r.path,o)}}e.correct_responses&&Array.isArray(e.correct_responses)&&e.correct_responses.forEach((r,i)=>{const o=`cmi.interactions.${n}.correct_responses.${i}.pattern`;k.setValue(o,r)}),e.objectives&&Array.isArray(e.objectives)&&e.objectives.forEach((r,i)=>{const o=`cmi.interactions.${n}.objectives.${i}.id`;k.setValue(o,r)}),console.log(`[InteractionManager] Synced interaction "${e.id}" to cmi.interactions.${n}`)}addLikertInteraction({id:e,response:n,description:s}){if(!this.isInitialized){const r=new Error("[InteractionManager] Not initialized. Call initialize() first.");throw this._emitError("addLikertInteraction",r,{interactionId:e}),r}if(!e||typeof e!="string"){const r=new Error("[InteractionManager] likert interaction id is required and must be a string");throw this._emitError("addLikertInteraction",r,{interactionId:e}),r}if(!n){const r=new Error("[InteractionManager] likert interaction response is required");throw this._emitError("addLikertInteraction",r,{interactionId:e}),r}return this.record({id:e,type:"likert",learner_response:String(n),description:s||"",result:"neutral"})}syncAllInteractionsToSCORM(){if(!this.isInitialized)throw new Error("[InteractionManager] Cannot sync all interactions: manager not initialized");console.log(`[InteractionManager] Syncing ${this.interactions.length} interaction(s) to SCORM CMI...`);const e=[];let n=0;if(this.interactions.forEach((s,r)=>{try{this._syncInteractionFieldsToSCORM(s,r),n++}catch(i){const o={interactionId:s.id||"unknown",index:r,message:i.message};e.push(o),console.error(`[InteractionManager] Failed to sync interaction "${o.interactionId}" at index ${r}: ${i.message}`)}}),console.log(`[InteractionManager] Sync complete: ${n}/${this.interactions.length} interactions synced successfully`),e.length>0){const s=e.map(o=>`  - [${o.index}] ${o.interactionId}: ${o.message}`).join(`
`),r=`[InteractionManager] Failed to sync ${e.length}/${this.interactions.length} interaction(s):
${s}`,i=new Error(r);throw v.emit("interaction:sync:error",{domain:"interaction",operation:"syncAllInteractionsToSCORM",message:i.message,stack:i.stack,context:{errors:e,successCount:n,totalCount:this.interactions.length}}),i}console.log("[InteractionManager] All interactions synced to SCORM CMI successfully.")}_emitError(e,n,s){v.emit("interaction:error",{domain:"interaction",operation:e,message:n.message,stack:n.stack,context:s})}}const Me=new mi;class fi{constructor(){this.registry=new Map,this.isReady=!1}register(e,n){if(!e||!e.id){const r=new Error("[InteractionRegistry] Cannot register interaction: configuration or ID is missing.");throw v.emit("interaction:registry:error",{domain:"interaction-registry",operation:"register",message:r.message,stack:r.stack,context:{config:e}}),r}if(this.registry.has(e.id)){const r=new Error(`[InteractionRegistry] Interaction with ID "${e.id}" is already registered. Duplicate interaction IDs are not allowed. Each interaction must have a unique ID.`);throw v.emit("interaction:registry:error",{domain:"interaction-registry",operation:"register",message:r.message,stack:r.stack,context:{interactionId:e.id}}),r}const s={id:e.id,type:e.type,description:e.prompt,config:e,instance:n};this.registry.set(e.id,s),v.emit("interaction:registered",s)}getAll(){return Array.from(this.registry.values())}clear(){this.registry.clear(),this.isReady=!1,console.log("[InteractionRegistry] Registry cleared.")}setReady(){this.isReady=!0,v.emit("interaction:registry:ready",this.getAll()),console.log(`[InteractionRegistry] Registry ready. ${this.registry.size} interactions registered.`)}}const lt=new fi;function gi(t){return`assessment_${t}`}function pi(t,e){if(!t||!t.id){const $="AssessmentState requires a config object with an id";throw v.emit("assessment:error",$),new Error($)}if(!e){const $=`[AssessmentState:${t.id}] StateManager instance is required`;throw v.emit("assessment:error",$),new Error($)}const n=gi(t.id),s="assessment-state",r={currentView:"intro",currentQuestionIndex:0,startTime:null,submitted:!1,attemptNumber:1,responses:{},selectedQuestions:null,reviewReached:!1};function i(){return e.getDomainState(n)||{}}async function o($,M=s){await e.setDomainState(n,$,{source:M})}function a(){const $=i();return $.session||($.session={...r}),$}function l($){return $?.attempts>0?$.attempts+1:1}function c(){const $=i();return $.summary?z($.summary):null}async function d($={},M=s){const O=i(),j=O.summary||{};O.summary={...j,...$},await o(O,M)}function f(){const $=i();return $.session?z($.session):null}async function m(){const $=a();await o($,`${s}:init`)}async function u($={},M=s){const O=a();O.session={...O.session,...$},await o(O,M)}async function g($=`${s}:clear`){const M=i();delete M.session,await o(M,$)}function p(){return f()?.currentView||"intro"}function h(){return f()?.currentQuestionIndex||0}function b(){return f()?.startTime||null}function y(){return f()?.submitted||!1}function w(){const $=f(),M=c();return $?.attemptNumber?$.attemptNumber:l(M)}function S(){return c()?.lastResults||null}async function E($,M=`${s}:view`){await u({currentView:$},M)}async function A($,M=`${s}:question`){await u({currentQuestionIndex:$},M)}async function L($,M=`${s}:start`){await u({startTime:$},M)}async function q($,M=`${s}:submit`){await u({submitted:$},M)}async function C($,M=`${s}:attempt`){await u({attemptNumber:$},M)}function x($){const M=f();if(!M?.responses)return null;const O=String($);return Object.prototype.hasOwnProperty.call(M.responses,O)?z(M.responses[O]):null}async function I($,M){const O=String($),j=M===void 0?null:z(M),Q=a();Q.session.responses=Q.session.responses||{},Q.session.responses[O]=j,await o(Q,`${s}:response`)}function _(){const $=f();return $?.selectedQuestions?z($.selectedQuestions):null}async function D($){const M=a();M.session.selectedQuestions=$.map(O=>O.id),await o(M,`${s}:selected-questions`)}async function W($,M){if(!(t.settings?.archiveDiscardedAttempts||!1)){console.log(`[AssessmentState:${t.id}] Discarded attempt archive disabled (to enable, set settings.archiveDiscardedAttempts: true)`);return}const j=i();j.discardedAttempts||(j.discardedAttempts=[]);const Q={timestamp:Date.now(),attemptNumber:w(),questions:$.map(ie=>({id:ie.id,type:ie.type,bankId:ie._meta?.bankId,originalIndex:ie._meta?.originalIndex})),responses:z(M)};j.discardedAttempts.push(Q),j.discardedAttempts.length>5&&(j.discardedAttempts=j.discardedAttempts.slice(-5)),await o(j,`${s}:archive`),console.log(`[AssessmentState:${t.id}] Archived discarded attempt #${Q.attemptNumber}`)}function N(){const $=i();return $.discardedAttempts?z($.discardedAttempts):[]}return{getSummary:c,updateSummary:d,getSession:f,initializeSession:m,updateSession:u,clearSession:g,getCurrentView:p,getCurrentQuestionIndex:h,getStartTime:b,isSubmitted:y,getAttemptNumber:w,getLastResults:S,setCurrentView:E,setCurrentQuestionIndex:A,setStartTime:L,setSubmitted:q,setAttemptNumber:C,getResponse:x,saveResponse:I,getSelectedQuestions:_,setSelectedQuestions:D,archiveDiscardedResponses:W,getDiscardedAttempts:N}}const Z=document.getElementById("menu"),Ce=document.getElementById("prevBtn"),G=document.getElementById("nextBtn"),se=document.getElementById("engagement-indicator"),ze=se?.querySelector(".engagement-progress"),At=se?.querySelector(".engagement-checkmark");let Xn=!1;function hi(){const t=[];if(Z||t.push("#menu"),Ce||t.push("#prevBtn"),G||t.push("#nextBtn"),t.length>0)throw new Error(`NavigationUI: Required DOM elements not found: ${t.join(", ")}. Check framework/index.html.`);Xn=!0}function yi(t,e,n=new Map){if(Xn||hi(),!Array.isArray(t))throw new Error("NavigationUI.renderMenu: menuTree must be an array");if(!Array.isArray(e))throw new Error("NavigationUI.renderMenu: visitedSlides must be an array");if(!(n instanceof Map))throw new Error("NavigationUI.renderMenu: accessibilityMap must be a Map");Z.innerHTML=`<ul class="nav-list">${ts(t,e,n)}</ul>`,Z.querySelectorAll(".section-toggle").forEach(r=>{r.addEventListener("click",i=>{i.preventDefault();const a=r.closest(".nav-section").classList.toggle("expanded");r.setAttribute("aria-expanded",a)})})}function es(t,e){if(!t||t.length===0)return!1;let n=!0,s=!1;for(const r of t)if(r.type==="section"){if(!es(r.children||[],e)){n=!1;break}}else{s=!0;const i=e.get(r.id);if(!i||i.allowed!==!1){n=!1;break}}return s&&n}function ts(t,e,n){return t.map(s=>{if(s.type==="section"){const r=s.defaultExpanded?"expanded":"",i=s.collapsible!==!1?"collapsible":"",o=es(s.children||[],n),a=o?"all-children-locked":"";return o&&console.log(`[NavigationUI] Section "${s.label}" (${s.id}) has all children locked`),`
                <li class="nav-section ${r} ${i} ${a}" data-section-id="${s.id}" data-testid="nav-section-${s.id}">
                    <button class="section-toggle" aria-expanded="${s.defaultExpanded}" aria-controls="section-${s.id}" data-testid="nav-section-toggle-${s.id}">
                        ${s.icon?`<span class="section-icon" aria-hidden="true">${s.icon}</span>`:""}
                        <span class="section-label">${s.label}</span>
                        <span class="toggle-indicator" aria-hidden="true">â€º</span>
                    </button>
                    <ul class="section-children" id="section-${s.id}">
                        ${ts(s.children||[],e,n)}
                    </ul>
                </li>
            `}else{const r=e.includes(s.id)?"visited":"",i=n.get(s.id),o=i&&i.allowed===!1,a=o?"locked":"",l=o?'aria-disabled="true"':"",c=o?'tabindex="-1"':"",d=o&&i.message?"tooltip":"",f=o&&i.message?`data-tooltip="${i.message}"`:"",m=o&&i.message?`aria-label="Go to ${s.label} (${i.message})"`:`aria-label="Go to ${s.label}"`;return`
                <li class="nav-item ${r} ${a}" data-slide-id="${s.id}" data-slide-index="${s.slideIndex}" data-action="nav-menu-item" data-testid="nav-menu-item-${s.id}">
                    <a href="#" role="button" class="${d}" ${m} ${l} ${c} ${f}>
                        ${s.icon?`<span class="slide-icon" aria-hidden="true">${s.icon}</span>`:""}
                        <span class="slide-label">${s.label}</span>
                        ${o?'<span class="lock-icon" aria-hidden="true">ðŸ”’</span>':""}
                    </a>
                </li>
            `}}).join("")}function ns(t){if(!t||typeof t!="string")throw new Error(`NavigationUI.setActiveItem: Invalid slideId: ${t}`);if(!Z)return;Z.querySelectorAll(".nav-item").forEach(n=>{const s=n.dataset.slideId===t;n.classList.toggle("active",s),n.querySelector("a").setAttribute("aria-current",s?"page":"false")})}function Yt(t,e){let n,s,r;if(typeof t=="object"?(n=t.isFirstSlide,e=t.isLastSlide,s=t.nextBlocked||!1,r=t.nextBlockedMessage||null):(n=t,s=!1,r=null),Ce&&(Ce.disabled=n,Ce.setAttribute("aria-disabled",String(n)),n?Ce.title="No previous slide":Ce.title="Go to previous slide"),G){const i=e||s;G.disabled=i,G.setAttribute("aria-disabled",String(i)),s&&r?(G.classList.add("tooltip"),G.setAttribute("data-tooltip",r),G.title="",G.setAttribute("aria-label",`Next (${r})`)):e?(G.classList.remove("tooltip"),G.removeAttribute("data-tooltip"),G.title="No next slide",G.setAttribute("aria-label","Next (No next slide)")):(G.classList.remove("tooltip"),G.removeAttribute("data-tooltip"),G.title="Go to next slide",G.setAttribute("aria-label","Next"))}}function En(t){if(!t||typeof t!="string")throw new Error(`NavigationUI.markAsVisited: Invalid slideId: ${t}`);if(!Z)return;const e=Z.querySelector(`.nav-item[data-slide-id="${t}"]`);e&&e.classList.add("visited")}function $n(t){if(!t||typeof t!="string")throw new Error(`NavigationUI.markAsUnvisited: Invalid slideId: ${t}`);if(!Z)return;const e=Z.querySelector(`.nav-item[data-slide-id="${t}"]`);e&&e.classList.remove("visited")}function bi(t){if(!t||typeof t!="string")throw new Error(`NavigationUI.markAsLocked: Invalid slideId: ${t}`);if(!Z)return;const e=Z.querySelector(`.nav-item[data-slide-id="${t}"]`);if(e){e.classList.add("locked");const n=e.querySelector("a");n&&(n.setAttribute("aria-disabled","true"),n.setAttribute("tabindex","-1"))}}function wi(t){if(!t||typeof t!="string")throw new Error(`NavigationUI.markAsUnlocked: Invalid slideId: ${t}`);if(!Z)return;const e=Z.querySelector(`.nav-item[data-slide-id="${t}"]`);if(e){e.classList.remove("locked");const n=e.querySelector("a");n&&(n.removeAttribute("aria-disabled"),n.removeAttribute("tabindex"))}}function Rt(t){if(!t||typeof t.percentage!="number")throw new Error("NavigationUI.showEngagementIndicator: Invalid progress object");if(!se)return;se.hidden=!1,vi(t.percentage,t.percentage===100),se.setAttribute("data-tooltip",`Slide Progress: ${t.percentage}%`);const e=`${t.percentage}% of content requirements completed`;se.setAttribute("aria-label",e)}function kn(){se&&(se.hidden=!0)}function vi(t,e){if(!ze||!At)return;const n=t<5?0:t,s=2*Math.PI*14,r=s-n/100*s;ze.style.strokeDasharray=`${s} ${s}`,ze.style.strokeDashoffset=`${r}`,e?(At.style.opacity="1",ze.classList.add("complete")):(At.style.opacity="0",ze.classList.remove("complete")),se?.setAttribute("data-progress",t),se?.setAttribute("data-complete",e?"true":"false")}function Gt(){return P.environment?.development?.disableGating===!0}function gt(){return Gt()}function dt(t,e,n){if(!t||typeof t!="object")return!1;switch(t.type){case"objectiveStatus":{const s=e.getDomainState("objectives")?.[t.objectiveId];return s?t.completion_status!==void 0?s.completion_status===t.completion_status:t.success_status!==void 0?s.success_status===t.success_status:!1:!1}case"assessmentStatus":{const s=e.getDomainState(`assessment_${t.assessmentId}`);if(!s)return!1;const r=s.summary;if(!r||!r.lastResults)return!1;const i=r.lastResults.passed;switch(t.requires){case"completed":return r.submitted===!0;case"passed":return i===!0;case"failed":return r.submitted===!0&&i===!1;default:return!1}}case"assessmentAttempts":{const s=e.getDomainState(`assessment_${t.assessmentId}`);if(!s)return!1;const i=s.summary?.attempts||0;return!(t.min!==void 0&&i<t.min||t.max!==void 0&&i>t.max)}case"assessmentConfig":{const s=n.get(t.assessmentId);if(!s)return!1;const i=((o,a)=>a.split(".").reduce((l,c)=>(l||{})[c],o))(s,t.property);return i===void 0?!1:t.equals!==void 0?i===t.equals:t.greaterThan!==void 0?typeof i=="number"&&i>t.greaterThan:t.lessThan!==void 0?typeof i=="number"&&i<t.lessThan:!0}case"stateFlag":{const r=e.getDomainState("flags")?.[t.key];return t.equals!==void 0?r===t.equals:t.exists!==void 0?t.exists?r!==void 0:r===void 0:!!r}case"timeOnSlide":return((e.getDomainState("sessionData")?.slideDurations||{})[t.slideId]||0)/1e3>=(t.minSeconds||0);case"custom":return typeof t.evaluate=="function"?t.evaluate(e):!1;default:throw new Error(`Unknown gating condition type: ${t.type}. Valid types: objectiveStatus, assessmentStatus, assessmentAttempts, assessmentConfig, stateFlag, timeOnSlide, custom.`)}}function ss(t){if(t.length===0)return"Complete all requirements";if(t.length===1){const r=t[0];switch(r.type){case"viewAllTabs":return r.configError||r.total===0?"Configuration error: This slide requires tabs but has none. Contact course administrator.":`View all ${r.total} tabs (${r.viewed}/${r.total} viewed)`;case"viewAllPanels":return r.configError||r.total===0?"Configuration error: This slide requires accordion panels but has none. Contact course administrator.":`Expand all ${r.total} sections (${r.viewed}/${r.total} viewed)`;case"interactionComplete":return"Complete the practice exercise";case"allInteractionsComplete":return r.configError||r.total===0?"Configuration error: This slide requires interactions but has none. Contact course administrator.":`Complete all practice exercises (${r.completed}/${r.total} complete)`;case"scrollDepth":return`Scroll to the bottom (${r.current}% scrolled)`;case"timeOnSlide":return`Spend at least ${r.required} seconds (${r.current}s elapsed)`;default:return r.message||"Complete all required content"}}const e={};t.forEach(r=>{e[r.type]=(e[r.type]||0)+1});const n=[],s=new Set;return t.forEach(r=>{const i=r.type;if(!s.has(i))switch(s.add(i),r.type){case"viewAllTabs":n.push(`View all tabs (${r.viewed}/${r.total})`);break;case"viewAllPanels":n.push(`Expand all sections (${r.viewed}/${r.total})`);break;case"interactionComplete":case"allInteractionsComplete":n.push(`Complete exercises (${r.completed}/${r.total})`);break;case"scrollDepth":n.push(`Scroll to bottom (${r.current}%)`);break;case"timeOnSlide":n.push(`Spend ${r.required}s on slide`);break;default:n.push(r.message||"Complete requirement")}}),n.length===1?n[0]:`Complete: ${n.join(", ")}`}function Te(t,e,n){if(!t)return!1;const s=t.navigation?.sequence;if(!s)return!0;const r=s.includeWhen||[],i=s.skipUntil||[];let a=s.includeByDefault!==!1;return r.length>0&&(a=r.every(l=>dt(l,e,n))),a&&i.length>0&&(i.every(c=>dt(c,e,n))||(a=!1)),a}function pt(t,e,n){if(Gt())return{allowed:!0,message:null,reason:"dev-bypass"};if(!t||!t.navigation||!t.navigation.gating)return{allowed:!0,message:null};const s=t.navigation.gating,r=s.conditions||[];if(r.length===0)return{allowed:!0,message:null};const i=s.mode||"all";let o=!1;return i==="all"?o=r.every(a=>dt(a,e,n)):i==="any"&&(o=r.some(a=>dt(a,e,n))),{allowed:o,message:o?null:s.message||"This content is currently locked.",reason:o?null:"gating-failed"}}function ht(t,e,n=null){if(Gt())return{allowed:!0,message:null,reason:"dev-bypass"};if(!t)return{allowed:!0,message:null};if(t.type==="assessment"){const r=e.get(t.assessmentId)?.completionRequirements;if(r?.blockNavigation===!0&&!qe(t.assessmentId,r)){let o="You must complete the assessment before continuing.";return r.requirePass?o="You must pass the assessment before continuing.":r.requireSubmission&&(o="You must submit your assessment before continuing."),{allowed:!1,message:o,reason:"assessment-incomplete"}}}return{allowed:!0,message:null}}class Si{#e;constructor(){this.#e=[]}initialize(){this.#e=k.getComments(),console.log("CommentManager initialized")}addComment(e,n=""){if(!e||typeof e!="string"||e.trim()==="")throw new Error("CommentManager: Comment text cannot be empty.");const s={text:e,location:n,timestamp:new Date().toISOString()};this.#e.push(s),k.addComment(s),console.log("Comment added and persisted to LMS:",s)}addRating(e){e!=null&&(Me.addLikertInteraction({id:"course-rating",response:String(e),description:"Overall course satisfaction rating on a 5-star scale."}),console.log("Rating added and persisted to LMS:",e))}getComments(){return[...this.#e]}}const We=new Si;let R={isInitialized:!1,initializationError:null,currentModal:null,modalStack:[],loadingVisible:!0,sidebarCollapsed:!0,footerCompleteMode:!1,exitButtonMode:"exit",courseExitLocked:!1,exitInProgress:!1,isExitIntentional:!1};function rs(){if(R.isInitialized)throw new Error("AppState: Already initialized. Do not call initAppState() more than once.");R.isInitialized=!0,console.log("[AppState] Initialized")}function Ei(){return z(R)}function is(){return R.isInitialized}function os(t){R.initializationError=t instanceof Error?t:new Error(String(t))}function $i(){return R.initializationError}function as(t){t&&R.currentModal!==t&&R.currentModal&&R.modalStack.push(R.currentModal),R.currentModal=t}function ki(){return R.currentModal}function cs(){R.currentModal=null}function Ai(){return R.modalStack.pop()||null}function ls(t){R.loadingVisible=!!t}function Ci(){return R.loadingVisible}function Kt(t){R.sidebarCollapsed=!!t}function xi(){return R.sidebarCollapsed}function Ii(){return R.sidebarCollapsed=!R.sidebarCollapsed,R.sidebarCollapsed}function ut(t){R.footerCompleteMode=!!t}function ds(){return R.footerCompleteMode}function Ot(t){if(t!=="exit"&&t!=="complete")throw new Error(`[AppState] Invalid exit button mode: ${t}. Valid modes: 'exit', 'complete'.`);R.exitButtonMode=t}function Mi(){return R.exitButtonMode}function us(t){R.courseExitLocked=!!t}function ms(){return R.courseExitLocked}function yt(t){R.exitInProgress=!!t}function Ti(){return R.exitInProgress}function fs(t){R.isExitIntentional=!!t}function gs(){return R.isExitIntentional}const _i=Object.freeze(Object.defineProperty({__proto__:null,clearCurrentModal:cs,getCurrentModal:ki,getExitButtonMode:Mi,getInitializationError:$i,getState:Ei,initAppState:rs,isCourseExitLocked:ms,isExitInProgress:Ti,isExitIntentional:gs,isFooterCompleteMode:ds,isInitialized:is,isLoadingVisible:Ci,isSidebarCollapsed:xi,popModalStack:Ai,setCourseExitLocked:us,setCurrentModal:as,setExitButtonMode:Ot,setExitInProgress:yt,setExitIntentional:fs,setFooterCompleteMode:ut,setInitializationError:os,setLoadingVisible:ls,setSidebarCollapsed:Kt,toggleSidebar:Ii},Symbol.toStringTag,{value:"Module"})),qi={correct:["âœ“ Excellent work!","âœ“ Perfect! You got it right.","âœ“ Outstanding! That's correct.","âœ“ Well done! Correct answer.","âœ“ Great job! You're right on target."],incorrect:["âœ— Not quite right. Let's review this concept.","âœ— That's incorrect, but good effort! Try again.","âœ— Close, but not correct. Think about it differently.","âœ— Not the right answer. Consider the key principles.","âœ— Incorrect. Let me provide some guidance."],partial:["âš¬ Partially correct. You're on the right track!","âš¬ Good progress! Some parts are right.","âš¬ You've got some of it! Keep working on the rest.","âš¬ Partly there! Review the areas you missed."],encouragement:["Keep trying! Learning takes practice.","You're making good progress!","Don't give up - you're learning!","Every attempt helps you understand better.","Great effort! Keep going!"]};function Ke(t){const e=qi[t];return!e||e.length===0?"Good work!":e[Math.floor(Math.random()*e.length)]}function Jt(t){return!t||t.length===0?0:t.reduce((n,s)=>n+(s.score||0),0)/t.length}function Zt(t){if(!t||t.length===0)return[];const e={};return t.forEach(n=>{const s=n.topic||"general";e[s]||(e[s]=[]),e[s].push(n.score||0)}),Object.entries(e).filter(([n,s])=>s.reduce((i,o)=>i+o,0)/s.length<.6&&s.length>=2).map(([n])=>n)}function Xt(t){if(!t||t.length===0)return[];const e={};return t.forEach(n=>{const s=n.topic||"general";e[s]||(e[s]=[]),e[s].push(n.score||0)}),Object.entries(e).filter(([n,s])=>s.reduce((i,o)=>i+o,0)/s.length>.8&&s.length>=2).map(([n])=>n)}function en(t){if(!t||t.length<3)return"multimodal";const e={};t.forEach(i=>{const o=i.type;o&&(e[o]||(e[o]={total:0,successful:0}),e[o].total++,(i.score||0)>.7&&e[o].successful++)});let n=null,s=0;return Object.entries(e).forEach(([i,o])=>{if(o.total>=3){const a=o.successful/o.total;a>s&&(s=a,n=i)}}),{hotspot:"visual","drag-drop":"hands-on","fill-in":"analytical",choice:"verbal",numeric:"analytical"}[n]||"multimodal"}function tn(t){if(!t||t.length<3)return"normal";const e=t.slice(-5).map(s=>s.timeSpent||3e4),n=e.reduce((s,r)=>s+r,0)/e.length;return n<15e3?"fast":n>6e4?"careful":"normal"}function Li(t,e){if(!t||t.length===0)return{averageScore:0,strugglingWith:[],strongIn:[],preferredStyle:"multimodal",pace:"normal",confidence:.5};const n=t.filter(r=>r.topic===e),s=t.slice(-10);return{averageScore:Jt(s),strugglingWith:Zt(t),strongIn:Xt(t),preferredStyle:en(t),pace:tn(t),confidence:Ri(n)}}function Ri(t){if(!t||t.length===0)return .5;let e=0,n=0;return t.forEach((s,r)=>{const i=Math.pow(1.2,r);e+=(s.score||0)*i,n+=i}),n>0?e/n:.5}function Oi(t,e=[]){const{correct:n,score:s=0,topic:r="general",difficulty:i=1,attempts:o=1}=t,a=Li(e,r),l={immediate:"",detailed:"",suggestions:[],resources:[],encouragement:""};return n?(l.immediate=Ke("correct"),s>=.9&&(l.immediate+=" You're mastering this topic!")):s>.5?l.immediate=Ke("partial"):l.immediate=Ke("incorrect"),a.strugglingWith.includes(r)&&(l.detailed=`I notice you're finding ${r} challenging. This is a complex concept that many learners work on. `,l.suggestions.push("Take some time to review the fundamentals"),l.resources.push(`Review the ${r} section again`),l.suggestions.push("Try breaking down the problem into smaller parts")),o>2&&(l.detailed+="You're showing persistence, which is great! ",l.suggestions.push("Consider a different approach to this problem"),l.encouragement=Ke("encouragement")),a.preferredStyle==="visual"?l.suggestions.push("Try creating a diagram or visual representation"):a.preferredStyle==="hands-on"&&l.suggestions.push("Try working through a practical example"),a.averageScore<.6&&i>1?l.suggestions.push("Let's try some easier examples first to build confidence"):a.averageScore>.8&&i<3&&l.suggestions.push("You're ready for more challenging questions!"),l}function Di(t){return t>=.9?"ðŸŒŸ Exceptional work! You're truly mastering this material!":t>=.7?"ðŸŽ¯ Great progress! You're doing really well!":t>=.5?"ðŸ“ˆ Good work! You're making steady progress!":t>=.3?"ðŸ’ª Keep going! Every step forward counts!":"ðŸŒ± Remember, learning takes time. You've got this!"}function zi(t,e=[]){const n={calculation:["Double-check your arithmetic","Make sure you're using the right formula","Check your units of measurement"],concept:["Think about the main principles we discussed","Consider how this relates to what you learned earlier","Try to connect this to a real-world example"],application:["Break the problem down into smaller steps","What information are you given? What do you need to find?","Have you seen a similar problem before?"]},s=t.category||"concept",r=n[s]||n.concept,i=e.map(a=>a.hint).filter(Boolean),o=r.filter(a=>!i.includes(a));return o.length>0?o[Math.floor(Math.random()*o.length)]:"Take your time and think through the problem step by step."}function Ni(t,e,n={}){if(!t||!(t instanceof HTMLElement))throw new Error("displayEnhancedFeedback: container must be a valid HTMLElement");if(!e)throw new Error("displayEnhancedFeedback: feedback parameter is required");const{showAnalytics:s=!1,analytics:r=null,learnerHistory:i=[]}=n,o=s&&i.length>0?{strengths:Xt(i),weaknesses:Zt(i),learningStyle:en(i),pace:tn(i)}:null,a=`
      <div class="enhanced-feedback" role="region" aria-label="Feedback and Progress">
        <div class="feedback-header">
          <div class="result-indicator ${e.immediate.startsWith("âœ“")?"success":"needs-improvement"}">
            ${e.immediate}
          </div>
          ${r&&r.overallProgress!==void 0?`
            <div class="progress-indicator">
              <span class="progress-label">Progress:</span>
              <span class="progress-value">${Math.round(r.overallProgress*100)}%</span>
            </div>
          `:""}
        </div>

        ${e.detailed?`
          <div class="detailed-feedback">
            <h4>Analysis:</h4>
            <p>${e.detailed}</p>
          </div>
        `:""}

        ${e.suggestions&&e.suggestions.length>0?`
          <div class="improvement-suggestions">
            <h4>Next Steps:</h4>
            <ul>
              ${e.suggestions.map(l=>`<li>${l}</li>`).join("")}
            </ul>
          </div>
        `:""}

        ${e.resources&&e.resources.length>0?`
          <div class="additional-resources">
            <h4>Resources:</h4>
            <ul>
              ${e.resources.map(l=>`<li>${l}</li>`).join("")}
            </ul>
          </div>
        `:""}

        ${e.encouragement?`
          <div class="encouragement-message">
            <p><strong>${e.encouragement}</strong></p>
          </div>
        `:""}

        ${s&&r&&o?`
          <div class="learning-insights">
            <details>
              <summary>View Your Learning Insights</summary>
              <div class="insights-content">
                ${r.topicMastery!==void 0?`
                  <div class="insight-item">
                    <span class="insight-label">Topic Mastery:</span>
                    <span class="insight-value">${Math.round(r.topicMastery*100)}%</span>
                  </div>
                `:""}
                ${r.sessionProgress!==void 0?`
                  <div class="insight-item">
                    <span class="insight-label">Session Interactions:</span>
                    <span class="insight-value">${r.sessionProgress}</span>
                  </div>
                `:""}
                <div class="insight-item">
                  <span class="insight-label">Learning Pace:</span>
                  <span class="insight-value">${o.pace}</span>
                </div>
                ${o.strengths.length>0?`
                  <div class="insight-item">
                    <span class="insight-label">Your Strengths:</span>
                    <span class="insight-value">${o.strengths.join(", ")}</span>
                  </div>
                `:""}
              </div>
            </details>
          </div>
        `:""}
      </div>
    `;t.innerHTML=a,ee(e.immediate),r&&r.overallProgress!==void 0&&setTimeout(()=>{ee(`Your overall progress is ${Math.round(r.overallProgress*100)}%`)},1e3)}function ji(t){if(!t||t.length===0)return 0;const e=t.slice(-10),n=Jt(e);if(e.length<2)return n;const s=e.map(l=>l.score||0),r=s.reduce((l,c)=>l+c,0)/s.length,i=s.reduce((l,c)=>l+Math.pow(c-r,2),0)/s.length,o=Math.sqrt(i),a=Math.max(0,1-o*2);return n*.7+a*.3}function ps(t=[],e=null){const n={strugglingWith:Zt(t),strongIn:Xt(t),learningStyle:en(t),pace:tn(t),averageScore:Jt(t)};return{interactions:t,patterns:n,sessionDuration:e,totalInteractions:t.length,averageScore:n.averageScore}}function hs(t,e,n){const s=ps(t,e);return{sessionDuration:e,totalInteractions:s.interactions.length,averageScore:s.interactions.reduce((r,i)=>r+(i.score||0),0)/Math.max(1,s.interactions.length),learningStyle:s.patterns.learningStyle,strugglingWith:s.patterns.strugglingWith,strongIn:s.patterns.strongIn,pace:s.patterns.pace,objectives:n}}const Pi=Object.freeze(Object.defineProperty({__proto__:null,calculateTopicMastery:ji,displayEnhancedFeedback:Ni,generateAdaptiveFeedback:Oi,generateContextualHint:zi,generateLearningReport:hs,getLearningAnalytics:ps,getMotivationalMessage:Di},Symbol.toStringTag,{value:"Module"}));function ys(){Bi(),v.on("navigation:beforeChange",({fromSlideId:t})=>ws(t)),v.on("navigation:changed",({toSlideId:t})=>sn(t)),v.on("navigation:completeCheck",bt),console.log("AppActions initialized.")}function Bi(){document.body.addEventListener("click",async t=>{const e=t.target.closest("[data-action]");if(!e)return;switch(e.dataset.action){case"exit-course":await Ui();break;case"confirm-exit":bs();break;case"confirm-complete":Hi();break;case"confirm-restart":Ss();break;case"complete-course":await Wi();break;case"generate-report":Fi(t);break;case"provide-feedback":Vi();break}})}function Fi(t){const e=t.target.closest(".slide-view-container");if(!e){console.error("[AppActions] Could not find root element for report generation.");return}const n=Me.getAllInteractions(),s=vs(),r=Ie.getObjectives(),i=hs(n,s,r),o=e.querySelector("#final-report");o&&(o.innerHTML=`
        <div class="learning-report">
          <h4>ðŸ“Š Detailed Learning Report</h4>
          <pre>${JSON.stringify(i,null,2)}</pre>
        </div>
      `)}async function Vi(){const t=prompt("Please provide feedback about your learning experience:");t&&(We.addComment(t,"course-feedback"),ee("Thank you for your feedback!"))}async function bt(){const t=dn(),e=k.getValue("cmi.completion_status")||"incomplete";if(!t){const c=e==="completed"&&k.getValue("cmi.success_status")||"unknown";return v.emit("course:statusChanged",{completionStatus:e,successStatus:c,isOnLastSlide:!1}),!1}if(e==="completed")return v.emit("course:statusChanged",{completionStatus:"completed",successStatus:k.getValue("cmi.success_status")||"unknown",isOnLastSlide:!0}),!0;const n=await lr("assessment"),s=await Nn(),o=n.filter(c=>s.get(c.assessmentId)?.completionRequirements?.requireSubmission).every(c=>qe(c.assessmentId,{requireSubmission:!0}))?"completed":"incomplete",a=n.filter(c=>s.get(c.assessmentId)?.completionRequirements?.requirePass);let l="unknown";return a.length>0?l=a.every(d=>qe(d.assessmentId,{requirePass:!0}))?"passed":"failed":o==="completed"&&(l="passed"),k.setValue("cmi.completion_status",o),k.setValue("cmi.success_status",l),v.emit("course:statusChanged",{completionStatus:o,successStatus:l,isOnLastSlide:!0}),!0}function nn(){fs(!0)}function bs(){nn(),yt(!0);const t=ne();if(t){Ft(t);const n=ln();if(n){const s=n.filter(r=>r.navigation?.sequence?.included!==!1).length;k.updateProgressMeasure(s)}}k.exitCourseWithSuspend()?v.emit("ui:lockCourseForExit"):$e("We were unable to finalize the session automatically. Please close this window manually.","warning",6e3)}function Hi(){nn(),yt(!0);const t=ne();if(t){Ft(t);const r=ln();if(r){const i=r.filter(o=>o.navigation?.sequence?.included!==!1).length;k.updateProgressMeasure(i)}}const{rating:e,comment:n}=fo();e&&We.addRating(e),n&&We.addComment(n,"course-completion"),k.exitCourseComplete()?v.emit("ui:lockCourseForExit"):$e("We were unable to finalize the session automatically. Please close this window manually.","warning",6e3)}async function Ui(){if(await bt()){rn();return}v.emit("ui:showModal","exit")}async function Wi(){await bt(),rn()}function sn(t){if(!t)throw new Error("[AppActions] startSessionTimer called without slideId");const e=k.getDomainState("sessionData")||{};e.slideStartTimes=e.slideStartTimes||{},e.slideDurations=e.slideDurations||{};const n=e.slideStartTimes[t];if(n){const s=Date.now()-n;e.slideDurations[t]=(e.slideDurations[t]||0)+s}e.slideStartTimes[t]=Date.now(),k.setDomainState("sessionData",e),console.log(`[AppActions] Session timer started for: ${t}`)}function ws(t){if(!t)throw new Error("[AppActions] endSessionTimer called without slideId");const e=k.getDomainState("sessionData")||{};e.slideStartTimes=e.slideStartTimes||{},e.slideDurations=e.slideDurations||{};const n=e.slideStartTimes[t];if(!n)return null;const s=Date.now()-n;return e.slideDurations[t]=(e.slideDurations[t]||0)+s,delete e.slideStartTimes[t],k.setDomainState("sessionData",e),console.log(`[AppActions] Session timer ended for: ${t}, duration: ${s}ms`),s}function vs(){const e=(k.getDomainState("sessionData")||{}).slideDurations||{};return Object.values(e).reduce((n,s)=>n+s,0)}function rn(){const t=P.completion||{};v.emit("ui:prepareCompletionModal",{promptForComments:!!t.promptForComments,promptForRating:!!t.promptForRating}),v.emit("ui:showModal","complete")}function Ss(){try{k.clearAllData(),window.location.reload()}catch(t){const e={domain:"app",operation:"restartCourse",message:`Failed to restart course: ${t.message}`,stack:t.stack,context:{originalError:t}};throw v.emit("app:error",e),new Error(e.message)}}const Qi=Object.freeze(Object.defineProperty({__proto__:null,checkCompletion:bt,endSessionTimer:ws,exit:bs,getSessionDuration:vs,initAppActions:ys,restartCourse:Ss,setExitFlag:nn,showCompletionModal:rn,showNotification:$e,startSessionTimer:sn},Symbol.toStringTag,{value:"Module"}));let F=[],Dt=[],on,K=new Map,xe=!1,an=!1,zt=[],Ct=!1,Je=null,Ze=null;function fe(t,e,n={}){const s=new Error(`Navigation failed: ${e}`);return v.emit("navigation:error",{domain:"navigation",operation:t,message:s.message,stack:s.stack,context:n}),s}async function Es(t,e,n=[],s=new Map){if(!t||!Array.isArray(t))throw new Error("NavigationActions.init() requires a valid slides array");if(!e)throw new Error("NavigationActions.init() requires a valid viewManager instance");F=t,on=e,Dt=n,K=s,xe=!1,an=!0,qr(),Lr(t);const r=Qe(),i=cn();yi(Dt,r,i),document.body.addEventListener("click",l=>{const c=l.target.closest("[data-action]");if(!c)return;const d=c.dataset.action;if(xe){l.preventDefault();return}switch(d){case"nav-menu-item":Ki(l);break;case"nav-prev":Ji();break;case"nav-next":Zi();break}}),v.on("state:changed",({domain:l})=>{(l.startsWith("assessment_")||l==="objectives"||l==="flags")&&_e()}),v.on("ui:lockCourseForExit",()=>{xe=!0});const o=de(),a=F[o];if(!a)throw fe("initial-load",`No slide found for initial index ${o}. Check course-config.js ordering.`,{slideIndex:o});try{await ce(a.id)}catch(l){throw v.emit("navigation:error",{domain:"navigation",operation:"initial-load",message:l.message,stack:l.stack,context:{slideId:a.id,slideIndex:o}}),l}console.log("NavigationActions initialized.")}function X(){if(!an)throw new Error("NavigationActions not initialized. Call init() first.")}function Nt(){return an}function Yi(t){if(!t||!t.engagement){kn();return}const e=t.engagement;if(e.required&&e.showIndicator){const n=H.getProgress(t.id);n&&Rt(n)}else kn()}function Gi(t){Je&&v.off("engagement:progress",Je),Ze&&v.off("engagement:complete",Ze),t&&t.engagement&&t.engagement.required&&(Je=({slideId:e,progress:n})=>{e===t.id&&(t.engagement.showIndicator&&Rt(n),_e())},Ze=({slideId:e})=>{if(e===t.id){if(t.engagement.showIndicator){const n=H.getProgress(e);n&&Rt(n)}_e()}},v.on("engagement:progress",Je),v.on("engagement:complete",Ze))}function wt(t){for(let e=t+1;e<F.length;e++){const n=F[e];if(Te(n,k,K))return{index:e,slide:n,accessCheck:pt(n,k,K)}}return{index:null,slide:null,accessCheck:{allowed:!0,message:null}}}function $s(t){for(let e=t-1;e>=0;e--){const n=F[e];if(Te(n,k,K))return{index:e,slide:n,accessCheck:pt(n,k,K)}}return{index:null,slide:null,accessCheck:{allowed:!0,message:null}}}function Ki(t){t.preventDefault();const e=t.target.closest('[data-action="nav-menu-item"]');if(!e)return;const n=e.querySelector("a");if(e.classList.contains("locked")||n&&n.getAttribute("aria-disabled")==="true")return;const s=e.dataset.slideId;s&&ce(s).catch(r=>{console.warn("Navigation failed:",r.message)})}function Ji(){Cs().catch(t=>{console.warn("Navigation failed:",t.message)})}function Zi(){As().catch(t=>{console.warn("Navigation failed:",t.message)})}async function ce(t,e={}){return X(),new Promise((n,s)=>{zt.push({slideId:t,context:e,resolve:n,reject:s}),ks()})}async function ks(){if(Ct||zt.length===0)return;Ct=!0;const{slideId:t,context:e,resolve:n,reject:s}=zt.shift();try{await Xi(t,e),n()}catch(r){s(r)}finally{Ct=!1,ks()}}async function Xi(t,e={}){if(xe)throw fe("goToSlide","Navigation is locked. Course is in exit process.",{slideId:t});const n=await zn(t);if(n==null)throw fe("goToSlide",`Slide "${t}" not found in course structure. Check that the slide ID exists in course-config.js.`,{slideId:t,availableSlides:F.map(p=>p.id)});const s=F[n];if(!s)throw fe("goToSlide",`Slide at index ${n} is undefined. This indicates a data consistency issue.`,{slideId:t,slideIndex:n});if(!Te(s,k,K)){const p=s.navigation?.sequence?.message||"This content is not available right now.";throw $e(p,"info",3e3),v.emit("navigation:blocked",{slideId:s.id,slideIndex:n,message:p,reason:"sequence-excluded"}),fe("goToSlide",p,{slideId:s.id,reason:"sequence-excluded"})}const r=pt(s,k,K);if(!r.allowed)throw $e(r.message,"info",3e3),v.emit("navigation:blocked",{slideId:s.id,slideIndex:n,message:r.message,reason:"gating-condition"}),fe("goToSlide",r.message,{slideId:s.id,reason:"gating-condition"});const i=de();let o=null;if(i!==null&&i!==n){const p=F[i];p&&(o=p.id,Ft(p.id),_e(),v.emit("navigation:beforeChange",{fromSlideId:p.id}))}Vn(n),ns(s.id),await on.showView(s.id,{...e,fromSlide:o});const a=ht(s,K,s.id),l=wt(n),c=l.accessCheck;let d=!0,f={complete:!0,unmetRequirements:[]};gt()||(f=H.evaluateRequirements(s.id),d=f.complete);const m=!d||!a.allowed||!c.allowed,u=d?a.message||c.message:ss(f.unmetRequirements);Yt({isFirstSlide:n===0,isLastSlide:l.slide===null,nextBlocked:m,nextBlockedMessage:u}),Gi(s),Yi(s),sn(t);const g=F.filter(p=>Te(p,k,K)).length;k.updateProgressMeasure(g),_e(),v.emit("navigation:changed",{toSlideId:s.id}),v.emit("navigation:completeCheck")}function eo(){X(),Vn(0),Rr(),ns(F[0]?.id);const t=F[0],e=ht(t,K,t?.id);Yt({isFirstSlide:!0,isLastSlide:F.length===1,nextBlocked:!e.allowed,nextBlockedMessage:e.message}),on.showView(F[0]?.id)}function cn(){X();const t=new Map,e=Qe(),n=de(),s=F[n];return F.forEach((r,i)=>{if(!Te(r,k,K)){t.set(r.id,{allowed:!1,message:r.navigation?.sequence?.message||"This content is not available right now."});return}const a=pt(r,k,K);if(!a.allowed){t.set(r.id,a);return}if(s&&r.id===s.id){t.set(r.id,{allowed:!0,message:null});return}let l=!1,c=null;if(!gt())for(let d=0;d<i;d++){const f=F[d];if(Te(f,k,K)){const m=f.engagement;if(m&&m.required===!0)if(e.includes(f.id)){if(!H.evaluateRequirements(f.id).complete){l=!0,c=f.title||f.id;break}}else{l=!0,c=f.title||f.id;break}}}if(l){const d=c?`Complete all required content in "${c}" before continuing.`:"Complete all required content on previous slides before continuing.";t.set(r.id,{allowed:!1,message:d});return}t.set(r.id,{allowed:!0,message:null})}),t}function _e(){X();const t=de(),e=F[t],n=cn();for(const[u,g]of n.entries())g.allowed?wi(u):bi(u);const s=Qe();F.forEach(u=>{const g=s.includes(u.id);if(u.type==="assessment"){const h=K.get(u.assessmentId)?.completionRequirements;let b=!1;h&&(b=qe(u.assessmentId,h)),g&&b?En(u.id):$n(u.id)}else g?En(u.id):$n(u.id)});const r=ht(e,K,e?.id),i=wt(t),o=i.accessCheck;let a=!0,l={complete:!0,unmetRequirements:[]};gt()||(l=H.evaluateRequirements(e.id),a=l.complete);const c=t===0,d=i.slide===null,f=!a||!r.allowed||!o.allowed,m=a?r.message||o.message:ss(l.unmetRequirements);Yt({isFirstSlide:c,isLastSlide:d,nextBlocked:f,nextBlockedMessage:m})}async function As(){if(X(),xe)throw fe("goToNextAvailableSlide","Navigation is locked. Course is in exit process.",{});const t=de(),e=F[t];if(!gt()){const o=H.evaluateRequirements(e.id);if(!o.complete){v.emit("navigation:blocked",{reason:"engagement_incomplete",slideId:e.id,unmetRequirements:o.unmetRequirements});return}}const n=ht(e,K,e.id);if(!n.allowed){$e(n.message,"warning",3e3);return}const s=e.navigation?.controls,r=s?.nextTarget||s?.exitTarget;if(r){await ce(r);return}const{slide:i}=wt(t);i&&await ce(i.id)}async function Cs(){if(X(),xe)throw fe("goToPreviousAvailableSlide","Navigation is locked. Course is in exit process.",{});const t=de(),s=F[t].navigation?.controls?.previousTarget;if(s){await ce(s);return}const{slide:r}=$s(t);r&&await ce(r.id)}function xs(){X();const t=de();return wt(t)}function to(){X();const t=de();return $s(t)}function ln(){return X(),F}function Is(){X();const t=de();return F[t]||null}function no(){X();const t=Is();return t?t.id:null}function so(){return X(),Dt}function dn(){return X(),xs().slide===null}const ro=Object.freeze(Object.defineProperty({__proto__:null,checkAllSlidesAccessibility:cn,getAllSlides:ln,getCurrentSlide:Is,getCurrentSlideId:no,getMenuTree:so,getNextSequentialSlideInfo:xs,getPreviousSequentialSlideInfo:to,goToNextAvailableSlide:As,goToPreviousAvailableSlide:Cs,goToSlide:ce,init:Es,isOnLastSlide:dn,isReady:Nt,resetNavigation:eo,sync:_e},Symbol.toStringTag,{value:"Module"}));function ue(t,e){if(!t||typeof t!="object")throw new Error("Interaction config must be an object");if(!t.id||typeof t.id!="string")throw new Error("Interaction must have a valid string id");if(!t.prompt||typeof t.prompt!="string")throw new Error(`Interaction "${t.id}" must have a valid prompt`);for(const n of e)if(t[n]===void 0)throw new Error(`Interaction "${t.id}" is missing required property: ${n}`)}function pe(t,e,n={}){return function(r){const i=r.target.closest("[data-action]");if(!i)return;const o=i.dataset.action;if(i.dataset.interaction===e.id)switch(o){case"check-answer":const a=t.checkAnswer();if(!a)return;const l=ne();l&&H.trackInteraction(l,e.id,!0,a.correct),e.controlled||Ms(e,a);break;case"reset":t.reset();break;case"show-hint":t.showHint&&t.showHint();break;default:n[o]&&n[o](r,i);break}}}function Ms(t,e){const n={id:t.id,type:t.scormType||"other",learner_response:e.response,result:e.correct?"correct":"incorrect",correct_responses:e.correctResponses||[{pattern:t.correctPattern||""}],description:t.prompt};try{Me.record(n)}catch(s){throw v.emit("interaction:error",{domain:"interaction",operation:"record",message:`Failed to record interaction "${t.id}": ${s.message}`,stack:s.stack,context:{interactionId:t.id}}),s}}function me(t,e=!1,n=[]){if(e)return"";const s=[`<button type="button" class="btn btn-success" data-action="check-answer" data-interaction="${t}" data-testid="${t}-check-answer">Check Answer</button>`,`<button type="button" class="btn btn-reset" data-action="reset" data-interaction="${t}" data-testid="${t}-reset">Reset</button>`,...n];return`<div class="flex flex-wrap justify-center gap-3 m-4" data-testid="${t}-controls">${s.join("")}</div>`}function Oe(t){return`<div id="${t}_feedback" class="feedback" aria-live="polite" data-testid="${t}-feedback"></div>`}function U(t,e,n,s="info"){if(!t)throw new Error(`Cannot display feedback: container is null for interaction "${e}"`);const r=t.querySelector(`#${e}_feedback, .feedback, .overall-feedback`);if(!r)throw new Error(`Feedback element not found for interaction "${e}"`);const i=s==="correct"?"âœ“":s==="incorrect"?"âœ—":"";r.innerHTML=`<div class="feedback ${s}">${i} ${n}</div>`}function he(t,e){if(!t)return;const n=t.querySelector(`#${e}_feedback, .feedback, .overall-feedback`);n&&(n.innerHTML="")}function ke(t){return t==null||t===""?null:t}function le(t){if(typeof CSS<"u"&&typeof CSS.escape=="function")return CSS.escape(t);throw new Error("CSS.escape is not available and is required for safe selector escaping")}function T(t,e){if(!t)throw new Error(`Container is null for interaction "${e}". Ensure render() was called first.`);if(!(t instanceof Element))throw new Error(`Container must be a DOM Element for interaction "${e}"`)}function vt(t,e="any"){if(t==null)return null;if(e==="array"&&Array.isArray(t)||e==="object"&&typeof t=="object"&&!Array.isArray(t))return t;if(typeof t=="string"){const n=t.trim();if(!n)return null;try{const s=JSON.parse(n);if(e==="array"&&!Array.isArray(s))throw new Error(`Expected array, got ${typeof s}`);if(e==="object"&&(typeof s!="object"||Array.isArray(s)))throw new Error(`Expected object, got ${Array.isArray(s)?"array":typeof s}`);return s}catch(s){if(e==="array"||e==="object")throw new Error(`Failed to parse response as JSON: ${s.message}`);return n}}return t}function Ae(t,e){lt.register(t,e)}const io={creator:"createLikertQuestion",scormType:"likert",showCheckAnswer:!0,isAnswered:t=>!t||typeof t!="object"?!1:Object.keys(t).length>0,getCorrectAnswer:t=>JSON.stringify(t.correctAnswers||{}),formatCorrectAnswer:(t,e)=>{if(!e||Object.keys(e).length===0)return'<p class="correct-item">No correct answer (Survey)</p>';let n='<ul class="list-disc pl-4 m-0">';const s=typeof e=="string"?JSON.parse(e):e;return Object.entries(s).forEach(([r,i])=>{const o=t.questions.find(l=>l.id===r),a=t.scale.find(l=>l.value===i);o&&a&&(n+=`<li class="correct-item">${o.text}: <strong>${a.text}</strong></li>`)}),n+="</ul>",n},formatUserResponse:(t,e)=>{let n='<ul class="list-disc pl-4 m-0">';const s=typeof e=="string"?JSON.parse(e):e;return Object.entries(s).forEach(([r,i])=>{const o=t.questions.find(l=>l.id===r),a=t.scale.find(l=>l.value===i);o&&(n+=`<li class="response-item">${o.text}: <strong>${a?a.text:i}</strong></li>`)}),n+="</ul>",n}};function Ts(t){ue(t,["scale","questions"]);const{id:e,prompt:n,scale:s,questions:r,correctAnswers:i,controlled:o=!1}=t;if(!Array.isArray(s)||s.length===0)throw new Error(`Likert question "${e}" must have at least one scale option`);if(!Array.isArray(r)||r.length===0)throw new Error(`Likert question "${e}" must have at least one question`);let a=null;const l={id:e,type:"likert",render:(c,d=null)=>{T(c,e),a=c;const f=ke(d),m=typeof f=="object"?f:{};let u=`
                <div class="interaction likert" data-interaction-id="${e}">
                    <div class="question-prompt">
                        <h3>${n}</h3>
                    </div>
                    <div class="likert-container">
                        <table class="likert-table" role="presentation">
                            <thead>
                                <tr>
                                    <th class="likert-header-question">Statement</th>
            `;s.forEach(g=>{u+=`<th class="likert-header-option">${g.text}</th>`}),u+=`
                                </tr>
                            </thead>
                            <tbody>
            `,r.forEach((g,p)=>{u+=`
                    <tr class="likert-row ${p%2===0?"even":"odd"}" role="radiogroup" aria-labelledby="q-label-${g.id}">
                        <td class="likert-question-text" id="q-label-${g.id}">${g.text}</td>
                `,s.forEach(h=>{const b=m[g.id]===h.value,y=`likert-${e}-${g.id}-${h.value}`;u+=`
                        <td class="likert-option">
                            <label for="${y}" class="sr-only">${h.text}</label>
                            <input type="radio" 
                                   id="${y}" 
                                   name="likert-${e}-${g.id}" 
                                   value="${h.value}"
                                   data-question-id="${g.id}"
                                   ${b?"checked":""}>
                        </td>
                    `}),u+="</tr>"}),u+=`
                            </tbody>
                        </table>
                    </div>
                    ${Oe()}
                    ${me(e,o)}
                </div>
            `,c.innerHTML=u,c.addEventListener("click",pe(l,t))},getResponse:()=>{const c={};return a&&a.querySelectorAll('input[type="radio"]:checked').forEach(f=>{c[f.dataset.questionId]=f.value}),c},setResponse:c=>{!c||typeof c!="object"||l.render(a,c)},checkAnswer:()=>{const c={};a.querySelectorAll('input[type="radio"]:checked').forEach(p=>{c[p.dataset.questionId]=p.value}),Object.keys(c).length;const f=r.length;let m=!0,u=0;if(i){let p=0;Object.entries(i).forEach(([h,b])=>{c[h]!==b?m=!1:p++}),u=p/f}else m=!0,u=1;const g={correct:m,score:u,response:c,feedback:m?t.feedback?.correct||"Thank you for your feedback.":t.feedback?.incorrect||"Please review your answers."};return U(a,g.correct,g.feedback),g},reset:()=>{he(a),a.querySelectorAll('input[type="radio"]').forEach(d=>d.checked=!1)},showHint:()=>{}};return l}const oo=`
  <div class="completion-feedback-container">
    <div id="completion-rating-section" class="feedback-section" hidden>
      <div id="completion-rating-container"></div>
    </div>
    <div id="completion-comments-section" class="feedback-section" hidden>
      <label for="completion-comments-textarea">Leave a comment (optional):</label>
      <textarea id="completion-comments-textarea" class="feedback-textarea" rows="4" data-testid="completion-comments"></textarea>
    </div>
  </div>
`;let mt=null;const ao={exit:{title:"Exit Course",body:`
            <p>Are you sure you want to exit the course?</p>
            <p><strong>Your progress will be saved automatically.</strong> You can resume exactly where you left off when you return.</p>
        `,footer:`
            <button class="btn btn-secondary" data-action="close-modal" data-testid="modal-exit-cancel">Cancel</button>
            <button class="btn btn-primary" data-action="confirm-exit" data-testid="modal-exit-confirm">Exit Course</button>
        `,config:{closeOnBackdrop:!0,closeOnEscape:!0}},complete:{title:"Course Complete!",body:`
            <p><strong>Congratulations!</strong> You have successfully completed this course.</p>
            <p>Your completion status and final score have been recorded in the Learning Management System.</p>
            <p>When you click "Complete & Exit" below, this window will close and you will be returned to the LMS.</p>
            ${oo}
        `,footer:`
            <button class="btn btn-secondary" data-action="close-modal" data-testid="modal-complete-cancel">Cancel</button>
            <button class="btn btn-primary" data-action="confirm-complete" data-testid="modal-complete-confirm">Complete & Exit</button>
        `,config:{closeOnBackdrop:!0,closeOnEscape:!0}},postExit:{title:"Session Closed",body:`
            <p>Your progress has been saved in the LMS. It is now safe to close this window.</p>
            <p>If this window does not close automatically, please close it manually and return to the LMS.</p>
        `,footer:"",config:{closeOnBackdrop:!1,closeOnEscape:!1}},restart:{title:"Restart Course",body:`
            <p class="font-bold text-error">Are you sure you want to restart the entire course?</p>
            <p>This will permanently erase ALL of your progress, including assessment scores and engagement history. This action cannot be undone.</p>
        `,footer:`
            <button class="btn btn-secondary" data-action="close-modal" data-testid="modal-restart-cancel">Cancel</button>
            <button class="btn btn-primary" data-action="confirm-restart" data-testid="modal-restart-confirm">Restart Course</button>
        `,config:{closeOnBackdrop:!0,closeOnEscape:!0}}};document.getElementById("app");const An=document.getElementById("loading"),ve=document.querySelector('footer[role="contentinfo"]');let be=ve&&ve.style.display||"";const B=document.getElementById("exitBtn"),co=B?B.innerHTML:"",Cn=B?B.getAttribute("aria-label"):null,xn=B?B.getAttribute("title"):null,lo=B&&B.dataset.action||"exit-course",In=document.getElementById("prevBtn"),Mn=document.getElementById("nextBtn");let Se=null,Ve=null,Ee=null;function uo(){Wn(),Kn(),console.log("AppUI initialized: Dynamic Modal and Notification systems are ready."),go(),console.log("Sidebar toggle initialized."),yo(),console.log("Branding initialized."),v.on("ui:prepareCompletionModal",({promptForComments:t,promptForRating:e})=>{}),v.on("ui:showModal",_s),v.on("ui:hideModal",qs),v.on("navigation:changed",()=>{xt()}),v.on("course:statusChanged",()=>{xt()}),v.on("ui:lockCourseForExit",bo),v.on("scorm:error",t=>{if(["Commit","SetValue","Initialize","Terminate"].includes(t.operation)){console.error("[AppUI] Critical SCORM Error detected:",JSON.stringify(t,null,2));let n="Connection error: Your progress may not be saved.";t.operation==="Commit"||t.operation==="SetValue"?n="Failed to save progress. Please check your internet connection.":t.operation==="Initialize"&&(n="Course failed to connect to the LMS. Progress will not be tracked."),Ue(n,"error",5e3)}}),xt()}function mo(){An&&(An.style.display="none",ls(!1))}function _s(t){const e=ao[t];if(!e)throw new Error(`[AppUI] Modal definition not found for key: ${t}`);t==="complete"&&(e.onOpen=()=>{const n=P.completion||{},s=document.getElementById("completion-rating-section"),r=document.getElementById("completion-comments-section");s&&n.promptForRating&&(s.hidden=!1,po()),r&&n.promptForComments&&(r.hidden=!1)}),as(t),ft(e)}function qs(){cs(),we()}function $e(t,e="info",n=5e3){Ue(t,e,n)}function fo(){let t=null;if(mt){const s=mt.getResponse();s&&s.overall&&(t=s.overall)}const e=document.getElementById("completion-comments-textarea"),n=e&&e.value.trim()?e.value:null;return{rating:t,comment:n}}function go(){if(Se=document.getElementById("sidebar-toggle"),Ve=document.getElementById("sidebar"),Ee=document.getElementById("sidebar-backdrop"),!Se||!Ve)throw new Error("Sidebar toggle elements not found.");Se.addEventListener("click",ho),Ee&&Ee.addEventListener("click",jt),document.addEventListener("keydown",t=>{t.key==="Escape"&&!Ve.classList.contains("collapsed")&&jt()})}function po(){const t=document.getElementById("completion-rating-container");t&&(t.innerHTML="",mt=Ts({id:"course-rating",prompt:"How would you rate this course?",scale:[{value:"1",text:"1 Star"},{value:"2",text:"2 Stars"},{value:"3",text:"3 Stars"},{value:"4",text:"4 Stars"},{value:"5",text:"5 Stars"}],questions:[{id:"overall",text:"Overall Rating"}],feedback:{correct:"Thank you for your rating!"}}),mt.render(t))}function ho(){const t=Ve.classList.toggle("collapsed");Kt(t),Se.setAttribute("aria-expanded",String(!t)),Ee&&Ee.classList.toggle("visible",!t)}function jt(){Ve.classList.add("collapsed"),Kt(!0),Se.setAttribute("aria-expanded","false"),Ee&&Ee.classList.remove("visible")}function Ne(){ve&&(be==null&&(be=""),ve.style.display=be)}function Ls(){ve&&(be==null&&(be=ve.style.display||""),ve.style.display="none")}function yo(){const t=document.getElementById("brand");if(!t)throw new Error("Brand container #brand not found.");const{branding:e={}}=P,{logo:n,logoAlt:s,courseTitle:r}=e,i=r||P.metadata?.title||"Course";let o="";n&&(o+=`<img src="${n}" alt="${s||e.companyName||"Logo"}" class="logo" />`),o+=`<span class="brand-title">${i}</span>`,t.innerHTML=o}async function xt(){if(!B||ms()||!(typeof Nt=="function"?Nt():!0))return;const e=dn(),n=k.getValue("cmi.completion_status")||"incomplete",s=e&&n==="completed";s!==ds()&&(s?(B.dataset.action="complete-course",B.innerHTML='<span aria-hidden="true">âœ…</span> Complete Course',B.setAttribute("aria-label","Complete Course"),B.setAttribute("title","Complete the course and return to the LMS"),ut(!0),Ot("complete")):(B.dataset.action=lo,B.innerHTML=co,Cn?B.setAttribute("aria-label",Cn):B.removeAttribute("aria-label"),xn?B.setAttribute("title",xn):B.removeAttribute("title"),ut(!1),Ot("exit")))}function bo(){us(!0),ut(!1),yt(!0),B&&(B.removeAttribute("data-action"),B.textContent="Course Complete",B.disabled=!0),In&&(In.disabled=!0),Mn&&(Mn.disabled=!0),Se&&(Se.disabled=!0),jt(),qs(),_s("postExit")}function wo(t,e,n){const s=t.length,r=s===1?"question":"questions",i=t.map(l=>l+1).join(", ");let o=null;const a=e?{title:"Unanswered Questions",body:`
            <p class="mb-3">You have <strong>${s} unanswered ${r}</strong> (${i}).</p>
            <p class="mb-3">Unanswered questions will be marked as incorrect.</p>
            <p class="font-bold">Do you want to submit anyway?</p>
        `,footer:`
            <button class="btn btn-secondary" data-action="dismiss-unanswered-modal" data-testid="modal-unanswered-cancel">Go Back</button>
            <button class="btn btn-primary" data-action="confirm-unanswered-submit" data-testid="modal-unanswered-confirm">Submit Anyway</button>
        `}:{title:"All Questions Required",body:`
            <p class="mb-3">You must answer all questions before submitting.</p>
            <p class="mb-3">You have <strong>${s} unanswered ${r}</strong> (${i}).</p>
            <p class="font-bold">Please go back and complete all questions.</p>
        `,footer:`
            <button class="btn btn-primary" data-action="dismiss-unanswered-modal" data-testid="modal-unanswered-dismiss">Go Back</button>
        `};ft({...a,config:{closeOnBackdrop:!0,closeOnEscape:!0},onOpen:()=>{const l=document.getElementById("global-modal");l&&(o=c=>{const d=c.target.closest("[data-action]");if(!d)return;const f=d.dataset.action;f==="confirm-unanswered-submit"&&e?(we(),n()):f==="dismiss-unanswered-modal"&&we()},l.addEventListener("click",o))},onClose:()=>{const l=document.getElementById("global-modal");l&&o&&l.removeEventListener("click",o)}})}function vo(t,e,n){if(!t||!t.id)throw new Error("[AssessmentUI] config with id is required");const{settings:s,review:r,resultsDisplay:i}=t;function o(){const u=e.getSummary()?.attempts||0,g=s.attemptsBeforeRemedial,p=s.attemptsBeforeRestart;let h="";if(u>0)if(p&&u>=p)h=` | <strong>Attempts:</strong> ${u} (course retake is required)`;else if(g&&u>=g)if(p){const y=p-u;h=` | <strong>Attempts:</strong> ${u} (${y} before a course retake will be required)`}else h=` | <strong>Attempts:</strong> ${u}`;else if(g){const y=g-u;h=` | <strong>Attempts:</strong> ${u} (${y} before additional review will be required)`}else if(p){const y=p-u;h=` | <strong>Attempts:</strong> ${u} (${y} before a course retake will be required)`}else h=` | <strong>Attempts:</strong> ${u}`;const b=document.createElement("div");return b.className="content-medium stack-lg",b.innerHTML=`
        <div class="card no-hover text-center stack-md">
            <h1 class="text-2xl font-bold">${t.title||"Assessment"}</h1>
            <div class="bg-gray-50 border rounded p-4 text-sm">
                <p class="m-0"><strong>Questions:</strong> ${t.questions.length} | <strong>Passing Score:</strong> ${s.passingScore}%${h}</p>
            </div>
            <div class="d-flex justify-center">
                <button data-action="start" class="btn btn-primary btn-lg" data-testid="assessment-start">Start Assessment</button>
            </div>
        </div>
    `,b}function a(){const m=e.getCurrentQuestionIndex(),u=n[m];if(!u){const w=`[AssessmentUI:${t.id}] Question instance not found for index ${m} (assessment has ${n.length} questions)`;throw v.emit("assessment:error",w),new Error(w)}const g=document.createElement("div");g.className="content-medium";const p=document.createElement("div");p.className="card no-hover stack-md";const h=document.createElement("h1");if(h.className="text-xl font-bold m-0",h.textContent=t.title||"Assessment",p.appendChild(h),s.showProgress){const w=document.createElement("p");w.className="text-muted text-sm m-0",w.textContent=`Question ${m+1} of ${t.questions.length}`,p.appendChild(w)}const b=document.createElement("div");u.render(b),u.restoreFromSCORM(),p.appendChild(b);const y=l();return y.className="d-flex justify-between items-center mt-6 pt-4 border-top",p.appendChild(y),g.appendChild(p),g}function l(){const m=document.createElement("div"),u=e.getCurrentQuestionIndex(),g=u===0,p=u===t.questions.length-1,b=e.getSession()?.reviewReached||!1,y=`<button class="btn btn-secondary" data-action="prev" data-testid="assessment-nav-prev" ${g?"disabled":""}>Previous</button>`,S=`<button class="btn btn-primary" data-action="next" data-testid="assessment-nav-next">${p?s.allowReview?"Review":"Submit":"Next"}</button>`,E=b&&s.allowReview?'<button class="btn btn-secondary" data-action="jump-to-review" data-testid="assessment-jump-to-review">Jump to Review</button>':"";let A="";return s.showProgress&&(A=`<span class="text-sm text-muted">Question ${u+1} / ${t.questions.length}</span>`),m.innerHTML=`${y}${A}<div class="d-flex gap-2">${E}${S}</div>`,m}function c(){const m=document.createElement("div");m.className="content-medium";const u=e.getSession();if(!u)throw new Error(`Assessment '${t.id}' has no session - state corrupted`);const g=u.responses||{},p=t.questions.every((b,y)=>n[y].metadata.isAnswered(g[y]));let h=t.questions.map((b,y)=>{const w=g[y],E=n[y].metadata.isAnswered(w),A=E?"bg-success text-white":"bg-gray-200 text-muted",L=E?"Answered":"Not Answered",q=b.prompt||b.questionText||"Question",C=q.length>60?q.substring(0,60)+"...":q;return`
        <li class="d-flex justify-between items-center p-3 bg-gray-50 rounded">
          <div class="d-flex items-center gap-3 flex-1">
            <span class="font-bold text-muted">Q${y+1}</span>
            <span class="text-sm">${C}</span>
          </div>
          <div class="d-flex items-center gap-3">
            <span class="text-xs px-2 py-1 rounded ${A}">${L}</span>
            <button class="btn btn-sm btn-outline-secondary" data-action="review-question" data-question-index="${y}" data-testid="assessment-review-question-${y}">Edit</button>
          </div>
        </li>
      `}).join("");return m.innerHTML=`
      <div class="card no-hover stack-md">
        <div>
            <h2 class="text-xl font-bold m-0">Review Your Answers</h2>
            <p class="text-muted m-0">Please review your answers before submitting the assessment.</p>
        </div>
        
        <ul class="list-none stack-sm m-0 p-0">${h}</ul>
        
        ${!p&&r.requireAllAnswered?'<div class="callout callout-error">You must answer all questions before submitting.</div>':""}
        
        <div class="d-flex justify-between mt-4 pt-4 border-top">
          <button class="btn btn-secondary" data-action="back-to-questions" data-testid="assessment-back-to-questions">Back to Questions</button>
          <button class="btn btn-primary" data-action="submit" data-testid="assessment-submit" ${!p&&r.requireAllAnswered?"disabled":""}>Submit Assessment</button>
        </div>
      </div>
    `,m}function d(m){if(!m){const E=document.createElement("div");return E.textContent="No results to display.",E}const u=document.createElement("div");u.className="content-medium";const{totalQuestions:g,correctCount:p,scorePercentage:h,passed:b,details:y}=m;let w="";i.showQuestions&&y&&(w=y.map((E,A)=>{if(!E)return"";const L=t.questions[A],q=E.correct,C=q?"text-success":"text-error",x=q?"âœ”":"âœ–",I=q?"bg-green-50":"bg-red-50",_=L.prompt||L.questionText||`Question ${A+1}`,D=n[A].metadata;let W="";if(i.showUserResponses&&E.response!==null&&E.response!==void 0&&(W+=`<div class="mt-2 p-3 bg-gray-50 rounded"><p class="text-xs font-bold text-muted uppercase mb-2 mt-0">Your Answer</p><div class="text-sm">${D.formatUserResponse(L,E.response)}</div></div>`),q&&i.showCorrectAnswers||!q&&i.showIncorrectAnswers){const $=D.getCorrectAnswer(L);W+=`<div class="mt-2 p-3 bg-green-50 rounded"><p class="text-xs font-bold text-success uppercase mb-2 mt-0">Correct Answer</p><div class="text-sm">${D.formatCorrectAnswer(L,$)}</div></div>`}return`
          <li class="p-4 rounded ${I}">
            <div class="d-flex gap-3 items-start">
              <span class="font-bold text-muted">Q${A+1}</span>
              <div class="flex-1 stack-sm">
                <div class="d-flex justify-between">
                    <span class="font-semibold">${_}</span>
                    ${i.showCorrectness?`<span class="${C} font-bold">${x}</span>`:""}
                </div>
                ${W}
              </div>
            </div>
          </li>
        `}).join(""));let S="";if(m.actionButton){const E=m.actionButton;let A="";if(E.message){const q=`callout callout-${E.messageType||"info"}`,C=E.type==="restart"?"Maximum Attempts Reached":"Review Recommended";A=`
                    <div class="${q}">
                        <p class="font-bold">${C}</p>
                        <p>${E.message}</p>
                    </div>
                `}let L="";E.attemptsMessage&&(L=`<p class="text-muted mt-2 text-sm text-center">${E.attemptsMessage}</p>`),S=`
                <div class="stack-md mt-6 pt-4 border-top">
                    ${A}
                    <div class="d-flex justify-center">
                        <button data-action="${E.action}" class="btn btn-primary btn-lg" data-testid="assessment-${E.action}">
                            ${E.label}
                        </button>
                    </div>
                    ${L}
                </div>
            `}return u.innerHTML=`
      <div class="card no-hover stack-lg">
        <div class="text-center stack-sm">
            <h2 class="text-2xl font-bold m-0">Assessment Results</h2>
            <p class="text-xl ${b?"text-success":"text-error"} font-bold m-0">${b?"Passed":"Failed"}</p>
        </div>

        <div class="cols-3 gap-4">
            <div class="p-3 bg-gray-50 rounded text-center border">
                <div class="text-xs font-bold text-muted uppercase">Score</div>
                <div class="text-xl font-bold">${h.toFixed(0)}%</div>
            </div>
            <div class="p-3 bg-gray-50 rounded text-center border">
                <div class="text-xs font-bold text-muted uppercase">Correct</div>
                <div class="text-xl font-bold">${p} / ${g}</div>
            </div>
            <div class="p-3 bg-gray-50 rounded text-center border">
                <div class="text-xs font-bold text-muted uppercase">Time</div>
                <div class="text-xl font-bold">${m.timeSpent||"--:--"}</div>
            </div>
        </div>

        ${w?`<ul class="list-none stack-sm m-0 p-0">${w}</ul>`:""}
        ${S}
      </div>
    `,u}function f(m){const u=Zn(m,"assessment");return u.registerView("intro",{render:o}),u.registerView("question",{render:a}),u.registerView("review",{render:c}),u.registerView("results",{render:d}),u}return{initialize:f,showUnansweredModal:(m,u,g)=>wo(m,u,g)}}function So(t,e,n,s,r){if(!s||!s.id)throw new Error("[AssessmentActions] config with id is required");if(!r)throw new Error(`[AssessmentActions:${s.id}] assessmentUI parameter is required`);const{settings:i}=s;async function o(){const C=t.getCurrentQuestionIndex(),x=n[C];x&&typeof x.persistToSCORM=="function"&&await x.persistToSCORM()}function a(C){C==="question"||C==="review"?Ls():Ne()}async function l(){const x=(t.getSummary()?.attempts||0)+1;await t.clearSession(),await t.setCurrentView("question"),await t.setCurrentQuestionIndex(0),await t.setStartTime(Date.now()),await t.setSubmitted(!1),await t.setAttemptNumber(x),a("question"),e.showView("question")}async function c(){await o();const C=t.getCurrentQuestionIndex();C>0&&(await t.setCurrentQuestionIndex(C-1),e.showView("question"))}async function d(){await o();const C=t.getCurrentQuestionIndex();C===s.questions.length-1?i.allowReview?(await t.updateSession({reviewReached:!0}),await t.setCurrentView("review"),a("review"),e.showView("review")):await g():(await t.setCurrentQuestionIndex(C+1),e.showView("question"))}async function f(C){await o();const x=parseInt(C.target.closest("[data-question-index]").dataset.questionIndex,10);if(isNaN(x)){const I=`[AssessmentActions:${s.id}] Invalid question index from review screen`;throw v.emit("assessment:error",I),new Error(I)}await t.setCurrentView("question"),await t.setCurrentQuestionIndex(x),a("question"),e.showView("question")}async function m(){await o(),await t.setCurrentView("question"),a("question"),e.showView("question")}async function u(){await o(),await t.setCurrentView("review"),a("review"),e.showView("review")}async function g(){await o();const x=t.getSession()?.responses||{},I=[];for(let D=0;D<s.questions.length;D++){s.questions[D];const W=x[D],N=n[D].metadata;(!N||!N.isAnswered(W))&&I.push(D)}const _=i.allowUnansweredSubmission===!0;if(I.length>0){r.showUnansweredModal(I,_,async()=>{await A()});return}await A()}function p(){const C=t.getCurrentQuestionIndex(),x=n[C];x&&typeof x.checkAnswer=="function"&&x.checkAnswer()}function h(){const C=t.getCurrentQuestionIndex(),x=n[C];x&&typeof x.reset=="function"&&x.reset()}function b(){const C=t.getCurrentQuestionIndex(),x=n[C];x&&typeof x.showHint=="function"&&x.showHint()}async function y(){const C=t.getSession();C&&C.responses&&Object.keys(C.responses).length>0&&await t.archiveDiscardedResponses(s.questions,C.responses),n.forEach(_=>{if(_&&typeof _.reset=="function")try{_.reset()}catch{}}),await t.clearSession(),await t.setCurrentView("intro"),await t.setCurrentQuestionIndex(0),await t.setStartTime(null),await t.setSubmitted(!1),await t.updateSession({reviewReached:!1});const x=i.randomizeOnRetake!==!1,I=s.questionBanks||i.randomizeQuestions;if(x&&I){await t.setSelectedQuestions(null);const _=ne();if(_){ce(_,{refreshAssessment:!0});return}}a("intro"),e.showView("intro")}function w(){v.emit("ui:showModal","restart")}function S(C){const I=t.getSummary()?.attempts||0,{attemptsBeforeRemedial:_,attemptsBeforeRestart:D,allowRetake:W}=i;let N=null;if(!C.passed&&W){const $=Qe()||[],M=i.remedialSlideIds&&i.remedialSlideIds.length>0,O=M&&i.remedialSlideIds.every(j=>$.includes(j));if(D&&I>=D)N={type:"restart",action:"restart-course",label:"Restart Course",message:`You have completed ${I} attempts. To try again, you must restart the entire course. This will erase all progress.`,messageType:"warning"};else if(_&&I>=_&&!O)N={type:"remedial",action:M?"go-to-remedial":"retake",label:M?"Review Content":"Retake Assessment",message:M?"Please review the recommended content before attempting the assessment again. This will help strengthen your understanding of key concepts.":"Please take time to review the course material before attempting the assessment again.",messageType:"info"};else{let j=null;if(_){const Q=_-I;Q>0&&(j=Q>1?`${Q} more attempts before review is recommended.`:"Content review will be recommended after your next attempt.")}if(!j&&D){const Q=D-I;Q>0&&(j=Q>1?`${Q} attempts remaining before course restart is required.`:"This is your final attempt before course restart is required.")}N={type:"retake",action:"retake",label:"Retake Assessment",attemptsMessage:j}}}return{...C,actionButton:N,currentAttempts:I}}async function E(){const C=i.remedialSlideIds||[];if(C.length===0){const _=new Error("No remedial slides configured");throw v.emit("assessment:error",{domain:"assessment",operation:"handleGoToRemedial",message:_.message,stack:_.stack,context:{assessmentId:s.id}}),_}const x=C[0];if(!await ar(x)){const _=`[AssessmentActions:${s.id}] Remedial slide '${x}' not found in course structure`;throw v.emit("assessment:error",{domain:"assessment",operation:"handleGoToRemedial",message:_,context:{assessmentId:s.id,remedialSlideIds:C}}),$e(`Error: Slide '${x}' not found`,"error"),new Error(_)}ce(x,{fromAssessment:s.id,remedialReview:!0})}async function A(){const C=t.getSession();if(!C){const N=`[AssessmentActions:${s.id}] No session data found, cannot submit`;throw v.emit("assessment:error",N),new Error(N)}const x=t.getAttemptNumber(),I=L(C.responses||{},x),_=t.getStartTime();if(_){const $=Date.now()-_,M=Math.floor($/6e4),O=Math.floor($%6e4/1e3);I.timeSpent=`${M.toString().padStart(2,"0")}:${O.toString().padStart(2,"0")}`}const D={attemptNumber:I.attemptNumber,totalQuestions:I.totalQuestions,correctCount:I.correctCount,scorePercentage:I.scorePercentage,passed:I.passed,questionResults:I.details.map(N=>({id:N.questionId,correct:N.correct}))};await t.updateSummary({lastResults:D,submitted:!0,attempts:x,[`attempt_${x}`]:D}),await t.updateSession({submitted:!0});const W=S(I);if(await t.setCurrentView("results"),a("results"),e.showView("results",W),s.assessmentObjective)try{Ie.setCompletionStatus(s.assessmentObjective,"completed"),Ie.setSuccessStatus(s.assessmentObjective,I.passed?"passed":"failed")}catch(N){const $=`Failed to update objective '${s.assessmentObjective}' after assessment submission`;throw v.emit("assessment:error",{domain:"assessment",operation:"submitAssessment",message:$,stack:N.stack,context:{assessmentId:s.id,objective:s.assessmentObjective}}),new Error($)}v.emit("assessment:submitted",{assessmentId:s.id,results:I}),typeof s.onComplete=="function"&&s.onComplete(I)}function L(C,x){const I=s.questions.length;let _=0,D=0;const W=s.questions.map((O,j)=>{const Q=n[j],ie=C[j],St=O.weight;D+=St;let De;if(ie==null?De={correct:!1,score:0,feedback:"Question was not answered"}:De=Q.evaluate(ie),!De||typeof De.correct!="boolean"){const $t=new Error(`Question ${j+1} (${O.id}) evaluate() returned invalid result`);throw v.emit("assessment:error",{domain:"assessment",operation:"calculateFinalResults",message:$t.message,stack:$t.stack,context:{assessmentId:s.id,questionIndex:j,questionId:O.id}}),$t}const un=De.correct;un&&(_+=St);const Et={questionIndex:j,questionId:O.id,correct:un,response:ie,weight:St};return O._meta&&(Et.bankId=O._meta.bankId,Et.originalIndex=O._meta.originalIndex),Et}),N=D>0?_/D*100:0,$=N>=(i.passingScore||0),M=W.filter(O=>O.correct).length;return{attemptNumber:x,totalQuestions:I,correctCount:M,scorePercentage:N,passed:$,details:W}}function q(C){C.addEventListener("click",async x=>{const I=x.target.closest("[data-action]");if(!I)return;const _=I.dataset.action,D={start:l,prev:c,next:d,"review-question":f,"back-to-questions":m,"jump-to-review":u,submit:g,check:p,reset:h,hint:b,retake:y,"restart-course":w,"go-to-remedial":E};if(D[_]){x.preventDefault(),I.disabled=!0;try{await D[_](x)}catch(W){const N=`[AssessmentActions:${s.id}] Error in action '${_}': ${W.message}`;throw v.emit("assessment:error",N),W}finally{I.disabled=!1}}})}return{initialize:q}}const It={creator:"createMultipleChoiceQuestion",scormType:"choice",showCheckAnswer:!0,isAnswered:t=>Array.isArray(t)&&t.length>0,getCorrectAnswer:t=>t.multiple?JSON.stringify(t.choices.filter(e=>e.correct).map(e=>e.value)):t.correctAnswer||"",formatCorrectAnswer:(t,e)=>{let n='<ul class="list-disc pl-4 m-0">';const s=Array.isArray(e)?e:[e],r=t.choices||[];return s.forEach(i=>{const o=r.find(a=>a.value===i||a.correct);o?n+=`<li class="correct-item">${o.text}</li>`:n+=`<li class="correct-item">${i}</li>`}),n+="</ul>",n},formatUserResponse:(t,e)=>{let n='<ul class="list-disc pl-4 m-0">';const s=Array.isArray(e)?e:[e],r=t.choices||[];return s.forEach(i=>{const o=r.find(a=>a.value===i);o?n+=`<li class="response-item">${o.text}</li>`:n+=`<li class="response-item">${i}</li>`}),n+="</ul>",n}};function rt(t){ue(t,["choices"]);const{id:e,prompt:n,choices:s,correctAnswer:r,multiple:i=!1,controlled:o=!1}=t;if(!Array.isArray(s)||s.length===0)throw new Error(`Multiple choice question "${e}" must have at least one choice`);if(!i&&!r)throw new Error(`Single-select multiple choice question "${e}" must have correctAnswer defined`);let a=null;const l={id:e,type:i?"multiple-choice-multiple":"multiple-choice-single",render:(c,d=null)=>{T(c,e),a=c;const f=ke(d),m=Array.isArray(f)?f:f?[f]:[];let u=`
                <div class="interaction multiple-choice" data-interaction-id="${e}">
                    <div class="question-prompt">
                        <h3>${n}</h3>
                    </div>
                    <div class="${i?"checkbox-group":"radio-group"}">
            `;if(s.forEach((g,p)=>{const h=i?"checkbox":"radio",b=`${e}_choice_${p}`,y=i?"checkbox-option":"radio-option",w=i?"checkbox-custom":"radio-custom",S=i?"checkbox-label":"radio-label",E=m.includes(g.value);u+=`
                    <label class="${y}" role="option" aria-selected="${E}">
                        <input
                          type="${h}"
                          id="${b}"
                          name="${e}_choice"
                          value="${g.value}"
                          ${g.correct?'data-correct="true"':""}
                          ${E?"checked":""}
                          aria-describedby="${e}_feedback ${b}_description"
                          aria-label="${g.text}"
                          tabindex="0"
                          data-testid="${e}-choice-${p}"
                        />
                        <span class="${w}"></span>
                        <div class="${S}">
                          ${g.text}
                          ${g.description?`<div id="${b}_description" class="radio-description">${g.description}</div>`:""}
                        </div>
                    </label>
                `}),u+=`
                    </div>
                    ${me(e,o)}
                    ${Oe(e)}
                </div>
            `,c.innerHTML=u,Eo(c,l),!o){const g=i?JSON.stringify(s.filter(p=>p.correct).map(p=>p.value)):r;c.addEventListener("click",pe(l,{...t,scormType:"choice",correctPattern:g}))}},evaluate:c=>{if(!c||!Array.isArray(c)||c.length===0)return i&&s.filter(d=>d.correct).map(d=>d.value),{score:0,correct:!1,response:i?JSON.stringify([]):"",error:"No answer selected"};if(i){const d=s.filter(u=>u.correct).map(u=>u.value),f=d.every(u=>c.includes(u))&&c.every(u=>d.includes(u));return{score:f?1:c.filter(u=>d.includes(u)).length/d.length,correct:f,response:JSON.stringify(c)}}else{const d=c.length===1&&c[0]===r;return{score:d?1:0,correct:d,response:c[0]||""}}},checkAnswer:()=>{T(a,e);const c=a.querySelectorAll('input[type="radio"], input[type="checkbox"]'),d=Array.from(c).filter(m=>m.checked).map(m=>m.value);if(d.length===0){const m="Please select an answer before checking.";return U(a,e,m,"error"),ye.announce(m,"assertive"),null}const f=l.evaluate(d);if(f.correct){const m="Correct! Well done.";U(a,e,m,"correct"),ye.announce(m)}else{const m=d.map(p=>s.find(h=>h.value===p)?.text||p).join(", "),u=i?s.filter(p=>p.correct).map(p=>p.text).join(", "):s.find(p=>p.value===r)?.text||r,g=`Incorrect. You selected: ${m}. Expected: ${u}`;U(a,e,g,"incorrect"),ye.announce(g)}return f},reset:()=>{T(a,e);const c=a.querySelectorAll('input[type="radio"], input[type="checkbox"]'),d=a.querySelectorAll(".radio-option, .checkbox-option");c.forEach(f=>{f.checked=!1,f.setAttribute("aria-checked","false")}),d.forEach(f=>{f.setAttribute("aria-selected","false"),f.classList.remove("selected")}),he(a,e),ye.announce("Question reset. All selections cleared.")},setResponse:c=>{T(a,e);const d=Array.isArray(c)?c:c?[c]:[],f=a.querySelectorAll('input[type="radio"], input[type="checkbox"]');if(f.length===0)throw new Error(`No input elements found for multiple choice question "${e}"`);f.forEach(m=>{m.checked=d.includes(m.value)}),it(a)},getResponse:()=>{T(a,e);const c=a.querySelectorAll('input[type="radio"]:checked, input[type="checkbox"]:checked');return Array.from(c).map(d=>d.value)},getCorrectAnswer:()=>i?s.filter(c=>c.correct).map(c=>c.value):r};return o||Ae(t,l),l}function it(t){t.querySelectorAll(".radio-option, .checkbox-option").forEach(n=>{const s=n.querySelector("input");if(!s)return;const r=s.checked;n.setAttribute("aria-selected",r.toString()),r?n.classList.add("selected"):n.classList.remove("selected")})}function Eo(t,e){t.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(s=>{s.addEventListener("change",()=>it(t)),s.addEventListener("keydown",r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),e.type==="multiple-choice-multiple"?s.checked=!s.checked:s.checked=!0,it(t),s.dispatchEvent(new Event("change")))})}),it(t)}const $o={creator:"createTrueFalseQuestion",scormType:"true-false",showCheckAnswer:!0,isAnswered:t=>t!=null,getCorrectAnswer:t=>t.correctAnswer.toString(),formatCorrectAnswer:(t,e)=>`<p class="correct-item">${e}</p>`,formatUserResponse:(t,e)=>`<p class="response-item">${e}</p>`};function Rs(t){ue(t,["correctAnswer"]);const{id:e,prompt:n,correctAnswer:s,controlled:r=!1,autoCheck:i=!1,feedback:o={}}=t;let a=null;const l={id:e,type:"true-false",render:(c,d=null)=>{T(c,e),a=c;const f=ke(d),m=`
                <div class="interaction true-false" data-interaction-id="${e}">
                    <div class="question-prompt">
                        <h3>${n}</h3>
                    </div>
                    <div class="true-false-options">
                        <label>
                            <input type="radio" name="${e}_choice" value="true" ${f==="true"?"checked":""} data-testid="${e}-choice-true"> True
                        </label>
                        <label>
                            <input type="radio" name="${e}_choice" value="false" ${f==="false"?"checked":""} data-testid="${e}-choice-false"> False
                        </label>
                    </div>
                    ${i?"":me(e,r)}
                    ${Oe(e)}
                </div>
            `;c.innerHTML=m,r||c.addEventListener("click",pe(l,{...t,scormType:"true-false",correctPattern:s.toString()})),i&&!r&&c.querySelectorAll(`input[name="${e}_choice"]`).forEach(g=>{g.addEventListener("change",()=>{const p=l.checkAnswer();if(p){const h=ne();h&&H.trackInteraction(h,e,!0,p.correct)}p&&!p.correct&&setTimeout(()=>{l.reset()},2e3)})})},evaluate:c=>{if(c==null||c==="")return{score:0,correct:!1,response:"",error:"No answer provided"};const d=c===s.toString();return{score:d?1:0,correct:d,response:c}},checkAnswer:()=>{T(a,e);const c=a.querySelector(`input[name="${e}_choice"]:checked`);if(!c)return U(a,e,"Please select an answer.","error"),null;const d=c.value,f=l.evaluate(d),m=c.closest("label");if(f.correct){const u=o.correct||`Correct! The answer is ${s}.`;U(a,e,u,"correct"),m&&(m.classList.add("answer-correct"),m.classList.remove("answer-incorrect"))}else{const u=o.incorrect||`Incorrect. The correct answer is ${s}.`;U(a,e,u,"incorrect"),m&&(m.classList.add("answer-incorrect"),m.classList.remove("answer-correct"))}return f},reset:()=>{T(a,e);const c=a.querySelectorAll(`input[name="${e}_choice"]`),d=a.querySelectorAll(".true-false-options label");c.forEach(f=>{f.checked=!1}),d.forEach(f=>{f.classList.remove("answer-correct","answer-incorrect")}),he(a,e)},setResponse:c=>{if(T(a,e),c==null)return;const d=a.querySelector(`input[name="${e}_choice"][value="${c}"]`);if(!d)throw new Error(`Invalid response value "${c}" for true-false question "${e}". Must be "true" or "false".`);d.checked=!0},getResponse:()=>{T(a,e);const c=a.querySelector(`input[name="${e}_choice"]:checked`);return c?c.value:null},getCorrectAnswer:()=>s.toString()};return r||Ae(t,l),l}const ko={creator:"createFillInQuestion",scormType:"fill-in",showCheckAnswer:!0,isAnswered:t=>!t||typeof t!="object"?!1:Object.values(t).some(e=>e&&String(e).trim().length>0),getCorrectAnswer:t=>!t.blanks||!Array.isArray(t.blanks)?"":JSON.stringify(t.blanks.map(e=>e.correct)),formatCorrectAnswer:(t,e)=>{let n="";return t.blanks?(n+='<ul class="list-disc pl-4 m-0">',t.blanks.forEach(s=>{n+=`<li class="correct-item">${s.correct}</li>`}),n+="</ul>"):n+=`<p class="correct-item">${e}</p>`,n},formatUserResponse:(t,e)=>{let n='<ul class="list-disc pl-4 m-0">';const s=vt(e,"object")||{};return Object.entries(s).forEach(([r,i])=>{n+=`<li class="response-item">${i}</li>`}),n+="</ul>",n}};function Os(t){ue(t,["blanks"]);const{id:e,prompt:n,blanks:s,feedback:r,caseSensitive:i=!1,controlled:o=!1}=t;if(!Array.isArray(s)||s.length===0)throw new Error(`Fill-in question "${e}" must have at least one blank`);let a=null;const l={id:e,type:"fill-in",render:(c,d=null)=>{T(c,e),a=c;const f=ke(d),m=f&&typeof f=="object"?f:{};let u=`
                <div class="interaction fill-in" data-interaction-id="${e}">
                    <div class="question-prompt">
                        <h3>${n}</h3>
                    </div>
                    <div class="fill-in-container">
            `;if(s.forEach((g,p)=>{const h=`${e}_blank_${p}`,b=m[h]||"";u+=`
                    <div class="fill-in-item">
                        <label for="${e}_blank_${p}">${g.label||`Blank ${p+1}:`}</label>
                        <input
                          type="text"
                          id="${e}_blank_${p}"
                          name="${h}"
                          placeholder="${g.placeholder||""}"
                          value="${b}"
                          data-correct="${g.correct}"
                          data-case-sensitive="${i}"
                          aria-describedby="${e}_feedback_${p}"
                          data-testid="${e}-blank-${p}"
                        />
                        <div id="${e}_feedback_${p}" class="feedback" aria-live="polite"></div>
                    </div>
                `}),u+=`
                    </div>
                    ${me(e,o,r?[`<button type="button" class="btn btn-info" data-action="show-hint" data-interaction="${e}">Show Hint</button>`]:[])}
                    <div class="overall-feedback" id="${e}_overall_feedback" aria-live="polite"></div>
                </div>
            `,c.innerHTML=u,!o){const g=JSON.stringify(s.map(p=>p.correct));c.addEventListener("click",pe(l,{...t,scormType:"fill-in",correctPattern:g},{"show-hint":()=>l.showHint()}))}},evaluate:c=>{if(!c||typeof c!="object")return{score:0,correct:!1,results:s.map(m=>({response:"",correct:!1,expected:m.correct})),response:JSON.stringify({}),error:"Invalid response format"};let d=0;const f=s.map((m,u)=>{const g=`${e}_blank_${u}`,p=c[g]||"",h=i?p===m.correct:p.toLowerCase()===m.correct.toLowerCase();return h&&d++,{response:p,correct:h,expected:m.correct}});return{score:d/s.length,correct:d===s.length,results:f,response:JSON.stringify(c)}},checkAnswer:()=>{T(a,e);const c=a.querySelectorAll('input[type="text"]');if(c.length===0)throw new Error(`No input elements found for fill-in question "${e}"`);const d={};return c.forEach(f=>{d[f.name]=f.value.trim();const m=f.dataset.correct,u=f.dataset.caseSensitive==="true",g=a.querySelector(`#${f.getAttribute("aria-describedby")}`),p=u?f.value.trim()===m:f.value.trim().toLowerCase()===m.toLowerCase();g&&(p?(g.textContent="âœ“ Correct!",g.className="feedback correct",f.classList.add("correct"),f.classList.remove("incorrect")):(g.textContent=`âœ— Incorrect. Expected: ${m}`,g.className="feedback incorrect",f.classList.add("incorrect"),f.classList.remove("correct")))}),l.evaluate(d)},reset:()=>{T(a,e),a.querySelectorAll('input[type="text"]').forEach(m=>{m.value="",m.classList.remove("correct","incorrect")}),a.querySelectorAll(".feedback").forEach(m=>{m.innerHTML="",m.className="feedback"});const f=a.querySelector(".overall-feedback");f&&(f.innerHTML="")},showHint:()=>{if(T(a,e),!r)return;const c=a.querySelector(".overall-feedback");if(!c)throw new Error(`Overall feedback element not found for fill-in question "${e}"`);c.innerHTML=`<div class="hint">${r}</div>`},setResponse:c=>{T(a,e);const d=vt(c,"object");if(!d)return;if(a.querySelectorAll('input[type="text"]').length===0)throw new Error(`No input elements found for fill-in question "${e}"`);Object.keys(d).forEach(m=>{const u=a.querySelector(`input[name="${CSS.escape(m)}"]`);u&&(u.value=d[m])})},getResponse:()=>{if(!a){const f={};return s.forEach((m,u)=>{f[`${e}_blank_${u}`]=""}),f}const c={},d=a.querySelectorAll('input[type="text"]');if(d.length===0)throw new Error(`No input elements found for fill-in question "${e}"`);return d.forEach(f=>{c[f.name]=f.value.trim()}),c},getCorrectAnswer:()=>s.map(c=>c.correct)};return o||Ae(t,l),l}const Ao={creator:"createMatchingQuestion",scormType:"matching",showCheckAnswer:!0,isAnswered:t=>!t||typeof t!="object"?!1:Object.keys(t).length>0&&Object.values(t).some(e=>e&&String(e).trim().length>0),getCorrectAnswer:t=>!t.pairs||!Array.isArray(t.pairs)?"":JSON.stringify(t.pairs.reduce((e,n)=>(e[n.id]=n.match,e),{})),formatCorrectAnswer:(t,e)=>{let n="";return t.pairs&&Array.isArray(t.pairs)?(n+='<ul class="list-disc pl-4 m-0">',t.pairs.forEach(s=>{const r=s.match||"";n+=`<li class="correct-item">${s.text} â†’ ${r}</li>`}),n+="</ul>"):n+=`<p class="correct-item">${e}</p>`,n},formatUserResponse:(t,e)=>{let n="";try{const s=typeof e=="string"?JSON.parse(e):e;t.pairs&&Array.isArray(t.pairs)?(n+='<ul class="list-disc pl-4 m-0">',t.pairs.forEach(r=>{const i=s[r.id]||"(not matched)";n+=`<li class="response-item">${r.text} â†’ ${i}</li>`}),n+="</ul>"):n+=`<p class="response-item">${JSON.stringify(s)}</p>`}catch{n+=`<p class="response-item">${e}</p>`}return n}};function Ds(t){ue(t,["pairs"]);const{id:e,prompt:n,pairs:s,controlled:r=!1,feedbackMode:i="deferred"}=t;if(!Array.isArray(s)||s.length===0)throw new Error(`Matching question "${e}" must have at least one pair`);s.forEach((d,f)=>{if(!d.id||!d.text||!d.match)throw new Error(`Matching question "${e}" pair at index ${f} must have id, text, and match properties`)});let o=null,a=null;const l=["#9333ea","#ec4899","#f59e0b","#3b82f6","#6366f1","#8b5cf6","#06b6d4","#14b8a6"],c={id:e,type:"matching",pairs:s,feedbackMode:i,render:d=>{T(d,e),o=d;const f=s.map(p=>({id:p.id,match:p.match}));Co(f),a={items:s.map(p=>({id:p.id,text:p.text})),matches:f,correctAnswers:s.reduce((p,h)=>(p[h.id]=h.match,p),{})};let g=`
                <div class="interaction matching-interaction ${i==="immediate"?"matching-immediate":"matching-deferred"}" data-interaction-id="${e}" data-feedback-mode="${i}">
                    <div class="question-prompt">
                        <h3>${n}</h3>
                        <p class="matching-instruction">${i==="immediate"?"Click an item on the left, then its correct match on the right.":"Click an item on the left, then click its match on the right."}</p>
                    </div>
                    <div class="matching-container">
                        <div class="matching-column matching-items">
                            <h4 class="matching-column-header">Items</h4>
                            <div class="matching-list">
            `;if(s.forEach(p=>{g+=`
                    <button type="button" 
                            class="matching-item" 
                            data-item-id="${p.id}" 
                            data-testid="${e}-match-item-${p.id}"
                            aria-label="Match item: ${p.text}">
                        <span class="matching-item-text">${p.text}</span>
                        ${i==="immediate"?'<span class="matching-feedback-icon" aria-hidden="true"></span>':""}
                    </button>
                `}),g+=`
                            </div>
                        </div>
                        <div class="matching-column matching-targets">
                            <h4 class="matching-column-header">Matches</h4>
                            <div class="matching-list">
            `,f.forEach(p=>{g+=`
                    <button type="button" 
                            class="matching-target" 
                            data-match-id="${p.id}" 
                            data-testid="${e}-match-target-${p.id}"
                            aria-label="Match target: ${p.match}">
                        <span class="matching-target-text">${p.match}</span>
                        ${i==="deferred"?'<span class="matching-connection-indicator" aria-hidden="true"></span>':""}
                    </button>
                `}),g+=`
                            </div>
                        </div>
                    </div>
                    ${i==="deferred"?me(e,r):""}
                    ${Oe(e)}
                </div>
            `,d.innerHTML=g,Io(d,c,a,i,l),!r&&i==="deferred"){const p=JSON.stringify(a.correctAnswers);d.addEventListener("click",pe(c,{...t,scormType:"matching",correctPattern:p}))}},evaluate:d=>{if(!d||typeof d!="object")return{score:0,correct:!1,results:[],response:JSON.stringify({}),error:"Invalid matches format"};let f=0;const m=[];return s.forEach(u=>{const g=d[u.id],p=u.match,h=g&&p&&g.trim()===p.trim();h&&f++,m.push({itemId:u.id,userAnswer:g||null,correctAnswer:u.match,correct:h})}),{score:f/s.length,correct:f===s.length,results:m,response:JSON.stringify(d)}},checkAnswer:()=>{T(o,e);const d=c.getResponse(),f=c.evaluate(d);if(i==="deferred"&&xo(o,f.results),f.correct){const m=t.feedback?.correct||"Excellent! All matches are correct.";U(o,e,m,"correct")}else{const m=t.feedback?.incorrect||`${Math.round(f.score*100)}% correct. Review your matches.`;U(o,e,m,"incorrect")}return f},reset:()=>{T(o,e),o.querySelectorAll(".matching-item").forEach(f=>{f.classList.remove("selected","matched","correct","incorrect","flash-incorrect"),f.disabled=!1,f.style.removeProperty("--pair-color")}),o.querySelectorAll(".matching-target").forEach(f=>{f.classList.remove("selected","matched","correct","incorrect"),f.disabled=!1,f.style.removeProperty("--pair-color")}),he(o,e);const d=o._matchingState;d&&(d.matches={},d.selectedItem=null,d.selectedTarget=null,d.colorIndex=0)},getResponse:()=>{T(o,e);const d=o._matchingState;return d?{...d.matches}:{}},setResponse:d=>{T(o,e);let f=d;if(Array.isArray(d)&&(f={},d.forEach(u=>{if(u.source&&u.target){const g=u.target,p=a.matches.find(b=>b.id===g),h=p?p.match:u.target;f[u.source]=h}})),!f||typeof f!="object")throw new Error(`setResponse expects an object for matching question "${e}"`);c.reset();const m=o._matchingState;m&&(m.matches={...f},Object.entries(f).forEach(([u,g])=>{const p=o.querySelector(`.matching-item[data-item-id="${le(u)}"]`),h=Array.from(o.querySelectorAll(".matching-target")).find(b=>b.querySelector(".matching-target-text")?.textContent.trim()===g);if(p&&h&&(p.classList.add("matched"),h.classList.add("matched"),p.disabled=!0,h.disabled=!0,i==="deferred")){const b=l[m.colorIndex%l.length];p.style.setProperty("--pair-color",b),h.style.setProperty("--pair-color",b),m.colorIndex++}}))},getCorrectAnswer:()=>s.reduce((d,f)=>(d[f.id]=f.match,d),{})};return r||Ae(t,c),c}function Co(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function xo(t,e){e.forEach(n=>{const s=t.querySelector(`.matching-item[data-item-id="${le(n.itemId)}"]`),r=Array.from(t.querySelectorAll(".matching-target")).find(i=>i.querySelector(".matching-target-text")?.textContent.trim()===n.userAnswer);if(n.correct)s&&(s.classList.remove("matched"),s.classList.add("correct")),r&&(r.classList.remove("matched"),r.classList.add("correct"));else{s&&(s.classList.add("flash-incorrect"),setTimeout(()=>{s.classList.remove("flash-incorrect","matched"),s.disabled=!1,s.style.removeProperty("--pair-color")},1e3)),r&&(r.classList.add("flash-incorrect"),setTimeout(()=>{r.classList.remove("flash-incorrect","matched"),r.disabled=!1,r.style.removeProperty("--pair-color")},1e3));const i=t._matchingState;i&&setTimeout(()=>{delete i.matches[n.itemId]},1e3)}})}function Io(t,e,n,s,r){t._matchingState={matches:{},selectedItem:null,selectedTarget:null,pairsData:n,colorIndex:0},t.addEventListener("click",i=>{const o=t._matchingState,a=i.target.closest(".matching-item");if(a&&!a.disabled){if(o.selectedTarget){Tn(t,o,a,o.selectedTarget,n,s,r);return}Mo(t,o,a,s,r);return}const l=i.target.closest(".matching-target");if(l&&!l.disabled){if(o.selectedItem){Tn(t,o,o.selectedItem,l,n,s,r);return}if(l.classList.contains("matched")){qo(t,o,l);return}To(t,o,l,s,r)}}),t.addEventListener("keydown",i=>{if(i.key==="Enter"||i.key===" "){i.preventDefault();const o=i.target;(o.classList.contains("matching-item")||o.classList.contains("matching-target"))&&o.click()}})}function Mo(t,e,n,s,r){if(n.classList.contains("matched")){_o(t,e,n);return}if(e.selectedItem=n,e.selectedTarget=null,s==="deferred"&&r){const i=r[e.colorIndex%r.length];n.style.setProperty("--selection-color",i)}t.querySelectorAll(".matching-item").forEach(i=>{i.classList.remove("selected"),i!==n&&i.style.removeProperty("--selection-color")}),t.querySelectorAll(".matching-target").forEach(i=>{i.classList.remove("selected"),i.style.removeProperty("--selection-color")}),n.classList.add("selected")}function To(t,e,n,s,r){if(e.selectedTarget=n,e.selectedItem=null,s==="deferred"&&r){const i=r[e.colorIndex%r.length];n.style.setProperty("--selection-color",i)}t.querySelectorAll(".matching-item").forEach(i=>{i.classList.remove("selected"),i.style.removeProperty("--selection-color")}),t.querySelectorAll(".matching-target").forEach(i=>{i.classList.remove("selected"),i!==n&&i.style.removeProperty("--selection-color")}),n.classList.add("selected")}function Tn(t,e,n,s,r,i,o){const a=n.dataset.itemId,l=s.querySelector(".matching-target-text").textContent.trim();if(i==="deferred"){const u=o[e.colorIndex%o.length];s.style.setProperty("--selection-color",u)}const c=r.correctAnswers[a],d=l===c;if(i==="immediate"){d?(n.classList.remove("selected"),n.classList.add("matched","correct"),n.disabled=!0,s.classList.remove("selected"),s.classList.add("matched","correct"),s.disabled=!0,e.matches[a]=l):(n.classList.add("incorrect"),s.classList.add("incorrect"),setTimeout(()=>{n.classList.remove("incorrect","selected"),s.classList.remove("incorrect","selected")},600)),e.selectedItem=null,e.selectedTarget=null;return}const f=Object.keys(e.matches).find(u=>e.matches[u]===l);if(f&&f!==a){const u=t.querySelector(`.matching-item[data-item-id="${le(f)}"]`);u&&(u.classList.remove("matched"),u.style.removeProperty("--pair-color")),delete e.matches[f]}if(e.matches[a]){const u=e.matches[a],g=Array.from(t.querySelectorAll(".matching-target")).find(p=>p.querySelector(".matching-target-text")?.textContent.trim()===u);g&&(g.classList.remove("matched"),g.style.removeProperty("--pair-color"))}const m=o[e.colorIndex%o.length];e.colorIndex++,n.classList.remove("selected"),n.classList.add("matched"),n.style.setProperty("--pair-color",m),s.classList.remove("selected"),s.classList.add("matched"),s.style.setProperty("--pair-color",m),e.matches[a]=l,e.selectedItem=null,e.selectedTarget=null}function _o(t,e,n){const s=n.dataset.itemId,r=e.matches[s];if(!r)return;const i=Array.from(t.querySelectorAll(".matching-target")).find(o=>o.querySelector(".matching-target-text")?.textContent.trim()===r);i&&(i.classList.remove("matched","correct"),i.style.removeProperty("--pair-color")),n.classList.remove("matched","correct"),n.style.removeProperty("--pair-color"),delete e.matches[s]}function qo(t,e,n,s){const r=n.querySelector(".matching-target-text").textContent.trim(),i=Object.keys(e.matches).find(a=>e.matches[a]===r);if(!i)return;const o=t.querySelector(`.matching-item[data-item-id="${le(i)}"]`);o&&(o.classList.remove("matched","correct"),o.style.removeProperty("--pair-color")),n.classList.remove("matched","correct"),n.style.removeProperty("--pair-color"),delete e.matches[i]}const Lo={creator:"createDragDropQuestion",scormType:"other",showCheckAnswer:!0,isAnswered:t=>!t||typeof t!="object"?!1:Object.keys(t).length>0,getCorrectAnswer:t=>{const e={};return t.dropZones&&Array.isArray(t.dropZones)&&t.dropZones.forEach(n=>{n.accepts&&Array.isArray(n.accepts)&&n.accepts.forEach(s=>{e[s]=n.id})}),JSON.stringify(e)},formatCorrectAnswer:(t,e)=>'<p class="correct-item">See correct placements above</p>',formatUserResponse:(t,e)=>{try{const n=typeof e=="string"?JSON.parse(e):e;return`<p class="response-item">${Object.keys(n).length} item(s) placed</p>`}catch{return`<p class="response-item">${e}</p>`}}};function zs(t){ue(t,["items","dropZones"]);const{id:e,prompt:n,items:s,dropZones:r,controlled:i=!1}=t;if(!Array.isArray(s)||s.length===0)throw new Error(`Drag-drop question "${e}" must have at least one item`);if(!Array.isArray(r)||r.length===0)throw new Error(`Drag-drop question "${e}" must have at least one drop zone`);let o=null;const a={id:e,type:"drag-drop",render:(l,c=null)=>{T(l,e),o=l;const d=ke(c),f=vt(d,"object")||{};let m=`
                <div class="interaction drag-drop" data-interaction-id="${e}">
                    <div class="question-prompt">
                        <h3>${n}</h3>
                    </div>
                    <div class="drag-drop-container">
                        <div class="drag-items" data-droppable="true">
                            <h4>Drag these items:</h4>
            `;if(s.forEach((g,p)=>{const h=f[g.id]!==void 0;m+=`
                    <div
                      class="drag-item${h?" d-none":""}"
                      draggable="true"
                      data-item-id="${g.id}"
                      data-index="${p}"
                      tabindex="0"
                      role="button"
                      aria-grabbed="false"
                      data-testid="${e}-drag-item-${g.id}"
                    >
                        ${g.content}
                    </div>
                `}),m+=`
                        </div>
                        <div class="drop-zones">
                            <h4>Drop into correct zones:</h4>
            `,r.forEach(g=>{const p=Object.keys(f).filter(b=>f[b]===g.id),h=g.maxItems||1;m+=`
                    <div
                      class="drop-zone"
                      data-zone-id="${g.id}"
                      data-accepts="${g.accepts.join(",")}"
                      data-max-items="${h}"
                      role="region"
                      aria-label="${g.label}"
                      tabindex="0"
                      data-testid="${e}-drop-zone-${g.id}"
                    >
                        <div class="zone-label">${g.label}</div>
                        <div class="zone-content">`,p.forEach(b=>{const y=s.find(w=>w.id===b);y&&(m+=`
                            <div class="drag-item dropped" data-item-id="${y.id}" draggable="true" data-testid="${e}-dropped-item-${y.id}">
                                ${y.content}
                                <button type="button" class="remove-item" data-action="remove-item" data-item-id="${y.id}" aria-label="Remove ${y.content}" title="Remove this item" data-testid="${e}-remove-${y.id}">Ã—</button>
                            </div>
                        `)}),m+=`
                        </div>
                    </div>
                `}),m+=`
                        </div>
                    </div>
                    ${me(e,i)}
                    <div class="overall-feedback" id="${e}_overall_feedback" aria-live="polite"></div>
                </div>
            `,l.innerHTML=m,Ro(l,a,f),!i){const g=JSON.stringify(r.reduce((p,h)=>(h.accepts.forEach(b=>p[b]=h.id),p),{}));l.addEventListener("click",pe(a,{...t,scormType:"other",correctPattern:g}))}const u=g=>{if(g.target.classList.contains("remove-item")){g.stopPropagation(),g.preventDefault();const p=g.target.dataset.itemId;p&&Pt(l,p)}};l.addEventListener("click",u,!0),l.addEventListener("mousedown",u,!0),l.addEventListener("touchstart",u,{capture:!0,passive:!1})},evaluate:l=>{if(!l||typeof l!="object")return{score:0,correct:!1,results:[],response:JSON.stringify({}),error:"Invalid placements format"};let c=0;const d=[];return Object.entries(l).forEach(([f,m])=>{const u=r.find(p=>p.id===m),g=u&&u.accepts.includes(f);g&&c++,d.push({itemId:f,zoneId:m,correct:g})}),{score:c/s.length,correct:c===s.length,results:d,response:JSON.stringify(l)}},checkAnswer:()=>{T(o,e);const l=a.getResponse(),c=a.evaluate(l);return c.correct?U(o,e,"Excellent! All items are in the correct zones.","correct"):U(o,e,`${Math.round(c.score*100)}% correct. Review your placements.`,"incorrect"),c},reset:()=>{T(o,e),o.querySelectorAll(".drag-item").forEach(f=>{f.style.display="block",f.classList.remove("keyboard-selected","dropped")}),o.querySelectorAll(".drop-zone .zone-content").forEach(f=>f.innerHTML=""),he(o,e);const d=o._dragDropState;d&&(d.placements={},d.selectedForDrop=null)},getResponse:()=>{T(o,e);const l={};return o.querySelectorAll(".drop-zone").forEach(d=>{d.querySelectorAll(".drag-item.dropped").forEach(m=>{l[m.dataset.itemId]=d.dataset.zoneId})}),l},setResponse:l=>{if(T(o,e),!l||typeof l!="object")throw new Error(`setResponse expects an object for drag-drop question "${e}"`);o.querySelectorAll(".drag-item").forEach(m=>m.style.display="block"),o.querySelectorAll(".drop-zone .zone-content").forEach(m=>m.innerHTML=""),Object.keys(l).forEach(m=>{const u=l[m],g=o.querySelector(`.drag-item[data-item-id="${le(m)}"]`),p=o.querySelector(`.drop-zone[data-zone-id="${le(u)}"] .zone-content`);if(g&&p){const h=g.cloneNode(!0);h.classList.add("dropped"),h.draggable=!1,p.appendChild(h),g.style.display="none"}});const f=o._dragDropState;f&&(f.placements={...l})},getCorrectAnswer:()=>{const l={};return r.forEach(c=>{c.accepts&&Array.isArray(c.accepts)&&c.accepts.forEach(d=>{l[d]=c.id})}),l}};return i||Ae(t,a),a}function Ro(t,e,n={}){t._dragDropState={placements:{...n},draggedElement:null,selectedForDrop:null};const s=t._dragDropState,r=l=>{if(l.target.classList.contains("remove-item")){l.stopPropagation();const c=l.target.closest(".drag-item");c&&(c.draggable=!1,setTimeout(()=>{c.draggable=!0},100))}};t.addEventListener("mousedown",r,!0),t.addEventListener("touchstart",r,{capture:!0,passive:!1}),t.querySelectorAll(".drag-item").forEach(l=>{l.addEventListener("dragstart",c=>{if(c.target.classList.contains("remove-item")||c.target.closest(".remove-item")){c.preventDefault();return}s.draggedElement=c.currentTarget,c.currentTarget.setAttribute("aria-grabbed","true"),c.dataTransfer.effectAllowed="move",c.dataTransfer.setData("text/plain",c.currentTarget.dataset.itemId)}),l.addEventListener("dragend",c=>{c.target.setAttribute("aria-grabbed","false")}),l.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),t.querySelectorAll(".drag-item").forEach(d=>d.classList.remove("keyboard-selected")),s.selectedForDrop=c.currentTarget,c.currentTarget.classList.add("keyboard-selected"))})}),t.querySelectorAll(".drop-zone").forEach(l=>{l.addEventListener("dragover",c=>{c.preventDefault(),c.dataTransfer.dropEffect="move",c.currentTarget.classList.add("drag-over")}),l.addEventListener("dragleave",c=>{c.currentTarget.classList.remove("drag-over")}),l.addEventListener("drop",c=>{c.preventDefault(),c.currentTarget.classList.remove("drag-over"),s.draggedElement&&_n(t,s,s.draggedElement,c.currentTarget)}),l.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&s.selectedForDrop&&(c.preventDefault(),_n(t,s,s.selectedForDrop,c.currentTarget))})});const a=t.querySelector(".drag-items");a&&(a.addEventListener("dragover",l=>{l.preventDefault(),l.dataTransfer.dropEffect="move",l.currentTarget.classList.add("drag-over")}),a.addEventListener("dragleave",l=>{l.currentTarget.classList.remove("drag-over")}),a.addEventListener("drop",l=>{if(l.preventDefault(),l.currentTarget.classList.remove("drag-over"),s.draggedElement&&s.draggedElement.classList.contains("dropped")){const c=s.draggedElement.dataset.itemId;Pt(t,c)}}),a.addEventListener("keydown",l=>{if((l.key==="Enter"||l.key===" ")&&s.selectedForDrop&&s.selectedForDrop.classList.contains("dropped")){l.preventDefault();const c=s.selectedForDrop.dataset.itemId;Pt(t,c),s.selectedForDrop=null}}))}function _n(t,e,n,s){const r=n.dataset.itemId,i=s.dataset.zoneId,o=s.querySelector(".zone-content");if(!o)throw new Error("Drop zone content element not found");const a=parseInt(s.dataset.maxItems)||1;if(o.querySelectorAll(".drag-item.dropped").length>=a){console.warn(`Zone "${i}" is full (max: ${a})`);return}if(n.classList.contains("dropped")){const d=n.closest(".drop-zone");d&&(d.dataset.zoneId,delete e.placements[r]),n.remove();const f=t.querySelector(`.drag-items .drag-item[data-item-id="${le(r)}"]`);f&&(f.style.display="block")}const c=n.cloneNode(!0);if(c.classList.add("dropped"),c.classList.remove("keyboard-selected"),c.draggable=!0,!c.querySelector(".remove-item")){const d=document.createElement("button");d.type="button",d.className="remove-item",d.dataset.action="remove-item",d.dataset.itemId=r,d.setAttribute("aria-label",`Remove ${n.textContent||n.innerText}`),d.setAttribute("title","Remove this item"),d.textContent="Ã—",c.appendChild(d)}o.appendChild(c),Oo(c,t,e),e.placements[r]=i,n.style.display="none",e.selectedForDrop=null,e.draggedElement=null}function Oo(t,e,n){t.addEventListener("dragstart",s=>{if(s.target.classList.contains("remove-item")||s.target.closest(".remove-item")){s.preventDefault();return}n.draggedElement=s.currentTarget,s.currentTarget.setAttribute("aria-grabbed","true"),s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",s.currentTarget.dataset.itemId)}),t.addEventListener("dragend",s=>{s.target.setAttribute("aria-grabbed","false")}),t.addEventListener("keydown",s=>{(s.key==="Enter"||s.key===" ")&&(s.preventDefault(),e.querySelectorAll(".drag-item").forEach(r=>r.classList.remove("keyboard-selected")),n.selectedForDrop=s.currentTarget,s.currentTarget.classList.add("keyboard-selected"))})}function Pt(t,e){const n=t._dragDropState;if(!n)return;const s=t.querySelector(`.drop-zone .drag-item[data-item-id="${le(e)}"]`);s&&s.remove();const r=t.querySelector(`.drag-items .drag-item[data-item-id="${le(e)}"]`);r&&(r.style.display="block"),delete n.placements[e]}const Do={creator:"createNumericQuestion",scormType:"numeric",showCheckAnswer:!0,isAnswered:t=>t!=null&&String(t).trim().length>0,getCorrectAnswer:t=>JSON.stringify(t.correctRange||{}),formatCorrectAnswer:(t,e)=>{let n="";return t.correctRange?t.correctRange.exact!==void 0?n+=`<p class="correct-item">${t.correctRange.exact}</p>`:t.correctRange.min!==void 0&&t.correctRange.max!==void 0&&(n+=`<p class="correct-item">${t.correctRange.min} - ${t.correctRange.max}</p>`):n+=`<p class="correct-item">${e}</p>`,n},formatUserResponse:(t,e)=>`<p class="response-item">${e}</p>`};function Ns(t){ue(t,["correctRange"]);const{id:e,prompt:n,correctRange:s,units:r="",tolerance:i=0,controlled:o=!1}=t;let a=null;const l={id:e,type:"numeric",render:(c,d=null)=>{T(c,e),a=c;const f=ke(d)??"",m=`
                <div class="interaction numeric" data-interaction-id="${e}">
                    <div class="question-prompt">
                        <h3>${n}</h3>
                    </div>
                    <div class="numeric-input-container">
                        <label for="${e}_input">Your answer:</label>
                        <input
                          type="number"
                          id="${e}_input"
                          name="${e}_input"
                          step="any"
                          value="${f}"
                          aria-describedby="${e}_feedback"
                          ${s.min!==void 0?`min="${s.min}"`:""}
                          ${s.max!==void 0?`max="${s.max}"`:""}
                          data-testid="${e}-input"
                        />
                        ${r?`<span class="units">${r}</span>`:""}
                    </div>
                    ${me(e,o)}
                    ${Oe(e)}
                </div>
            `;c.innerHTML=m,c.querySelector('input[type="number"]').addEventListener("keydown",g=>{g.key==="Enter"&&(g.preventDefault(),l.checkAnswer())}),o||c.addEventListener("click",pe(l,{...t,scormType:"numeric",correctPattern:JSON.stringify(s)}))},evaluate:c=>{if(c==null||c==="")return{score:0,correct:!1,response:"",error:"No answer provided"};const d=parseFloat(c);if(isNaN(d))return{score:0,correct:!1,response:c,error:"Invalid numeric value"};let f=!1;return s.exact!==void 0?f=Math.abs(d-s.exact)<=i:s.min!==void 0&&s.max!==void 0?f=d>=s.min&&d<=s.max:s.min!==void 0?f=d>=s.min:s.max!==void 0&&(f=d<=s.max),{score:f?1:0,correct:f,response:c,value:d}},checkAnswer:()=>{T(a,e);const c=a.querySelector('input[type="number"]');if(!c)throw new Error(`Input element not found for numeric question "${e}"`);const d=c.value.trim();if(d==="")return U(a,e,"Please enter a number.","error"),null;const f=l.evaluate(d);if(f.correct)U(a,e,`Correct! ${f.value}${r}`,"correct");else{let m="";s.exact!==void 0?m=`Expected: ${s.exact}${r}`:s.min!==void 0&&s.max!==void 0?m=`Expected: between ${s.min} and ${s.max}${r}`:s.min!==void 0?m=`Expected: at least ${s.min}${r}`:s.max!==void 0&&(m=`Expected: at most ${s.max}${r}`),U(a,e,`Incorrect. ${m}`,"incorrect")}return f},reset:()=>{T(a,e);const c=a.querySelector('input[type="number"]');c&&(c.value=""),he(a,e)},setResponse:c=>{if(T(a,e),c==null)return;const d=a.querySelector('input[type="number"]');if(!d)throw new Error(`Input element not found for numeric question "${e}"`);d.value=c},getResponse:()=>{T(a,e);const c=a.querySelector('input[type="number"]');if(!c)throw new Error(`Input element not found for numeric question "${e}"`);return c.value||null},getCorrectAnswer:()=>s};return o||Ae(t,l),l}const Xe={appearance:{correct:{default:{fill:"rgba(187, 247, 208, 0.3)",stroke:"#15803d",strokeWidth:3},hover:{fill:"rgba(187, 247, 208, 0.5)",stroke:"#15803d",strokeWidth:4},selected:{fill:"rgba(0, 200, 0, 0.3)",stroke:"#00cc00",strokeWidth:4}},incorrect:{default:{fill:"rgba(254, 205, 211, 0.3)",stroke:"#be123c",strokeWidth:3},hover:{fill:"rgba(254, 205, 211, 0.5)",stroke:"#be123c",strokeWidth:4},selected:{fill:"rgba(255, 0, 0, 0.3)",stroke:"#cc0000",strokeWidth:4}},primary:{default:{fill:"rgba(199, 210, 254, 0.3)",stroke:"#4338ca",strokeWidth:3},hover:{fill:"rgba(199, 210, 254, 0.5)",stroke:"#4338ca",strokeWidth:4},selected:{fill:"rgba(0, 200, 0, 0.3)",stroke:"#00cc00",strokeWidth:4}},accent:{default:{fill:"rgba(186, 230, 253, 0.3)",stroke:"#0369a1",strokeWidth:3},hover:{fill:"rgba(186, 230, 253, 0.5)",stroke:"#0369a1",strokeWidth:4},selected:{fill:"rgba(0, 200, 0, 0.3)",stroke:"#00cc00",strokeWidth:4}}}};function zo(t){if(t.position&&!t.pos)return t;const e=t.pos?{x:t.pos[0],y:t.pos[1],width:t.pos[2],height:t.pos[3]}:t.position;let n;t.appearance?n=t.appearance:t.theme&&Xe.appearance[t.theme]?n=Xe.appearance[t.theme]:n=t.correct?Xe.appearance.correct:Xe.appearance.incorrect;const s=typeof t.feedback=="string"?{onSelect:t.feedback,onDeselect:null}:t.feedback||{onSelect:null,onDeselect:null};return{id:t.id,shape:t.shape||"rectangle",position:e,correct:t.correct,label:t.label,appearance:n,feedback:s}}const No={creator:"createHotspotQuestion",scormType:"other",showCheckAnswer:!0,isAnswered:t=>Array.isArray(t)&&t.length>0,getCorrectAnswer:t=>{const e=ot(t?.hotspots,t?.id);if(!e.length)return"";const n=e.filter(s=>s.correct).map(s=>s.id);return n.length?JSON.stringify(n):""},formatCorrectAnswer:(t,e)=>{const n=ot(t?.hotspots,t?.id),s=new Map(n.map(a=>[a.id,a])),r=new Set(s.keys()),i=He(e,r),o=(i.length?i:n.filter(a=>a.correct)).map(a=>s.get(a)).filter(Boolean);return o.length?'<ul class="list-disc pl-4 m-0">'+o.map(a=>`<li class="correct-item">${a.label}</li>`).join("")+"</ul>":'<p class="correct-item">No correct hotspots configured</p>'},formatUserResponse:(t,e)=>{const n=ot(t?.hotspots,t?.id),s=new Map(n.map(i=>[i.id,i])),r=He(e,new Set(s.keys()));return r.length?'<ul class="list-disc pl-4 m-0">'+r.map(i=>{const o=s.get(i);return`<li class="response-item">${o?o.label:i}</li>`}).join("")+"</ul>":'<p class="response-item">No hotspots selected</p>'}};function js(t){ue(t,["id","prompt","image","hotspots"]);const{id:e,prompt:n,image:s={},hotspots:r=[],feedback:i,controlled:o=!1}=t;if(!s?.src)throw new Error(`Hotspot question "${e}" is missing an image source.`);if(!Array.isArray(r)||r.length===0)throw new Error(`Hotspot question "${e}" has no hotspot regions configured.`);const a=r.map(zo),l=Ho(ot(a,e)),c=new Map(l.map(g=>[g.id,g])),d=new Set(c.keys()),f=l.filter(g=>g.correct).map(g=>g.id);let m=null;const u={id:e,type:"hotspot",render:(g,p=null)=>{T(g,e),m=g;const h=He(p,d);h.length&&console.log(`[Hotspot] Initializing with ${h.length} saved selection(s)`),g._hotspotState={selectedSpots:h};const b=l.map((w,S)=>{const E=h.includes(w.id),A=["hotspot-area"];E&&A.push("selected");const L=["position: absolute",`left: ${w.cssLeft}`,`top: ${w.cssTop}`,`width: ${w.cssWidth}`,`height: ${w.cssHeight}`,`background: ${E?w.selectedBackgroundColor:w.backgroundColor}`,`border-color: ${E?w.selectedBorderColor:w.borderColor}`,`border-width: ${E?w.selectedBorderWidth:w.borderWidth}px`,`border-style: ${E?w.selectedBorderStyle||w.borderStyle||"solid":w.borderStyle||"solid"}`,`border-radius: ${w.borderRadius}`,"cursor: pointer","z-index: 10"];return w.style&&L.push(w.style),`
          <button
            type="button"
            role="checkbox"
            class="${A.join(" ")}"
            data-hotspot-id="${w.id}"
            data-correct="${w.correct}"
            data-default-bg="${w.backgroundColor}"
            data-selected-bg="${w.selectedBackgroundColor}"
            data-default-border="${w.borderColor}"
            data-selected-border="${w.selectedBorderColor}"
            data-default-border-width="${w.borderWidth}"
            data-selected-border-width="${w.selectedBorderWidth}"
            data-default-border-style="${w.borderStyle||"solid"}"
            data-selected-border-style="${w.selectedBorderStyle||w.borderStyle||"solid"}"
            data-hover="false"
            aria-label="${w.label}"
            aria-checked="${E}"
            title="${w.label}"
            style="${L.join("; ")}"
            data-testid="${e}-hotspot-${w.id}"
          >
            <span class="sr-only">${w.label||`Hotspot ${S+1}`}</span>
          </button>`}).join(""),y=`
        <div class="interaction hotspot" data-interaction-id="${e}">
          <div class="question-prompt">
            <h3>${n}</h3>
          </div>
          <div class="hotspot-container">
            <div class="image-container position-relative">
              <img
                src="${s.src}"
                alt="${s.alt||""}"
                class="w-full h-auto"
                id="${e}_image"
              />
              ${b}
            </div>
          </div>
          <div class="hotspot-feedback" id="${e}_feedback" aria-live="polite"></div>
          ${me(e,o)}
        </div>`;g.innerHTML=y,h.length&&u.setResponse(h),setupHotspotInteraction(g,u,{controlled:o,validSpotIds:d,hotspotMap:c})},evaluate:g=>{const p=He(Array.isArray(g)?g:[],d),h=l.filter(A=>A.correct).map(A=>A.id),b=new Set(h),y=h.every(A=>p.includes(A)),w=p.every(A=>b.has(A)),S=p.length>0&&y&&w;return{score:S?1:0,correct:S,results:{selected:p,correct:h},response:JSON.stringify(p)}},checkAnswer:(g=null)=>{const p=g||m;T(p,e);const h=u.getResponse(p)||[];if(!h.length)return U(p,"Select at least one hotspot before checking your answer.","error"),null;const b=u.evaluate(h);if(b.correct)U(p,"âœ“ Excellent! You found all the correct areas.","correct");else{const y=b.results.correct.length,w=h.length;U(p,`âœ— Keep trying. ${w} selected / ${y} required.`,"incorrect")}return Ms(e,"other",b.response,b.correct,JSON.stringify(l.filter(y=>y.correct).map(y=>y.id))),b},reset:(g=null)=>{const p=g||m;T(p,e),u.setResponse([],p),he(p)},setResponse:(g,p=null)=>{const h=p||m;T(h,e);const b=He(g,d);h._hotspotState||(h._hotspotState={selectedSpots:[]}),h._hotspotState.selectedSpots=b,h.querySelectorAll(".hotspot-area").forEach(w=>{const S=w.dataset.hotspotId,E=b.includes(S),A=c.get(S);if(w.classList.toggle("selected",E),w.setAttribute("aria-checked",E?"true":"false"),A){const L=w.dataset.hover==="true";jo(w,A,{selected:E,hover:L})}})},getResponse:(g=null)=>{const p=g||m;return T(p,e),p._hotspotState?p._hotspotState.selectedSpots.slice():[]},getCorrectAnswer:()=>f.slice(),hotspots:l,prompt:n,feedback:i,controlled:o};return o||Ae(t,u),u}function jo(t,e,{selected:n,hover:s}){if(!t||!e)return;const r=s&&e.hoverBackgroundColor?e.hoverBackgroundColor:n?e.selectedBackgroundColor:e.backgroundColor,i=s&&e.hoverBorderColor?e.hoverBorderColor:n?e.selectedBorderColor:e.borderColor,o=s&&e.hoverBorderWidth!==void 0?e.hoverBorderWidth:n?e.selectedBorderWidth:e.borderWidth,a=s&&e.hoverBorderStyle?e.hoverBorderStyle:n?e.selectedBorderStyle:e.borderStyle;t.style.background=r,t.style.borderColor=i,t.style.borderWidth=`${Math.max(0,at(o,e.borderWidth))}px`,t.style.borderStyle=a||"solid"}function He(t,e){const n=new Set;return(vt(t,"array")||[]).forEach(r=>{e.has(String(r))&&n.add(String(r))}),Array.from(n)}function Po(t,e,n){const s=`${e||"hotspot"}_${n+1}`;t.id=typeof t.id=="string"&&t.id.trim()?t.id.trim():s,t.label=typeof t.label=="string"&&t.label.trim()?t.label.trim():`Hotspot ${n+1}`}function Bo(t){const e=typeof t.position=="object"&&t.position!==null?t.position:{},n=Object.keys(e).length>0,s=je(e.xUnit||e.unit||t.xUnit,n?"px":"%"),r=je(e.yUnit||e.unit||t.yUnit,n?"px":"%"),i=je(e.widthUnit||e.unit||t.widthUnit,n?"px":"%"),o=je(e.heightUnit||e.unit||t.heightUnit,n?"px":"%");t.cssLeft=et(e.x??t.x,{fallback:0,unit:s,clampToPercent:s==="%",min:0}),t.cssTop=et(e.y??t.y,{fallback:0,unit:r,clampToPercent:r==="%",min:0}),t.cssWidth=et(e.width??t.width,{fallback:n?80:5,unit:i,clampToPercent:i==="%",min:1}),t.cssHeight=et(e.height??t.height,{fallback:n?80:5,unit:o,clampToPercent:o==="%",min:1}),t.x=Number.parseFloat(t.cssLeft)||0,t.y=Number.parseFloat(t.cssTop)||0,t.width=Number.parseFloat(t.cssWidth)||(n?80:5),t.height=Number.parseFloat(t.cssHeight)||(n?80:5)}function Fo(t){const e=t.appearance||{},n=e.default||{},s=e.selected||{},r=e.hover||{};t.backgroundColor=n.fill||t.backgroundColor||"rgba(255, 0, 0, 0.3)",t.selectedBackgroundColor=s.fill||t.selectedBackgroundColor||"rgba(0, 150, 255, 0.5)",t.hoverBackgroundColor=r.fill||t.hoverBackgroundColor||"",t.borderColor=n.stroke||t.borderColor||"#ff0000",t.borderWidth=at(n.strokeWidth??t.borderWidth,2),t.selectedBorderColor=s.stroke||t.selectedBorderColor||t.borderColor,t.selectedBorderWidth=at(s.strokeWidth??t.selectedBorderWidth,t.borderWidth),t.hoverBorderColor=r.stroke||t.hoverBorderColor||"",t.hoverBorderWidth=at(r.strokeWidth??t.hoverBorderWidth,t.borderWidth),t.borderStyle=n.strokeStyle||t.borderStyle||"solid",t.selectedBorderStyle=s.strokeStyle||t.selectedBorderStyle||t.borderStyle,t.hoverBorderStyle=r.strokeStyle||t.hoverBorderStyle||t.borderStyle}function Vo(t){t.borderRadius=typeof t.borderRadius=="string"?t.borderRadius:t.shape&&t.shape.toLowerCase()==="rectangle"?"0":"50%",t.correct=t.correct===!0||t.correct==="true"||t.correct===1,t.style=typeof t.style=="string"?t.style:""}function ot(t,e){return Array.isArray(t)?t.map((n={},s)=>{const r={...n};return Po(r,e,s),Bo(r),Fo(r),Vo(r),r}):[]}function Ho(t){const e=new Set;return t.map((n,s)=>{let r=n.id;r||(r=`hotspot_${s+1}`);let i=1;for(;e.has(r);)i+=1,r=`${n.id||`hotspot_${s+1}`}_${i}`;return e.add(r),{...n,id:r}})}function je(t,e="%"){if(!t&&t!==0)return e;const n=String(t).trim().toLowerCase();return n?n==="%"||n==="percent"||n==="percentage"?"%":n==="px"||n==="pixel"||n==="pixels"?"px":n:e}function et(t,{fallback:e=0,unit:n="%",clampToPercent:s=!1,min:r=null,max:i=null}={}){const o=je(n,"%");if(typeof t=="string"&&t.trim())return t.trim();const a=Number.parseFloat(t);if(Number.isFinite(a))return Mt(a,o,{clampToPercent:s,min:r,max:i});if(typeof e=="string"&&e.trim())return e.trim();const l=Number.parseFloat(e);return Number.isFinite(l)?Mt(l,o,{clampToPercent:s,min:r,max:i}):Mt(0,o,{clampToPercent:s,min:r,max:i})}function Mt(t,e,{clampToPercent:n,min:s,max:r}){let i=t;return typeof s=="number"&&(i=Math.max(s,i)),typeof r=="number"&&(i=Math.min(r,i)),n&&(i=Math.min(100,Math.max(0,i))),`${i}${e}`}function at(t,e=0){const n=Number.parseFloat(t);if(Number.isFinite(n))return Math.max(0,n);const s=Number.parseFloat(e);return Number.isFinite(s)?Math.max(0,s):0}const Uo={creator:"createSequencingQuestion",scormType:"sequencing",showCheckAnswer:!0,isAnswered:t=>Array.isArray(t)&&t.length>0,getCorrectAnswer:t=>JSON.stringify(t.correctOrder||[]),formatCorrectAnswer:(t,e)=>{let n='<ol class="list-decimal pl-4 m-0">';const s=Array.isArray(e)?e:[],r=t.items||[];return s.forEach(i=>{const o=r.find(a=>a.id===i);o&&(n+=`<li>${o.text}</li>`)}),n+="</ol>",n},formatUserResponse:(t,e)=>{let n='<ol class="list-decimal pl-4 m-0">';const s=Array.isArray(e)?e:[],r=t.items||[];return s.forEach(i=>{const o=r.find(a=>a.id===i);o&&(n+=`<li>${o.text}</li>`)}),n+="</ol>",n}};function Wo(t){ue(t,["items","correctOrder"]);const{id:e,prompt:n,items:s,correctOrder:r,controlled:i=!1}=t;if(!Array.isArray(s)||s.length<2)throw new Error(`Sequencing question "${e}" must have at least two items`);if(!Array.isArray(r)||r.length!==s.length)throw new Error(`Sequencing question "${e}" correctOrder length must match items length`);let o=null,a=[];const l={id:e,type:"sequencing",render:(m,u=null)=>{T(m,e),o=m;let g=[];const p=ke(u);Array.isArray(p)&&p.length===s.length?g=p:g=s.map(y=>y.id).sort(()=>Math.random()-.5),a=[...g];let h=`
                <div class="interaction sequencing" data-interaction-id="${e}">
                    <div class="question-prompt">
                        <h3>${n}</h3>
                    </div>
                    <div class="sequencing-list" role="list">
            `;g.forEach((y,w)=>{const S=s.find(E=>E.id===y);S&&(h+=`
                        <div class="sequence-item" 
                             draggable="true" 
                             data-item-id="${S.id}" 
                             role="listitem"
                             tabindex="0"
                             aria-label="${S.text}. Press Up or Down arrow to reorder.">
                            <span class="drag-handle" aria-hidden="true">â˜°</span>
                            <span class="item-text">${S.text}</span>
                        </div>
                    `)}),h+=`
                    </div>
                    ${Oe()}
                    ${me(e,i)}
                </div>
            `,m.innerHTML=h;const b=m.querySelector(".sequencing-list");d(b),f(b),m.addEventListener("click",pe(l,t))},getResponse:()=>[...a],setResponse:m=>{Array.isArray(m)&&(a=[...m],l.render(o,a))},checkAnswer:()=>{const m=JSON.stringify(a)===JSON.stringify(r),u={correct:m,score:m?1:0,response:a,feedback:m?t.feedback?.correct||"Correct sequence!":t.feedback?.incorrect||"Incorrect sequence. Try again."};return U(o,u.correct,u.feedback),u},reset:()=>{he(o),l.render(o,null)},showHint:()=>{}};function c(m){a=Array.from(m.querySelectorAll(".sequence-item")).map(g=>g.dataset.itemId)}function d(m){let u=null;m.addEventListener("dragstart",g=>{u=g.target.closest(".sequence-item"),u&&(g.dataTransfer.effectAllowed="move",g.dataTransfer.setData("text/plain",u.dataset.itemId),u.classList.add("dragging"),u.setAttribute("aria-grabbed","true"))}),m.addEventListener("dragend",g=>{u&&(u.classList.remove("dragging"),u.setAttribute("aria-grabbed","false"),u=null),m.querySelectorAll(".sequence-item").forEach(p=>{p.classList.remove("drag-over-top","drag-over-bottom")}),c(m)}),m.addEventListener("dragover",g=>{g.preventDefault();const p=g.target.closest(".sequence-item");if(p&&p!==u){const h=p.getBoundingClientRect(),b=h.top+h.height/2;p.classList.remove("drag-over-top","drag-over-bottom"),g.clientY<b?p.classList.add("drag-over-top"):p.classList.add("drag-over-bottom")}}),m.addEventListener("dragleave",g=>{const p=g.target.closest(".sequence-item");p&&p.classList.remove("drag-over-top","drag-over-bottom")}),m.addEventListener("drop",g=>{g.preventDefault();const p=g.target.closest(".sequence-item");if(p&&u&&p!==u){const h=p.getBoundingClientRect(),b=h.top+h.height/2;g.clientY<b?m.insertBefore(u,p):m.insertBefore(u,p.nextSibling),p.classList.remove("drag-over-top","drag-over-bottom"),c(m)}})}function f(m){m.addEventListener("keydown",u=>{const g=u.target.closest(".sequence-item");if(g&&(u.key==="ArrowUp"||u.key==="ArrowDown")){if(u.preventDefault(),u.key==="ArrowUp"){const p=g.previousElementSibling;p&&(m.insertBefore(g,p),g.focus(),c(m))}else if(u.key==="ArrowDown"){const p=g.nextElementSibling;p&&(m.insertBefore(g,p.nextSibling),g.focus(),c(m))}}})}return l}const Qo=Object.freeze({"multiple-choice":{creator:rt,metadata:It},"multiple-choice-single":{creator:rt,metadata:It},"multiple-choice-multiple":{creator:rt,metadata:It},"true-false":{creator:Rs,metadata:$o},"fill-in":{creator:Os,metadata:ko},matching:{creator:Ds,metadata:Ao},"drag-drop":{creator:zs,metadata:Lo},numeric:{creator:Ns,metadata:Do},hotspot:{creator:js,metadata:No},sequencing:{creator:Wo,metadata:Uo},likert:{creator:Ts,metadata:io}});function Yo(t){const e=[];return t.forEach(n=>{const{id:s,questions:r,selectCount:i}=n;if(i==="all"){r.forEach((l,c)=>{e.push({...l,_meta:{bankId:s,originalIndex:c}})});return}_t(r).slice(0,i).forEach((l,c)=>{const d=r.indexOf(l);e.push({...l,_meta:{bankId:s,originalIndex:d}})})}),e}const Go={render:"function",getResponse:"function",setResponse:"function",evaluate:"function"};function Ko(t,e,n){const s=[];for(const[r,i]of Object.entries(Go))typeof t[r]!==i&&s.push(`Missing required method '${r}' (expected ${i}, got ${typeof t[r]})`);if(s.length>0){const r=`[AssessmentFactory:${n}] Question type '${e.type}' (ID: ${e.id}) has invalid interface:
  - ${s.join(`
  - `)}`;throw v.emit("assessment:error",r),new Error(r)}}function Jo(t,e,n,s){const r=t.type,i=Qo[r];if(!i){const a=`[AssessmentFactory:${s}] Unknown question type: ${r}`;throw v.emit("assessment:error",a),new Error(a)}const o=i.creator({...t,controlled:!0});return Ko(o,t,s),{...o,metadata:i.metadata,async persistToSCORM(){const a=o.getResponse();await n.saveResponse(e,a)},restoreFromSCORM(){const a=n.getResponse(e);a!=null&&o.setResponse(a)}}}function Zo(t){if(!t.id){const u=new Error("Assessment ID required");throw v.emit("assessment:error",{domain:"assessment",operation:"createAssessmentInstance",message:u.message,context:{config:t}}),u}if(!t.questions&&!t.questionBanks){const u=new Error(`Assessment '${t.id}' needs questions or questionBanks`);throw v.emit("assessment:error",{domain:"assessment",operation:"createAssessmentInstance",message:u.message,context:{assessmentId:t.id}}),u}const e=t.id,n=pi(t,k);let s=t.questions||[],r=[],i=t;function o(){const u=n.getSelectedQuestions();if(u&&Array.isArray(u)){const g=a(),p=new Map(g.map(h=>[h.id,h]));return u.map(h=>p.get(h)).filter(h=>h!==void 0)}if(t.questionBanks&&Array.isArray(t.questionBanks)&&t.questionBanks.length>0){let g=Yo(t.questionBanks);return t.settings?.randomizeQuestions&&(g=_t(g)),g}return t.settings?.randomizeQuestions&&Array.isArray(t.questions)?_t(t.questions):t.questions||[]}function a(){return t.questionBanks&&Array.isArray(t.questionBanks)?t.questionBanks.flatMap(u=>u.questions||[]):t.questions||[]}function l(u){return u.map((g,p)=>Jo(g,p,n,e))}let c=null,d=null;function f(u,g={}){if(!u){const A=`[AssessmentFactory:${e}] targetContainer is required for render()`;throw v.emit("assessment:error",A),new Error(A)}u.className="assessment-navigator";let p=n.getSummary();const h=n.getSession();p||(n.updateSummary({attempts:0}).catch(A=>{v.emit("assessment:error",{domain:"assessment",operation:"initialize-summary",message:`Failed to initialize summary: ${A.message}`,context:{assessmentId:e}})}),p={attempts:0}),s=o(),t.questionBanks&&!h?.selectedQuestions&&n.setSelectedQuestions(s).catch(A=>{v.emit("assessment:error",{domain:"assessment",operation:"persist-selected-questions",message:`Failed to persist selected questions: ${A.message}`,context:{assessmentId:e}})}),r=l(s),i={...t,questions:s};const b=vo(i,n,r);c=b.initialize(u),d=So(n,c,r,i,b),d.initialize(u);const y=g.fromSlide,w=t.settings?.remedialSlideIds||[];if(y&&w.includes(y)&&p?.lastResults&&!p.lastResults.passed){n.clearSession().then(()=>{Ne(),c.showView("intro")});return}const E=p?.lastResults;if(E){const A=m(E,i);Ne(),c.showView("results",A);return}if(h&&!h.submitted){const A=h.currentView||"intro";A==="question"||A==="review"?Ls():Ne(),c.showView(A);return}Ne(),c.showView("intro")}function m(u,g){const h=n.getSummary()?.attempts||0,{attemptsBeforeRemedial:b,attemptsBeforeRestart:y,allowRetake:w,settings:S}=g,E={attemptNumber:u.attemptNumber,totalQuestions:u.totalQuestions,correctCount:u.correctCount,scorePercentage:u.scorePercentage,passed:u.passed,details:null};let A=null;if(y&&h>=y)A={type:"restart",action:"restart-course",label:"Restart Course",message:`You've completed ${h} attempt(s). You must restart the course to try again.`,messageType:"error"};else{let L=!1;if(b&&h>=b&&!u.passed){const q=g.settings?.remedialSlideIds||(g.settings?.remedialSlideId?[g.settings.remedialSlideId]:[]),C=Qe()||[],x=q.length>0&&q.every(I=>C.includes(I));q.length>0&&!x&&(L=!0,A={type:"remedial",action:"go-to-remedial",label:"Review Content",message:`Please review the content before attempting again (Attempt ${h}/${y||"âˆž"}).`,messageType:"warning",attemptsMessage:`Attempts: ${h}${y?`/${y}`:""}`})}!L&&w!==!1&&!u.passed&&(A={type:"retake",action:"retake",label:"Retake Assessment",attemptsMessage:`Attempts: ${h}${y?`/${y}`:""}`})}return{...E,actionButton:A,timeSpent:null}}return{render:f}}function Ps(t){return`assessment_${t}`}function Xo(t,e={}){if(!k||typeof k.getDomainState!="function"||typeof k.setDomainState!="function")throw new Error("AssessmentManager: StateManager with domain persistence APIs is required");const n=Tt({},t,e);return Zo(n)}function ea(t){if(!t){const r=new Error("AssessmentManager.hasPassedAssessment: assessmentId is required");throw v.emit("assessment:error",{domain:"assessment",operation:"hasPassedAssessment",message:r.message,stack:r.stack,context:{}}),new Error(errorMessage)}const e=Ps(t),n=k.getDomainState(e);if(!n||!n.summary)return!1;const s=n.summary;return s.submitted===!0&&s.lastResults?.passed===!0}function qe(t,e={}){if(!t){const i=new Error("AssessmentManager.meetsCompletionRequirements: assessmentId is required");throw v.emit("assessment:error",{domain:"assessment",operation:"meetsCompletionRequirements",message:i.message,stack:i.stack,context:{}}),i}const n=Ps(t),s=k.getDomainState(n);if(!s||!s.summary)return!1;const r=s.summary;return!(e.requireSubmission&&!r.submitted||e.requirePass&&!(r.lastResults?.passed===!0))}function ta(t=[]){if(!Array.isArray(t)){const n=new Error("AssessmentManager.allAssessmentsMeetRequirements: assessmentSlides must be an array");throw v.emit("assessment:error",{domain:"assessment",operation:"allAssessmentsMeetRequirements",message:n.message,stack:n.stack,context:{assessmentSlides:t}}),n}if(t.length===0)return!0;const e=t.filter(n=>{const s=n.assessment?.completionRequirements;return s&&(s.requireSubmission||s.requirePass)});return e.length===0?!0:e.every(n=>qe(n.assessmentId,n.assessment.completionRequirements))}const na=Object.freeze(Object.defineProperty({__proto__:null,allAssessmentsMeetRequirements:ta,createAssessment:Xo,hasPassedAssessment:ea,meetsCompletionRequirements:qe},Symbol.toStringTag,{value:"Module"}));class sa{constructor(e,n){if(this.container=document.querySelector(e),!this.container)throw new Error(`[ScrollTracker] Container not found: ${e}. Ensure the container exists in the DOM before creating ScrollTracker.`);this.slideId=n,this.maxDepth=0,this.rafId=null,this.isScrolling=!1,this.handleScroll=()=>{this.isScrolling||(this.isScrolling=!0,this.rafId=requestAnimationFrame(()=>this.updateDepth()))},this.container.addEventListener("scroll",this.handleScroll,{passive:!0}),this.updateDepth()}updateDepth(){const e=this.calculateDepth();e>this.maxDepth&&(this.maxDepth=e,H.trackScrollDepth(this.slideId,e)),this.isScrolling=!1}calculateDepth(){const{scrollTop:e,scrollHeight:n,clientHeight:s}=this.container,r=n-s;return r<=0?100:Math.round(e/r*100)}destroy(){this.rafId&&cancelAnimationFrame(this.rafId),this.container&&this.container.removeEventListener("scroll",this.handleScroll)}}window.SCORM_Framework={stateManager:k,objectiveManager:Ie,interactionManager:Me,interactionRegistry:lt,AssessmentManager:na,flagManager:Qt,accessibilityManager:ye,commentManager:We,scoreManager:null,NavigationActions:ro,AppActions:Qi,AppState:_i,createMultipleChoiceQuestion:rt,createTrueFalseQuestion:Rs,createFillInQuestion:Os,createMatchingQuestion:Ds,createDragDropQuestion:zs,createNumericQuestion:Ns,createHotspotQuestion:js,initTabs:Gn,initDropdown:Hn,Modal:Fr,announceToScreenReader:ee,FeedbackSystem:Pi,eventBus:v,courseConfig:P};const Bs="development",ra=Bs==="production",ia=P.environment?.automation?.enabled===!0;let Bt=null;ia&&(console.log("[Framework] Automation mode enabled (MODE:",Bs,")"),Bt=ae(async()=>{const{initializeAutomation:t}=await import("./index.js");return{initializeAutomation:t}},[],import.meta.url).then(({initializeAutomation:t})=>{t(),console.log("[Framework] Automation initialization complete")}).catch(t=>{console.error("[Framework] Failed to load automation module:",t)}));window.addEventListener("submit",t=>{t.preventDefault();const e=t.target,n=t.submitter;let s="N/A (Submission not triggered by a button)";if(n){const i=n.getAttribute("type");s=`Tag: <${n.tagName.toLowerCase()}>, Type: "${i||"submit (default)"}", Text: "${n.textContent.trim()}"`}const r=`[Framework] Critical Error: Form submission blocked.
    Reason: Standard form submissions cause a page reload, which corrupts the SCORM session.
    Form: ${e.id?`#${e.id}`:"(no id)"}
    Submitter: ${s}
    Fix: Ensure all <button> elements inside <form> have 'type="button"'. Use JavaScript and the data-action pattern to handle user interactions instead of form submissions.`;throw console.error(r,{form:e,submitter:n}),new Error("Form submission blocked to prevent SCORM data corruption. See console for details.")});window.addEventListener("click",t=>{const e=t.target.closest("a");if(!e||e.target==="_blank")return;const n=e.getAttribute("href");t.preventDefault();const s=`[Framework] Critical Error: Navigation blocked.
    Reason: Using <a> tags for navigation causes a page reload, which corrupts the SCORM session.
    Anchor Href: "${n||"(not set)"}"
    Anchor Text: "${e.textContent.trim()}"
    Fix: For internal navigation, use 'NavigationActions.goToSlide(slideId)'. For other actions, use a <button type="button"> with the data-action pattern.`;throw console.error(s,{anchor:e}),new Error("Anchor tag navigation blocked to prevent SCORM data corruption. See console for details.")});function qn(t){try{is()&&os(t)}catch{}v.emit("initialization:error",{domain:"initialization",operation:"initializeCourseApplication",message:t.message,stack:t.stack,context:{timestamp:new Date().toISOString()}});const e=document.getElementById("content");e&&(e.innerHTML=`
          <div class="p-6 callout callout-error" role="alert" aria-live="assertive">
            <h2>Initialization Error</h2>
            <p><strong>Failed to initialize course:</strong> ${t.message}</p>
            <p>Please refresh the page. If the problem persists, contact support.</p>
          </div>
        `)}async function Ln(){console.log("[CourseInit] Initializing course modules...");try{if(P.metadata?.title){document.title=P.metadata.title;const o=document.getElementById("page-title");o&&(o.textContent=P.metadata.title)}if(P.metadata?.description){const o=document.getElementById("page-description");o&&o.setAttribute("content",P.metadata.description)}if(!ra)try{const{lintCourse:o}=await ae(async()=>{const{lintCourse:a}=await import("./CourseLinter.js");return{lintCourse:a}},[],import.meta.url);await o(P)}catch(o){throw qn(o),o}if(Bt&&(console.log("[CourseInit] Waiting for automation initialization..."),await Bt),!oe.initialize())throw new Error("SCORM initialization failed. Cannot start course without LMS connection.");if(oe.setupLifecycleHandlers(),k.initialize(),Ie.initialize(P.objectives),Me.initialize(),ye.initialize(),Qt.initialize(),We.initialize(),H.initialize(P),P.scoring){const a=(await ae(()=>import("./score-manager.js"),[],import.meta.url)).default;a.initialize(P.scoring),window.SCORM_Framework.scoreManager=a}Ie.syncAllObjectivesToSCORM(),Me.syncAllInteractionsToSCORM(),rr(P);const e=await ir(),n=await cr(),s=await Nn(),r=document.getElementById("slide-container");if(!r)throw new Error("Framework error: #slide-container not found.");const i=Zn(r,"main");e.forEach(o=>{const a=o.component;if(!o.engagement)throw new Error(`Slide "${o.id}" missing required 'engagement' configuration in course-config.js structure. Add "engagement: { required: false }" to the slide definition in courseConfig.structure.`);i.registerView(o.id,{render:async l=>{lt.clear(),H.initSlide(o.id,o.engagement);const c={...l,slideId:o.id,title:o.title};let d;try{d=await a.render(null,c)}catch(f){throw new Error(`Slide "${o.id}" render() failed: ${f.message}`)}if(!d)throw new Error(`Slide "${o.id}" render() returned null/undefined. Must return a DOM element.`);return lt.setReady(),d},onShow:(l,c)=>{const d=new sa("main#content",o.id);l._scrollTracker=d,a.onShow&&a.onShow(l,c)},onHide:l=>{l._scrollTracker&&(l._scrollTracker.destroy(),l._scrollTracker=null),H.cleanupSlide(o.id),a.onHide&&a.onHide(l)}})}),rs(),uo(),ys(),await Es(e,i,n,s),v.on("view:change",({view:o,context:a})=>{console.log(`[ViewManager] View changed to '${o}'`,a)}),console.log("[CourseInit] Initialization complete"),mo(),window.addEventListener("beforeunload",o=>{let l=!1;if(P.environment?.disableBeforeUnloadGuard===!0?l=!1:P.environment?.disableBeforeUnloadGuard===!1&&(l=!0),P.environment?.automation?.enabled&&P.environment?.automation?.disableBeforeUnloadGuard&&(l=!1),!l){console.log("[Framework] Beforeunload warning is disabled.");return}if(gs()){console.log("[Framework] Intentional exit detected, allowing page unload.");return}o.preventDefault(),o.returnValue="",console.warn("[Framework] Unintentional page unload detected. Showing browser confirmation.")})}catch(t){throw qn(t),t}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ln):Ln();export{ae as _,ce as a,Is as b,P as c,lt as d,H as e,v as f,ne as g,Ie as h,Qt as i,k as j,Xo as k,zs as l,Os as m,Ns as n,Oi as o,As as p,ee as q,Ms as r,$e as s,Me as t,vs as u,ps as v};
