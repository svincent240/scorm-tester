<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: blob: file: scorm-app:; script-src 'self' 'unsafe-inline' scorm-app: file:; style-src 'self' 'unsafe-inline' scorm-app: file:; connect-src 'self' scorm-app: data: file:; frame-src 'self' scorm-app: data: blob: file:; img-src 'self' scorm-app: data: blob: file:;">
  <meta name="description" content="SCORM Tester - Professional SCORM 2004 4th Edition compliance testing tool">
  <meta name="author" content="SCORM Tester Team">
  <meta name="keywords" content="SCORM, e-learning, LMS, testing, compliance, SCORM 2004">
  
  <title>SCORM Tester</title>
  
  <!-- Main stylesheet -->
  <link rel="stylesheet" href="scorm-app://app/src/styles/main.css">
  
  <!-- Theme management -->
  <script>
    // Apply saved theme or system preference before page load
    (function() {
      let savedTheme = null;
      try {
        // DIAGNOSTIC: Log security context information
        console.log('THEME INIT: Current URL:', window.location.href);
        console.log('THEME INIT: Protocol:', window.location.protocol);
        console.log('THEME INIT: Origin:', window.location.origin);
        console.log('THEME INIT: localStorage available:', typeof localStorage !== 'undefined');
        
        // Only attempt localStorage when running under a storage-capable origin.
        // Pages loaded via scorm-app:// are opaque origins and accessing localStorage
        // can throw a SecurityError. Skip attempting access under that protocol.
        if (window.location && window.location.protocol !== 'scorm-app:' && typeof localStorage !== 'undefined') {
          try {
            savedTheme = localStorage.getItem('scorm-tester-theme');
            console.log('THEME INIT: Successfully accessed localStorage, saved theme:', savedTheme);
          } catch (err) {
            // localStorage access threw (e.g., storage disabled) - log safely
            console.warn('THEME INIT: localStorage access threw:', err && err.message);
          }
        } else {
          console.log('THEME INIT: Skipping localStorage access due to protocol or unavailable storage');
        }
      } catch (error) {
        console.warn('THEME INIT: localStorage access failed:', error.message);
        console.warn('THEME INIT: Error details:', error);
      }
      
      const systemTheme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'default';
      const theme = savedTheme || systemTheme;
      document.documentElement.setAttribute('data-theme', theme);
      document.documentElement.classList.add(`theme-${theme}`);
    })();
  </script>
</head>
<body class="scorm-tester-app">
  <!-- Application Container -->
  <div id="app" class="app-layout">
    
    <!-- Header -->
    <header id="app-header" class="app-header">
      <div class="header">
        <div class="header__brand">
          <svg class="header__brand-logo" viewBox="0 0 32 32" fill="currentColor">
            <path d="M16 2L3 7v10c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V7l-13-5z"/>
            <path d="M16 8l-6 2.5v5c0 2.78 1.92 5.37 4.5 6 2.58-.63 4.5-3.22 4.5-6v-5L16 8z"/>
          </svg>
          <span>SCORM Tester</span>
        </div>
        
        <nav class="header__nav">
          <button id="course-load-btn" class="btn btn--primary" title="Load SCORM Course (ZIP)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
            </svg>
            Load ZIP
          </button>
          <button id="course-folder-btn" class="btn btn--secondary" title="Load SCORM Course Folder">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M10,4L12,6H20A2,2 0 0,1 22,8V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4H10Z"/>
            </svg>
            Load Folder
          </button>
        </nav>
        
        <div class="header__actions">
          <button id="theme-toggle" class="btn btn--ghost btn--icon" title="Toggle Theme">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12,18C11.11,18 10.26,17.8 9.5,17.45C11.56,16.5 13,14.42 13,12C13,9.58 11.56,7.5 9.5,6.55C10.26,6.2 11.11,6 12,6A6,6 0 0,1 18,12A6,6 0 0,1 12,18M20,8.69V4H15.31L12,0.69L8.69,4H4V8.69L0.69,12L4,15.31V20H8.69L12,23.31L15.31,20H20V15.31L23.31,12L20,8.69Z"/>
            </svg>
          </button>
          
          
          
          <button id="scorm-inspector-toggle" class="btn btn--ghost btn--icon" title="SCORM Inspector (Ctrl+Shift+S)">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
            </svg>
          </button>
          
          <button id="sidebar-toggle" class="btn btn--ghost btn--icon hide-desktop" title="Toggle Sidebar">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
            </svg>
          </button>
        </div>
      </div>
    </header>
    
    <!-- Main Content Area -->
    <main class="app-main">
      
      <!-- Sidebar -->
      <aside id="app-sidebar" class="app-sidebar">
        <div class="sidebar">
          <div class="sidebar__header">
            <h2>Course Outline</h2>
          </div>
          
          <div class="sidebar__content">
            <div id="course-outline" class="course-outline">
              <div class="course-outline__empty">
                <p>No course loaded</p>
                <button class="btn btn--outline btn--sm" onclick="document.getElementById('course-load-btn').click()">
                  Load Course
                </button>
              </div>
            </div>
          </div>
          

        </div>
      </aside>
      
      <!-- Content Area -->
      <div class="app-content">
        
        <!-- Navigation Controls -->
        <div id="navigation-controls"></div>
        
        <!-- Content Viewer -->
        <div id="content-viewer" class="content-viewer">
          <div class="content-viewer__container">
            <div class="content-viewer__welcome">
              <div class="welcome-content">
                <h1>Welcome to SCORM Tester</h1>
                <p>Professional SCORM 2004 4th Edition compliance testing tool</p>
                
                <div class="welcome-actions">
                  <button class="btn btn--primary btn--lg" onclick="document.getElementById('course-load-btn').click()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                    Load ZIP
                  </button>

                  <button class="btn btn--outline btn--lg" id="welcome-folder-btn" onclick="document.getElementById('course-folder-btn').click()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                      <path d="M10,4L12,6H20A2,2 0 0,1 22,8V18A2,2 0 0,1 20,20H4A2,2 0 0,1 2,18V6A2,2 0 0,1 4,4H10Z"/>
                    </svg>
                    Load Folder
                  </button>
                  
                  <button class="btn btn--ghost btn--lg" id="sample-course-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,16.5L18,9.5L16.59,8.09L11,13.67L7.91,10.59L6.5,12L11,16.5Z"/>
                    </svg>
                    Try Sample Course
                  </button>
                </div>

                <section class="welcome-recents" aria-labelledby="recent-courses-title" style="margin-top: 20px;">
                  <h2 id="recent-courses-title" class="h3">Recent Courses</h2>
                  <div id="recent-courses" class="recent-courses"></div>
                </section>
                
                <div class="welcome-features">
                  <div class="feature">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,16.5L18,9.5L16.59,8.09L11,13.67L7.91,10.59L6.5,12L11,16.5Z"/>
                    </svg>
                    <div>
                      <h3>SCORM 2004 Compliant</h3>
                      <p>Full support for SCORM 2004 4th Edition specification</p>
                    </div>
                  </div>
                  
                  <div class="feature">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M20,8H17.19C16.74,7.22 16.12,6.55 15.37,6.04L17,4.41L15.59,3L13.42,5.17C12.96,5.06 12.49,5 12,5C11.51,5 11.04,5.06 10.59,5.17L8.41,3L7,4.41L8.62,6.04C7.88,6.55 7.26,7.22 6.81,8H4V10H6.09C6.04,10.33 6,10.66 6,11V12H4V14H6V15C6,15.34 6.04,15.67 6.09,16H4V18H6.81C7.85,19.79 9.78,21 12,21C14.22,21 16.15,19.79 17.19,18H20V16H17.91C17.96,15.67 18,15.34 18,15V14H20V12H18V11C18,10.66 17.96,10.33 17.91,10H20V8Z"/>
                    </svg>
                    <div>
                      <h3>Advanced Debugging</h3>
                      <p>Real-time API monitoring and comprehensive testing tools</p>
                    </div>
                  </div>
                  
                  <div class="feature">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12,2C13.1,2 14,2.9 14,4C14,5.1 13.1,6 12,6C10.9,6 10,5.1 10,4C10,2.9 10.9,2 12,2M21,9V7L15,1H5C3.89,1 3,1.89 3,3V21A2,2 0 0,0 5,23H19A2,2 0 0,0 21,21V9M19,9H14V4H5V21H19V9Z"/>
                    </svg>
                    <div>
                      <h3>Professional Testing</h3>
                      <p>Validate SCORM packages against industry standards</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Content iframe will be inserted here -->
            <iframe id="content-frame" class="content-viewer__frame hidden" sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-modals allow-top-navigation allow-top-navigation-by-user-activation"></iframe>
          </div>
        </div>
      </div>
    </main>
    
    <!-- Progress Footer -->
    <!-- Note: Footer is the single source of truth for compact progress display.
         The full ProgressTracking component should NOT be mounted in the footer.
         Use it in sidebar or dedicated panels if needed. -->
    <footer id="app-footer" class="app-footer">
      <div class="footer">
        <div class="footer__progress">
          <div class="progress-info">
            <span class="progress-info__label">Learning Progress</span>
            <div class="progress-bar">
              <div class="progress-bar__track">
                <div id="footer-progress-fill" class="progress-bar__fill" style="width: 0%"></div>
              </div>
              <span id="footer-progress-percentage" class="progress-bar__label">0%</span>
            </div>
          </div>
        </div>
        
        <div class="footer__stats">
          <div class="stat-item">
            <span class="stat-label">Status:</span>
            <span id="footer-status" class="stat-value">Not Started</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Score:</span>
            <span id="footer-score" class="stat-value">--</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">Time:</span>
            <span id="footer-time" class="stat-value">00:00:00</span>
          </div>
        </div>
      </div>
    </footer>
    
    
  </div>
  
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay hidden">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p id="loading-message">Loading...</p>
    </div>
  </div>
  
  <!-- Notifications Container -->
  <div id="notifications" class="notifications-container"></div>
  
  <!-- File Input (Hidden) -->
  <input type="file" id="file-input" accept=".zip,.scorm" style="display: none;">
  
  <!-- Scripts -->
  <script>
    // Layout initialization to prevent startup issues
    (function() {
      console.log('CRITICAL DEBUG: Layout initialization starting');
      
      // Ensure app layout is properly initialized
      const appElement = document.getElementById('app');
      if (appElement) {
        // Mark as not initialized to use safe startup styles
        appElement.classList.remove('initialized');
        
        // Set proper initial state
        document.body.style.overflow = 'hidden';
        document.documentElement.style.overflow = 'hidden';
        
        console.log('CRITICAL DEBUG: Layout prepared for initialization');
      }
    })();
    
    // Inline script to test if JavaScript is working
    console.log('CRITICAL DEBUG: Inline script executing');
    console.log('CRITICAL DEBUG: DOM ready state:', document.readyState);
    console.log('CRITICAL DEBUG: electronAPI available:', typeof window.electronAPI !== 'undefined');
    
    // Load the main app script as a regular script (uses dynamic imports internally)
    const script = document.createElement('script');
    script.src = 'scorm-app://app/src/renderer/app.js';  // Use custom protocol with fixed host for same-origin
    // No type="module" needed - using dynamic imports instead of static imports
    script.onload = () => {
      console.log('CRITICAL DEBUG: app.js loaded successfully');
      
      // Mark layout as initialized after app loads
      setTimeout(() => {
        const appElement = document.getElementById('app');
        if (appElement) {
          appElement.classList.add('initialized');
          console.log('CRITICAL DEBUG: Layout marked as initialized');
        }
      }, 100);
    };
    script.onerror = (error) => console.error('CRITICAL DEBUG: app.js failed to load:', error);
    document.head.appendChild(script);
  </script>
  
  <!-- Service Worker Registration - Disabled for offline Electron app -->
  <script>
    // Service workers are not needed in Electron offline apps
    // All functionality is handled by the main process
    console.log('SCORM Tester: Running in offline Electron mode');
  </script>
</body>
</html>
                      
